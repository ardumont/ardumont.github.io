---
layout: post
title: Literate org-trello
date: 2013-08-11
categories:
- literate-programming
- org-mode
- org-trello
- emacs
- emacs-lisp
author: Antoine R. Dumont
excerpt: literate org-trello tryout
---
<p>
To help improving the maintenance of <a href="http://ardumont.github.io/org-trello/">org-trello</a>, we will describe it using <a href="https://en.wikipedia.org/wiki/Literate_programming">literate programming</a>.
For this, we will use <a href="http://orgmode.org/">org-mode</a> and <a href="http://orgmode.org/worg/org-contrib/babel/intro.html">babel</a>.
</p>

<p>
We'll begin by:
</p>
<ul class="org-ul">
<li>a simple how to
</li>
<li>a little description
</li>
<li>the license
</li>
<li>a manual
</li>
<li>a full description step-by-step of the code (may need to find another organisation that the code order)
</li>
</ul>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Howto</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Open this file
</li>
<li>Tangle (extract) the code
</li>
</ul>

<p>
<i>M-x org-babel-tangle</i> or <i>C-c C-v t</i>
</p>

<p>
Or
</p>

<p>
``` sh
make tangle
```
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Description</h2>
<div class="outline-text-2" id="text-2">
<p>
org-trello is an emacs's org minor mode to permit the 2-way synchonization between org buffer and a trello board.
The headers needs to start with ;;; as a prerequisite for packaging.
This is an important step where we describe the different information about the project:
</p>
<ul class="org-ul">
<li>principal author
</li>
<li>maintainer
</li>
<li>current version
</li>
<li>dependencies
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="headers-description"><span style="color: #8B8989; font-style: italic;">;;; </span><span style="color: #8B8989; font-style: italic;">org-trello.el --- Org minor mode to synchronize with trello</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Copyright (C) 2013 Antoine R. Dumont &lt;eniotna.t AT gmail.com&gt;</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Author: Antoine R. Dumont &lt;eniotna.t AT gmail.com&gt;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Maintainer: Antoine R. Dumont &lt;eniotna.t AT gmail.com&gt;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Version: 0.1.1</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Package-Requires: ((org "8.0.7") (dash "1.5.0") (request "0.2.0") (cl-lib "0.</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">3.0") (json "1.2"))</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Keywords: org-mode trello sync org-trello</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">URL: https://github.com/org-trello/org-trello</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">License</h2>
<div class="outline-text-2" id="text-3">
<p>
First, org-trello is a free software under the GPL v3.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="headers-license"><span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">This file is NOT part of GNU Emacs.</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">This program is free software; you can redistribute it and/or modify</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">it under the terms of the GNU General Public License as published by</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">the Free Software Foundation; either version 3, or (at your option)</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">any later version.</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">This program is distributed in the hope that it will be useful,</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">GNU General Public License for more details.</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">You should have received a copy of the GNU General Public License</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">along with GNU Emacs; see the file COPYING. If not, write to the</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Boston, MA 02110-1301, USA.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Manual</h2>
<div class="outline-text-2" id="text-4">
<p>
A fast setup that we, end-users, can see from the package installation procedure.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="headers-manual"><span style="color: #8B8989; font-style: italic;">;;; </span><span style="color: #8B8989; font-style: italic;">Commentary:</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Minor mode for org-mode to sync org-mode and trello</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">1) Add the following to your emacs init file</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">(require 'org-trello)</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Automatically</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">2) Once - Install the consumer-key and the read-write token for org-trello to</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;"> be able to work in your name with your trello boards (C-c o i)</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">M-x org-trello/install-key-and-token</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">3) Once per org-mode file/board you want to connect to (C-c o I)</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">M-x org-trello/install-board-and-lists-ids</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">*Beware* you must setup your trello board with the name you use as keywords (</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">TODO, DONE e.g) on your org-mode file.</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">4) You can also create a board directly from a org-mode buffer (C-c o b)</span>
<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">M-x org-trello/create-board</span>
<span style="color: #8B8989; font-style: italic;">;;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Code</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Setup</h3>
<div class="outline-text-3" id="text-5-1">
<p>
First, we will begin simply by showing the dependencies.
Then the personal setup that the user can override.
</p>
</div>

<div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1">Library dependencies</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
We depend on:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">lib</th>
<th scope="col" class="left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">org</td>
<td class="left">As org-trello is a org minor mode</td>
</tr>

<tr>
<td class="left">json</td>
<td class="left">The transit of data to trello's api is in json</td>
</tr>

<tr>
<td class="left">dash</td>
<td class="left">To provide some specific lisp constructs</td>
</tr>

<tr>
<td class="left">request</td>
<td class="left">Awesome http client</td>
</tr>

<tr>
<td class="left">cl-lib</td>
<td class="left">To provide some common-lisp functions</td>
</tr>

<tr>
<td class="left">parse-time</td>
<td class="left">Some date time manipulation</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-lisp" id="org-trello-lib-deps"><span style="color: #8B8989; font-style: italic;">;;; </span><span style="color: #8B8989; font-style: italic;">Code:</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">org</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">json</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">dash</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">request</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>eval-when-compile <span style="color: #006400;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">cl-lib</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">require</span> '<span style="color: #4c83ff;">parse-time</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2">Personal setup</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
At the moment, we have only one possible setup.
This is relative to the checklist behaviour.
By default, the status of the checklist overrides the item's status.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="setup-org-trello">&#12;

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">#################### overriding setup</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*ORGTRELLO-CHECKLIST-UPDATE-ITEMS*</span> t
  <span style="color: #61CE3C;">"A variable to permit the checklist's status to be pass along to its items. t,</span><span style="color: #dc8cc3; background-color: #383838;"> if checklist's status is DONE, the items are updated to DONE (org-mode buffer and trello board), nil only the items's status is used.</span>
<span style="color: #61CE3C;">  To deactivate such behavior, update in your init.el:</span>
<span style="color: #61CE3C;">  (require 'org-trello)</span>
<span style="color: #61CE3C;">  (setq *ORGTRELLO-CHECKLIST-UPDATE-ITEMS* nil)"</span><span style="color: #8b0000;">)</span>
</pre>
</div>

<p>
If the user does not want this, he/she can modify his/her setup in his/her emacs startup file:
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #8b0000;">(</span>setq *ORGTRELLO-CHECKLIST-UPDATE-ITEMS* nil<span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Namespace</h3>
<div class="outline-text-3" id="text-5-2">
<p>
As each emacs developer knows, there is no real namespace in emacs-lisp.
But, we like to separate function depending on perimeters, so we tried to keep the code as much separated as we can.
</p>

<p>
At the moment, we sliced the code into 6 namespaces:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">name</th>
<th scope="col" class="left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">org-trello</td>
<td class="left">Main namespace which describe the minor mode, in charge of controls before executing anything</td>
</tr>

<tr>
<td class="left">orgtrello</td>
<td class="left">Primitive routines that executes the code without checks</td>
</tr>

<tr>
<td class="left">orgtrello-query</td>
<td class="left">Interface to the http request</td>
</tr>

<tr>
<td class="left">orgtrello-api</td>
<td class="left">Interface to the trello api</td>
</tr>

<tr>
<td class="left">orgtrello-data</td>
<td class="left">Interface to the org data</td>
</tr>

<tr>
<td class="left">orgtrello-hash</td>
<td class="left">Utility interface to simplify the construction of data</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">org-trello</h3>
<div class="outline-text-3" id="text-5-3">
<p>
This is the main entry namespace of org-trello.
Starting with the minor mode definition, we will show each higher interactive command after this.
</p>
</div>

<div id="outline-container-sec-5-3-1" class="outline-4">
<h4 id="sec-5-3-1">Minor mode</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
As we said in the <i>description</i> step, <a href="http://ardumont.github.io/org-trello/">org-trello</a> is a <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Minor-Modes.html">minor mode</a>.
</p>
</div>

<div id="outline-container-sec-5-3-1-1" class="outline-5">
<h5 id="sec-5-3-1-1">Description</h5>
<div class="outline-text-5" id="text-5-3-1-1">
<p>
Simply put, we offer a simple interface to the user through a map.
We declare the minor mode to have 'ot' as the emacs modeline name.
And we propose default bindings for the user to access the org-trello routine.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="org-trello-minor-mode"><span style="color: #8B8989; font-style: italic;">;;;</span><span style="color: #8B8989; font-style: italic;">###autoload</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-minor-mode</span> org-trello-mode <span style="color: #61CE3C;">"Sync your org-mode and your trello together.</span><span style="color: #dc8cc3; background-color: #383838;">"</span>
  <span style="color: #FF6400;">:lighter</span> <span style="color: #61CE3C;">" ot"</span> <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">the name on the modeline</span>
  <span style="color: #FF6400;">:keymap</span>  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>map <span style="color: #00ff00;">(</span>make-sparse-keymap<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
             <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">binding will change</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o i"</span><span style="color: #ffff00;">)</span> 'org-trello/install-key-and-token<span style="color: #ff1493;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o I"</span><span style="color: #ffff00;">)</span> 'org-trello/install-board-and-lists<span style="color: #dc8cc3; background-color: #383838;">-ids</span><span style="color: #ff1493; background-color: #383838;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o b"</span><span style="color: #ffff00;">)</span> 'org-trello/create-board<span style="color: #ff1493;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o c"</span><span style="color: #ffff00;">)</span> 'org-trello/create-simple-entity<span style="color: #ff1493;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o C"</span><span style="color: #ffff00;">)</span> 'org-trello/create-complex-entity<span style="color: #ff1493;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o s"</span><span style="color: #ffff00;">)</span> 'org-trello/sync-to-trello<span style="color: #ff1493;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o S"</span><span style="color: #ffff00;">)</span> 'org-trello/sync-from-trello<span style="color: #ff1493;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o k"</span><span style="color: #ffff00;">)</span> 'org-trello/kill-entity<span style="color: #ff1493;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o h"</span><span style="color: #ffff00;">)</span> 'org-trello/help-describing-binding<span style="color: #dc8cc3; background-color: #383838;">s</span><span style="color: #ff1493; background-color: #383838;">)</span>
             <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">define-key</span> map <span style="color: #ffff00;">(</span>kbd <span style="color: #61CE3C;">"C-c o d"</span><span style="color: #ffff00;">)</span> 'org-trello/check-setup<span style="color: #ff1493;">)</span>
             <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">define other bindings...</span>
             map<span style="color: #006400;">)</span>
  <span style="color: #FF6400;">:after-hook</span> <span style="color: #006400;">(</span>message <span style="color: #61CE3C;">"ot is on! To begin with, hit C-c o h or M-x 'org-trello/</span><span style="color: #dc8cc3; background-color: #383838;">help-describing-bindings"</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span>add-hook 'org-mode-hook 'org-trello-mode<span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>message <span style="color: #61CE3C;">"org-trello loaded!"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-1-2" class="outline-5">
<h5 id="sec-5-3-1-2">Override</h5>
<div class="outline-text-5" id="text-5-3-1-2">
<p>
If the user is not satisfied with the default bindings, he/she can always override in his/her own setup files.
I kept the default one but the idea is to replace those bindings by the one you want.
</p>

<div class="org-src-container">

<pre class="src src-lisp"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o i"</span><span style="color: #006400;">)</span> 'org-trello/install-key-and-toke<span style="color: #dc8cc3; background-color: #383838;">n</span><span style="color: #8b0000; background-color: #383838;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o I"</span><span style="color: #006400;">)</span> 'org-trello/install-board-and-li<span style="color: #dc8cc3; background-color: #383838;">sts-ids</span><span style="color: #8b0000; background-color: #383838;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o b"</span><span style="color: #006400;">)</span> 'org-trello/create-board<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o c"</span><span style="color: #006400;">)</span> 'org-trello/create-simple-entity<span style="color: #8b0000; background-color: #383838;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o C"</span><span style="color: #006400;">)</span> 'org-trello/create-complex-entit<span style="color: #dc8cc3; background-color: #383838;">y</span><span style="color: #8b0000; background-color: #383838;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o s"</span><span style="color: #006400;">)</span> 'org-trello/sync-to-trello<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o S"</span><span style="color: #006400;">)</span> 'org-trello/sync-from-trello<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o k"</span><span style="color: #006400;">)</span> 'org-trello/kill-entity<span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o h"</span><span style="color: #006400;">)</span> 'org-trello/help-describing-bind<span style="color: #dc8cc3; background-color: #383838;">ings</span><span style="color: #8b0000; background-color: #383838;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">define-key</span> org-trello-mode-map <span style="color: #006400;">(</span>kbd <span style="color: #61CE3C;">"C-c o d"</span><span style="color: #006400;">)</span> 'org-trello/check-setup<span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5-3-2" class="outline-4">
<h4 id="sec-5-3-2">Help</h4>
<div class="outline-text-4" id="text-5-3-2">
<p>
Let's begin simple, we offer an interactive command to display the current possible bindings.
Hitting <i>C-c o h</i>, this will display a simple message on the minibuffer.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="help-describe"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/help-describing-bindings</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"A simple message to describe the standard bindings used."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>message
<span style="color: #61CE3C;">"C-c o i - M-x org-trello/install-key-and-token       - Install the keys and the</span><span style="color: #dc8cc3; background-color: #383838;"> access-token.</span>
<span style="color: #61CE3C;">C-c o I - M-x org-trello/install-board-and-lists-ids - Select the board and atta</span><span style="color: #dc8cc3; background-color: #383838;">ch the todo, doing and done list.</span>
<span style="color: #61CE3C;">C-c o b - M-x org-trello/create-board                - Create interactively a bo</span><span style="color: #dc8cc3; background-color: #383838;">ard and attach the org-mode file to this trello board.</span>
<span style="color: #61CE3C;">C-c o c - M-x org-trello/create-simple-entity        - Create/Update an entity (</span><span style="color: #dc8cc3; background-color: #383838;">card/checklist/item) depending on its level and status. Do not deal with level superior to 4.</span>
<span style="color: #61CE3C;">C-c o C - M-x org-trello/create-complex-entity       - Create/Update a complete </span><span style="color: #dc8cc3; background-color: #383838;">entity card/checklist/item and its subtree (depending on its level).</span>
<span style="color: #61CE3C;">C-c o s - M-x org-trello/sync-to-trello              - Synchronize the org-mode </span><span style="color: #dc8cc3; background-color: #383838;">file to the trello board (org-mode -&gt; trello).</span>
<span style="color: #61CE3C;">C-c o S - M-x org-trello/sync-from-trello            - Synchronize the org-mode </span><span style="color: #dc8cc3; background-color: #383838;">file from the trello board (trello -&gt; org-mode).</span>
<span style="color: #61CE3C;">C-c o k - M-x org-trello/kill-entity                 - Kill the entity (and its </span><span style="color: #dc8cc3; background-color: #383838;">arborescence tree).</span>
<span style="color: #61CE3C;">C-c o d - M-x org-trello/check-setup                 - Simple routine to check t</span><span style="color: #dc8cc3; background-color: #383838;">hat the setup is ok. If everything is ok, will simply display 'Setup ok!'</span>
<span style="color: #61CE3C;">C-c o h - M-x org-trello/help-describing-bindings    - This help message."</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-3" class="outline-4">
<h4 id="sec-5-3-3">Install the consumer-key and the read/write access token</h4>
<div class="outline-text-4" id="text-5-3-3">
<p>
One of the first interaction we must have with org-trello is the setup.
For this, we declare an interactive command.
We delegate the code to the function <code>org-trello/--msg-deco-control-and-do</code>.
This will:
</p>
<ul class="org-ul">
<li>log the actions "Setup key and token" in the mini-buffer.
</li>
<li>execute no control as none is needed (thus the nil as second parameter)
</li>
<li>as there are no control, directly execute the 'org-trello/do-install-key-and-token.
</li>
<li>as there is writing involve, we ask to save the buffer at the end (t)
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="install-key-and-token"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/install-key-and-token</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"No control, trigger the setup installation of the key and the read/write toke</span><span style="color: #dc8cc3; background-color: #383838;">n."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do <span style="color: #61CE3C;">"Setup key and token"</span> nil 'orgtrello/do-<span style="color: #dc8cc3; background-color: #383838;">install-key-and-token t</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-4" class="outline-4">
<h4 id="sec-5-3-4">Decorator/Controller</h4>
<div class="outline-text-4" id="text-5-3-4">
<p>
As we've seen before, we have a higher-order function <code>org-trello/--msg-deco-control-and-do</code> which is in charge of:
</p>
<ul class="org-ul">
<li>displaying the message <code>msg</code> in the mini-buffer
</li>
<li>ask for the <code>org-trello/--control-and-do</code> function to execute
</li>
<li>displaying the result string from the call of the previous function if there is some
</li>
<li>optionally, we can ask for saving the buffer through the flag <code>save-buffer-p</code>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="msg-decorator-and-control">&#12;

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">#################### org-trello</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/--msg-deco-control-and-do</span> <span style="color: #006400;">(</span>msg control-fns fn-to-control-and-e<span style="color: #dc8cc3; background-color: #383838;">xecute </span><span style="color: #dc8cc3; background-color: #383838;">&amp;optional</span><span style="color: #dc8cc3; background-color: #383838;"> save-buffer-p</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"A simple decorator function to display message in mini-buffer before and afte</span><span style="color: #dc8cc3; background-color: #383838;">r the execution of the control"</span>
  <span style="color: #006400;">(</span>message <span style="color: #ff1493;">(</span>concat msg <span style="color: #61CE3C;">"..."</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>org-trello/--result-action <span style="color: #00ff00;">(</span>org-trello/--control-and-do control-fns fn-<span style="color: #dc8cc3; background-color: #383838;">to-control-and-execute</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">do we have to save the buffer</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> save-buffer-p
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">progn</span>
          <span style="color: #00ff00;">(</span>save-buffer<span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span>org-mode-restart<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>string-or-null-p org-trello/--result-action<span style="color: #ffff00;">)</span>
      <span style="color: #ffff00;">(</span>message org-trello/--result-action<span style="color: #ffff00;">)</span>
      <span style="color: #ffff00;">(</span>message <span style="color: #00ff00;">(</span>concat msg <span style="color: #61CE3C;">" - done!"</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>

<p>
This is the main function which is in charge:
</p>
<ul class="org-ul">
<li>executing a list of controls <code>control-fns</code>
</li>
<li>if there is no control or the controls are ok, execute the function <code>fn-to-control-and-execute</code>
</li>
<li>returns the resulting string from the execution of the function
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="control-and-execute"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/--control-and-do</span> <span style="color: #006400;">(</span>control-fns fn-to-control-and-execute<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Execute the function fn if control-fns is nil or if the result of apply every</span><span style="color: #dc8cc3; background-color: #383838;"> function to fn is ok."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">if</span> control-fns
      <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>org-trello/--error-messages <span style="color: #add8e6;">(</span>--filter <span style="color: #ffa500;">(</span>not <span style="color: #6a5acd;">(</span>equal <span style="color: #FF6400;">:ok</span> <span style="color: #d3d3d3;">(</span>funcall it<span style="color: #d3d3d3;">)</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> control-fns</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> org-trello/--error-messages
            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">there are some trouble, we display all the error messages to help</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;"> the user understand the problem</span>
            <span style="color: #00ff00;">(</span>message <span style="color: #61CE3C;">"List of errors:\n %s"</span> <span style="color: #add8e6;">(</span>--mapcat <span style="color: #ffa500;">(</span>concat <span style="color: #61CE3C;">"- "</span> it <span style="color: #61CE3C;">"\n"</span><span style="color: #ffa500;">)</span> org-<span style="color: #dc8cc3; background-color: #383838;">trello/--error-messages</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">ok execute the function as the controls are ok</span>
          <span style="color: #00ff00;">(</span>funcall fn-to-control-and-execute<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">no control, we simply execute the function</span>
    <span style="color: #ff1493;">(</span>funcall fn-to-control-and-execute<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-5" class="outline-4">
<h4 id="sec-5-3-5">Setup trello</h4>
<div class="outline-text-4" id="text-5-3-5">
<p>
To use trello, we need to either install a trello board or create one.
In either case, this will do some action and update the org-mode buffer with some needed metadata:
</p>
<ul class="org-ul">
<li>board-id
</li>
<li>board-name (for the user to see which board he/she uses)
</li>
<li>every keyword (org) / list id (trello)
</li>
</ul>
</div>

<div id="outline-container-sec-5-3-5-1" class="outline-5">
<h5 id="sec-5-3-5-1">Install the board</h5>
<div class="outline-text-5" id="text-5-3-5-1">
<p>
To install a trello board, we need:
</p>
<ul class="org-ul">
<li>to display a message on the minibuffer "Install boards and lists"
</li>
<li>execute the loading of the setup via <code>setup-properties</code> function (no control but a setup)
</li>
<li>execute the control of the key and access-token are ok
</li>
<li>if everything is ok, do install the board and lists on the trello buffer
</li>
<li>as some update of the org-mode buffer is done, we ask for the buffer to be saved
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="install-board"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/install-board-and-lists-ids</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Control first, then if ok, trigger the setup installation of the trello board</span><span style="color: #dc8cc3; background-color: #383838;"> to sync with."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do
     <span style="color: #61CE3C;">"Install boards and lists"</span>
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys<span style="color: #ff1493;">)</span>
     'orgtrello/do-install-board-and-lists
     t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-5-2" class="outline-5">
<h5 id="sec-5-3-5-2">Create a board</h5>
<div class="outline-text-5" id="text-5-3-5-2">
<p>
To create a trello board from scratch, we need:
</p>
<ul class="org-ul">
<li>to display a message on the minibuffer "Create boards and lists"
</li>
<li>execute the loading of the setup via <code>setup-properties</code> function (no control but a setup)
</li>
<li>execute the control of the key and access-token are ok
</li>
<li>if everything is ok, do create the board and lists on the trello buffer
</li>
<li>as some update of the org-mode buffer is done, we ask for the buffer to be saved
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="create-board"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/create-board</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Control first, then if ok, trigger the board creation."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do
     <span style="color: #61CE3C;">"Create board and lists"</span>
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys<span style="color: #ff1493;">)</span>
     'orgtrello/do-create-board-and-lists
     t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-6" class="outline-4">
<h4 id="sec-5-3-6">Check the installation</h4>
<div class="outline-text-4" id="text-5-3-6">
<p>
Now that we setuped the org buffer to work with a trello board, we can ensure that the setup is ok.
For this, we simply call the <code>org-trello/--control-and-do</code> routine with:
</p>
<ul class="org-ul">
<li><code>orgtrello/--setup-properties</code> which will load the metadata from the file
</li>
<li><code>orgtrello/--control-keys</code> to ensure the key and access token are loaded
</li>
<li><code>orgtrello/--control-properties</code> to ensure the properties are properly setuped
</li>
</ul>
<p>
If any of those are badly setuped, a message will explicit the problem.
Otherwise, a simple message "Setup ok!" will be displayed on the minibuffer.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="check-installation"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/check-setup</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Check the current setup."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--control-and-do
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys orgtrello/--control<span style="color: #dc8cc3; background-color: #383838;">-properties orgtrello/--control-encoding</span><span style="color: #ff1493; background-color: #383838;">)</span>
     <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">()</span> <span style="color: #ffff00;">(</span>message <span style="color: #61CE3C;">"Setup ok!"</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-7" class="outline-4">
<h4 id="sec-5-3-7">Sync a simple entity</h4>
<div class="outline-text-4" id="text-5-3-7">
<p>
To create/synchronize a simple entity (without its arborescence), we need to ensure some standard controls are ok.
Then we can call the primitive routine <code>orgtrello/do-create-simple-entity</code> to do the actual creation.
At last, saving the buffer as the creation involves some buffer updates (with the trello id).
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="create-simple-entity"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/create-simple-entity</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Control first, then if ok, create a simple entity."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do
     <span style="color: #61CE3C;">"Synchronizing entity"</span>
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys orgtrello/--control<span style="color: #dc8cc3; background-color: #383838;">-properties orgtrello/--control-encoding</span><span style="color: #ff1493; background-color: #383838;">)</span>
     <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">()</span> <span style="color: #ffff00;">(</span>orgtrello/do-create-simple-entity t<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
     t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-8" class="outline-4">
<h4 id="sec-5-3-8">Sync a complex entity</h4>
<div class="outline-text-4" id="text-5-3-8">
<p>
To create/synchronize a complex entity (with its arborescence), we need to ensure some standard controls are ok.
Then we can call the primitive routine <code>orgtrello/do-create-complex-entity</code> to do the actual creation.
At last, saving the buffer as the creation involves some buffer updates.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="create-complex-entity"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/create-complex-entity</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Control first, then if ok, create an entity and all its arborescence if need </span><span style="color: #dc8cc3; background-color: #383838;">be."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do
     <span style="color: #61CE3C;">"Synchronizing complex entity"</span>
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys orgtrello/--control<span style="color: #dc8cc3; background-color: #383838;">-properties orgtrello/--control-encoding</span><span style="color: #ff1493; background-color: #383838;">)</span>
     'orgtrello/do-create-complex-entity
     t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-9" class="outline-4">
<h4 id="sec-5-3-9">Synchronize the org-mode buffer to trello</h4>
<div class="outline-text-4" id="text-5-3-9">
<p>
Now that we have the basic brick (synchronize simple/complex entity), we can use this to synchronize the all buffer to trello.
But first, we need to ensure some standard controls are ok.
Then calling the primitive routine <code>orgtrello/do-sync-full-file</code> which does the actual syncing.
At last, we save the buffer as the buffer has been updated.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="sync-org-to-trello"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/sync-to-trello</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Control first, then if ok, sync the org-mode file completely to trello."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do
     <span style="color: #61CE3C;">"Synchronizing org-mode file to trello"</span>
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys orgtrello/--control<span style="color: #dc8cc3; background-color: #383838;">-properties orgtrello/--control-encoding</span><span style="color: #ff1493; background-color: #383838;">)</span>
     'orgtrello/do-sync-full-file
     t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-10" class="outline-4">
<h4 id="sec-5-3-10">Synchronize the org-mode buffer from trello</h4>
<div class="outline-text-4" id="text-5-3-10">
<p>
The other way around is also possible.
You know the drill by now, we must ensure we have the standard control that pass.
Then calling the routine <code>orgtrello/do-sync-full-from-trello</code> which really does the action.
Then saving the buffer as the action involved some buffer updates.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="sync-org-from-trello"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/sync-from-trello</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Control first, then if ok, sync the org-mode file from the trello board."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do
     <span style="color: #61CE3C;">"Synchronizing trello board to org-mode file"</span>
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys orgtrello/--control<span style="color: #dc8cc3; background-color: #383838;">-properties orgtrello/--control-encoding</span><span style="color: #ff1493; background-color: #383838;">)</span>
     'orgtrello/do-sync-full-from-trello
     t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-11" class="outline-4">
<h4 id="sec-5-3-11">Kill/Remove/Delete an entity</h4>
<div class="outline-text-4" id="text-5-3-11">
<p>
As we can create entity on trello, we can also remove them (from trello and the current org buffer).
As usual, we ensure standard controls are ok.
Then calling the subroutine <code>orgtrello/do-delete-simple</code> which does the action.
Then saving the buffer as the action involved some buffer updates.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="kill-entity"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">org-trello/kill-entity</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Control first, then if ok, delete the entity and all its arborescence."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>org-trello/--msg-deco-control-and-do
     <span style="color: #61CE3C;">"Delete entity"</span>
     '<span style="color: #ff1493;">(</span>orgtrello/--setup-properties orgtrello/--control-keys orgtrello/--control<span style="color: #dc8cc3; background-color: #383838;">-properties orgtrello/--control-encoding</span><span style="color: #ff1493; background-color: #383838;">)</span>
     <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">()</span> <span style="color: #ffff00;">(</span>orgtrello/do-delete-simple t<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
     t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-12" class="outline-4">
<h4 id="sec-5-3-12">Providing</h4>
<div class="outline-text-4" id="text-5-3-12">
<p>
Now that we defined all of our code, we need to provide the library we created.
Simplify using emacs's primitive <i>provide</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="org-trello-provide"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">provide</span> '<span style="color: #4c83ff;">org-trello</span><span style="color: #8b0000;">)</span>

<span style="color: #8B8989; font-style: italic;">;;; </span><span style="color: #8B8989; font-style: italic;">org-trello.el ends here</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4">orgtrello</h3>
<div class="outline-text-3" id="text-5-4">
<p>
This is the namespace in charge of the primitive functions that actually trigger the action. Those functions reflect the same action as we define earlier but without any controls first.
They are not to be called directly from the user.
</p>
</div>

<div id="outline-container-sec-5-4-1" class="outline-4">
<h4 id="sec-5-4-1">Namespace setup</h4>
<div class="outline-text-4" id="text-5-4-1">
<p>
First, we'll begin by some setup variables that are actually used throughout the namespace:
</p>
<ul class="org-ul">
<li><b>TODO</b> representation of org's "TODO" keyword
</li>
<li><b>DONE</b> representation of org's "DONE" keyword
</li>
<li><b>BOARD-ID</b> will be the trello board's identifier for org-trello to know which board to use
</li>
<li><b>BOARD-NAME</b> will be the trello board's name for the user to know to which board he/she works with
</li>
<li><b>LIST-NAMES</b> is the keyword the user use with org in reverse order
</li>
<li><b>HMAP-ID-NAME</b> is a map of those same keyword with a sequence identifier
</li>
<li><b>CONFIG-DIR</b> is the org-trello's home folder
</li>
<li><b>CONFIG-FILE</b> is the org-trello's setup file (for consumer-key and access-token)
</li>
<li><b>consumer-key</b> is the user's consumer-key for trello
</li>
<li><b>access-token</b> is the user's read/write access-token for trello
</li>
<li><b>ORGTRELLO-MARKER</b> is a marker used by org-trello to know which entity it has synced. This is dependent on the <b>consumer-key</b>
</li>
</ul>

<p>
The user does not have to touch anything on this.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-setup-variable">&#12;

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">#################### orgtrello</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Specific state - FIXME check if they do not already exist on org-mode to avoi</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">d potential collisions</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*TODO*</span> <span style="color: #61CE3C;">"TODO"</span> <span style="color: #61CE3C;">"org-mode todo state"</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*DONE*</span> <span style="color: #61CE3C;">"DONE"</span> <span style="color: #61CE3C;">"org-mode done state"</span><span style="color: #8b0000;">)</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Properties key for the orgtrello headers #+PROPERTY board-id, etc...</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*BOARD-ID*</span> <span style="color: #61CE3C;">"board-id"</span> <span style="color: #61CE3C;">"orgtrello property board-id entry"</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*BOARD-NAME*</span> <span style="color: #61CE3C;">"board-name"</span> <span style="color: #61CE3C;">"orgtrello property board-name entry"</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*LIST-NAMES*</span>   nil <span style="color: #61CE3C;">"orgtrello property names of the different lists. Thi</span><span style="color: #dc8cc3; background-color: #383838;">s use the standard 'org-todo-keywords property from org-mode."</span><span style="color: #8b0000; background-color: #383838;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*HMAP-ID-NAME*</span> nil <span style="color: #61CE3C;">"orgtrello hash map containing for each id, the assoc</span><span style="color: #dc8cc3; background-color: #383838;">iated name (or org keyword)."</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*CONFIG-DIR*</span>  <span style="color: #006400;">(</span>concat <span style="color: #ff1493;">(</span>getenv <span style="color: #61CE3C;">"HOME"</span><span style="color: #ff1493;">)</span> <span style="color: #61CE3C;">"/"</span> <span style="color: #61CE3C;">".trello"</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*CONFIG-FILE*</span> <span style="color: #006400;">(</span>concat *CONFIG-DIR* <span style="color: #61CE3C;">"/config.el"</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*consumer-key*</span>     nil <span style="color: #61CE3C;">"Id representing the user"</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*access-token*</span>     nil <span style="color: #61CE3C;">"Read/write Access token to use trello in the use</span><span style="color: #dc8cc3; background-color: #383838;">r's name "</span><span style="color: #8b0000; background-color: #383838;">)</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*ORGTRELLO-MARKER*</span> nil <span style="color: #61CE3C;">"Marker used for syncing the data in trello"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-2" class="outline-4">
<h4 id="sec-5-4-2">Control/setup routines</h4>
<div class="outline-text-4" id="text-5-4-2">
<p>
Some control/setup important routines because they will permit or not to launch the main actions.
</p>
</div>

<div id="outline-container-sec-5-4-2-1" class="outline-5">
<h5 id="sec-5-4-2-1">orgtrello/&#x2013;setup-properties</h5>
<div class="outline-text-5" id="text-5-4-2-1">
<p>
This is an important routine in charge of loading the keywords the user want to use.
Note that this routine reverse the list of org keywords.
This is a trick to help create the list in trello in the right order (assuming the user defines in the right order his/her keywords, e.g <i>TODO DOING | DONE FAIL</i>)
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-setup-properties"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--setup-properties</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Setup the properties according to the org-mode setup. Return :ok."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--list-keywords <span style="color: #00ff00;">(</span>nreverse <span style="color: #add8e6;">(</span>orgtrello/filtered-kwds<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello/--hmap-id-name <span style="color: #00ff00;">(</span>cl-reduce
                                    <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffa500;">(</span>hmap name<span style="color: #ffa500;">)</span>
                                      <span style="color: #ffa500;">(</span><span style="color: #FBDE2D;">progn</span>
                                        <span style="color: #6a5acd;">(</span>puthash <span style="color: #d3d3d3;">(</span>assoc-default name org-file-pr<span style="color: #dc8cc3; background-color: #383838;">operties</span><span style="color: #d3d3d3; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> name hmap</span><span style="color: #6a5acd; background-color: #383838;">)</span>
                                        hmap<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
                                    orgtrello/--list-keywords
                                    <span style="color: #FF6400;">:initial-value</span> <span style="color: #add8e6;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span>setq *LIST-NAMES*   orgtrello/--list-keywords<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>setq *HMAP-ID-NAME* orgtrello/--hmap-id-name<span style="color: #ff1493;">)</span>
    <span style="color: #FF6400;">:ok</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-2-2" class="outline-5">
<h5 id="sec-5-4-2-2">orgtrello/filtered-kwds</h5>
<div class="outline-text-5" id="text-5-4-2-2">
<p>
This is a function in charge of retrieving the specific keywords the user wants to use with trello.
This will map later as the list in trello and as keyword in emacs's org-mode buffer.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/filtered-kwds"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/filtered-kwds</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"org keywords used (based on org-todo-keywords-1)."</span>
  org-todo-keywords-1<span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-5-4-2-3" class="outline-5">
<h5 id="sec-5-4-2-3">orgtrello/&#x2013;control-encoding</h5>
<div class="outline-text-5" id="text-5-4-2-3">
<p>
A simple message to make the user aware he needs to use utf-8 encoding.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-control-encoding"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--control-encoding</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Use utf-8, otherwise, there will be trouble."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">progn</span>
    <span style="color: #ff1493;">(</span>message <span style="color: #61CE3C;">"Ensure you use utf-8 encoding for your org buffer."</span><span style="color: #ff1493;">)</span>
    <span style="color: #FF6400;">:ok</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-2-4" class="outline-5">
<h5 id="sec-5-4-2-4">orgtrello/&#x2013;control-properties</h5>
<div class="outline-text-5" id="text-5-4-2-4">
<p>
An important higher routine to ensure that the setup regarding the trello board is rightly setuped on the org buffer.
We simply ensure that we have the right amount of properties regarding the org keywords.
If all is ok, we return the :ok value, otherwise, we return an error message indicating the user what he must do.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-control-properties"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--control-properties</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"org-trello needs the properties board-id and all list id from the trello boar</span><span style="color: #dc8cc3; background-color: #383838;">d to be setuped on header property file. Returns :ok if everything is ok, or the error message if problems."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--hmap-count   <span style="color: #00ff00;">(</span>hash-table-count *HMAP-ID-NAME*<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>and <span style="color: #00ff00;">(</span>assoc-default *BOARD-ID* org-file-properties<span style="color: #00ff00;">)</span>
             <span style="color: #00ff00;">(</span>= <span style="color: #add8e6;">(</span>length *LIST-NAMES*<span style="color: #add8e6;">)</span> orgtrello/--hmap-count<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
        <span style="color: #FF6400;">:ok</span>
      <span style="color: #61CE3C;">"Setup problem.\nEither you did not connect your org-mode buffer with a tr</span><span style="color: #dc8cc3; background-color: #383838;">ello board, to correct this:\n  * attach to a board through C-c o I or M-x org-trello/install-board-and-lists-ids\n  * or create a board from scratch with C-c o b or M-x org-trello/create-board).\nEither your org-mode's todo keyword list and your trello board lists are not named the same way (which they must).\nFor this, connect to trello and rename your board's list according to your org-mode's todo list.\nAlso, you can specify on your org-mode buffer the todo list you want to work with, for example: #+</span><span style="color: #dc8cc3; background-color: #383838;">TODO:</span><span style="color: #dc8cc3; background-color: #383838;"> TODO DOING | DONE FAIL (hit C-c C-c to refresh the setup)"</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-2-5" class="outline-5">
<h5 id="sec-5-4-2-5">orgtrello/&#x2013;control-keys</h5>
<div class="outline-text-5" id="text-5-4-2-5">
<p>
Another important check routine to ensure that the user has rightfully setuped his/her consumer-key and read/write access-token.
If everything is ok, we return :ok.
Otherwise, we return an error message indicating what the user must do.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-control-keys"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--control-keys</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"org-trello needs the *consumer-key* and the *access-token* to access the trel</span><span style="color: #dc8cc3; background-color: #383838;">lo resources. Returns :ok if everything is ok, or the error message if problems."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ff1493;">(</span>or <span style="color: #ffff00;">(</span>and *consumer-key* *access-token*<span style="color: #ffff00;">)</span>
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">the data are not set,</span>
          <span style="color: #ffff00;">(</span>and <span style="color: #00ff00;">(</span>file-exists-p *CONFIG-FILE*<span style="color: #00ff00;">)</span>
               <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">trying to load them</span>
               <span style="color: #00ff00;">(</span>load *CONFIG-FILE*<span style="color: #00ff00;">)</span>
               <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">still not loaded, something is not right!</span>
               <span style="color: #00ff00;">(</span>and *consumer-key* *access-token*<span style="color: #00ff00;">)</span>
               <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">setting the marker once</span>
               <span style="color: #00ff00;">(</span>setq *ORGTRELLO-MARKER* <span style="color: #add8e6;">(</span>format <span style="color: #61CE3C;">"orgtrello-marker-%s"</span> *consumer-<span style="color: #dc8cc3; background-color: #383838;">key*</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
      <span style="color: #FF6400;">:ok</span>
    <span style="color: #61CE3C;">"Setup problem - You need to install the consumer-key and the read/write acc</span><span style="color: #dc8cc3; background-color: #383838;">ess-token - C-c o i or M-x org-trello/install-board-and-lists-ids"</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-3" class="outline-4">
<h4 id="sec-5-4-3">Abstraction access routines</h4>
<div class="outline-text-4" id="text-5-4-3">
<p>
Those are simple routines to abstract away the representation of the org data we manipulate.
</p>
</div>

<div id="outline-container-sec-5-4-3-1" class="outline-5">
<h5 id="sec-5-4-3-1">orgtrello/&#x2013;keyword</h5>
<div class="outline-text-5" id="text-5-4-3-1">
<p>
Extract the status/keyword from the current entity (e.g TODO, DONE, etc&#x2026;).
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-keyword"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--keyword</span> <span style="color: #006400;">(</span>entity-meta <span style="color: #D8FA3C;">&amp;optional</span> default-value<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the keyword from the entity. If default-value is specified, this is </span><span style="color: #dc8cc3; background-color: #383838;">the default value if no keyword is present"</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:keyword</span> entity-meta default-value<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-3-2" class="outline-5">
<h5 id="sec-5-4-3-2">orgtrello/&#x2013;label</h5>
<div class="outline-text-5" id="text-5-4-3-2">
<p>
To extract the label from the entity.
This is what's map to the name of the entity on trello.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-label"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--label</span> <span style="color: #006400;">(</span>entity-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the label from the entity."</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:title</span> entity-meta<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-3-3" class="outline-5">
<h5 id="sec-5-4-3-3">orgtrello/&#x2013;id</h5>
<div class="outline-text-5" id="text-5-4-3-3">
<p>
The identifier of the entity once it has been synchronized on trello.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-id"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--id</span> <span style="color: #006400;">(</span>entity-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the id from the entity."</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:id</span> entity-meta<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-3-4" class="outline-5">
<h5 id="sec-5-4-3-4">orgtrello/&#x2013;level</h5>
<div class="outline-text-5" id="text-5-4-3-4">
<p>
The current level (mapped to the number of stars).
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-level"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--level</span> <span style="color: #006400;">(</span>entity-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the level from the entity."</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:level</span> entity-meta<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-3-5" class="outline-5">
<h5 id="sec-5-4-3-5">orgtrello/&#x2013;due</h5>
<div class="outline-text-5" id="text-5-4-3-5">
<p>
The deadline (org notion) mapped to due date (on trello).
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-due"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--due</span> <span style="color: #006400;">(</span>entity-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the due date from the entity."</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:due</span> entity-meta<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-4" class="outline-4">
<h4 id="sec-5-4-4">Create simple entity</h4>
<div class="outline-text-4" id="text-5-4-4">
</div><div id="outline-container-sec-5-4-4-1" class="outline-5">
<h5 id="sec-5-4-4-1">orgtrello/do-create-simple-entity</h5>
<div class="outline-text-5" id="text-5-4-4-1">
<p>
The orchestration to trigger the simple synchronization of an entity (without any arborescence):
</p>
<ul class="org-ul">
<li>compute the metadata (current, parent, grandparent) from the current org entry (this may be need if too deep level)
</li>
<li>if there is some metadata
<ul class="org-ul">
<li>if this is an error message, transit the message
</li>
<li>otherwise
<ul class="org-ul">
<li>set the marker on org buffer for the current entry
</li>
<li>compute and execute the http query
</li>
<li>return a success message
</li>
</ul>
</li>
</ul>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-create-simple-entity"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-create-simple-entity</span> <span style="color: #006400;">(</span><span style="color: #D8FA3C;">&amp;optional</span> sync<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Do the actual simple creation of a card, checklist or task. Optionally, we ca</span><span style="color: #dc8cc3; background-color: #383838;">n render the creation synchronous."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>entry-metadata <span style="color: #00ff00;">(</span>orgtrello-data/entry-get-full-metadata<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> entry-metadata
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>query-http-or-error-msg <span style="color: #ffa500;">(</span>orgtrello/--dispatch-create <span style="color: #6a5acd;">(</span>gethash <span style="color: #FF6400;">:cu</span><span style="color: #dc8cc3; background-color: #383838;">rrent</span><span style="color: #dc8cc3; background-color: #383838;"> entry-metadata</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #6a5acd; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">gethash </span><span style="color: #dc8cc3; background-color: #383838;">:parent</span><span style="color: #dc8cc3; background-color: #383838;"> entry-metadata</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #6a5acd; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">gethash </span><span style="color: #dc8cc3; background-color: #383838;">:grandparent</span><span style="color: #dc8cc3; background-color: #383838;"> entry-metadata</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
          <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #add8e6;">(</span>hash-table-p query-http-or-error-msg<span style="color: #add8e6;">)</span>
              <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">if it's a hash-table we can do the sync</span>
              <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">progn</span>
                <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">set the consumer-key to make a pointer to get back to when th</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">e request is finished</span>
                <span style="color: #ffa500;">(</span>orgtrello/--set-marker<span style="color: #ffa500;">)</span>
                <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">request</span>
                <span style="color: #ffa500;">(</span>orgtrello-query/http query-http-or-error-msg sync 'orgtrello-qu<span style="color: #dc8cc3; background-color: #383838;">ery/--post-put-success-callback-update-id</span><span style="color: #ffa500; background-color: #383838;">)</span>
                <span style="color: #61CE3C;">"Synchronizing simple entity done!"</span><span style="color: #add8e6;">)</span>
            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">else it's a string to display</span>
            query-http-or-error-msg<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-4-2" class="outline-5">
<h5 id="sec-5-4-4-2">creation/update routine</h5>
<div class="outline-text-5" id="text-5-4-4-2">
<p>
Those functions does not actually do any request, they compute the map representing the request.
</p>
</div>
<ul class="org-ul"><li><a id="sec-5-4-4-2-1" name="sec-5-4-4-2-1"></a>card<br  /><ul class="org-ul"><li><a id="sec-5-4-4-2-1-1" name="sec-5-4-4-2-1-1"></a>orgtrello/&#x2013;card<br  /><div class="outline-text-7" id="text-5-4-4-2-1-1">
<p>
This is the main entry to create/update a card.
There is a series of check done by the <code>orgtrello/--checks-before-sync-card</code> function.
If ok, then we can continue with the main intent of the function.
We extract from the metadata the:
</p>
<ul class="org-ul">
<li>keyword status of the card (TODO, DONE, etc&#x2026;)
</li>
<li>trello list identifier to which the card belongs to (depending on the keyword status)
</li>
<li>card's identifier
</li>
<li>card's name
</li>
<li>card's due
</li>
</ul>

<p>
Then we create or update the card depending on the presence or not of the card identifier.
if card id present update else create.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--card</span> <span style="color: #006400;">(</span>card-meta <span style="color: #D8FA3C;">&amp;optional</span> parent-meta grandparent-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Deal with create/update card query build. If the checks are ko, the error mes</span><span style="color: #dc8cc3; background-color: #383838;">sage is returned."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>checks-ok-or-error-message <span style="color: #00ff00;">(</span>orgtrello/--checks-before-sync-card card-me<span style="color: #dc8cc3; background-color: #383838;">ta</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">title is mandatory</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>equal <span style="color: #FF6400;">:ok</span> checks-ok-or-error-message<span style="color: #ffff00;">)</span>
        <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">parent and grandparent are useless here</span>
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>orgtrello/--card-kwd  <span style="color: #ffa500;">(</span>orgtrello/--retrieve-state-of-card card-m<span style="color: #dc8cc3; background-color: #383838;">eta</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--list-id   <span style="color: #ffa500;">(</span>assoc-default orgtrello/--card-kwd org-fi<span style="color: #dc8cc3; background-color: #383838;">le-properties</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--card-id   <span style="color: #ffa500;">(</span>orgtrello/--id    card-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--card-name <span style="color: #ffa500;">(</span>orgtrello/--label card-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--card-due  <span style="color: #ffa500;">(</span>orgtrello/--due   card-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--card-id
              <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">update</span>
              <span style="color: #add8e6;">(</span>orgtrello-api/move-card orgtrello/--card-id orgtrello/--list-id o<span style="color: #dc8cc3; background-color: #383838;">rgtrello/--card-name orgtrello/--card-due</span><span style="color: #add8e6; background-color: #383838;">)</span>
            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">create</span>
            <span style="color: #add8e6;">(</span>orgtrello-api/add-card orgtrello/--card-name orgtrello/--list-id or<span style="color: #dc8cc3; background-color: #383838;">gtrello/--card-due</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
      checks-ok-or-error-message<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="sec-5-4-4-2-1-2" name="sec-5-4-4-2-1-2"></a>orgtrello/&#x2013;retrieve-state-of-card<br  /><div class="outline-text-7" id="text-5-4-4-2-1-2">
<p>
This function helps computes the status of the card.
If no status is present, TODO is assumed.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-retrieve-state-of-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--retrieve-state-of-card</span> <span style="color: #006400;">(</span>card-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a card, retrieve its state depending on its :keyword metadata. If empty</span><span style="color: #dc8cc3; background-color: #383838;"> or no keyword then, its equivalence is *TODO*, otherwise, return its current state."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--card-kwd <span style="color: #00ff00;">(</span>orgtrello/--keyword card-meta *TODO*<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--card-kwd orgtrello/--card-kwd *TODO*<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-5-4-4-2-1-3" name="sec-5-4-4-2-1-3"></a>orgtrello/&#x2013;checks-before-sync-card<br  /><div class="outline-text-7" id="text-5-4-4-2-1-3">
<p>
Does some basic checks. Typically, here only the name/title/label is mandatory.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-checks-before-sync-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--checks-before-sync-card</span> <span style="color: #006400;">(</span>card-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Checks done before synchronizing the cards."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--card-name <span style="color: #00ff00;">(</span>orgtrello/--label card-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--card-name
        <span style="color: #FF6400;">:ok</span>
      <span style="color: #61CE3C;">"Cannot synchronize the card - missing mandatory label. Skip it..."</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</li></ul>
</li>

<li><a id="sec-5-4-4-2-2" name="sec-5-4-4-2-2"></a>checklist<br  /><ul class="org-ul"><li><a id="sec-5-4-4-2-2-1" name="sec-5-4-4-2-2-1"></a>orgtrello/&#x2013;checklist<br  /><div class="outline-text-7" id="text-5-4-4-2-2-1">
<p>
The idea is similar than the card function.
First, checks using <i>orgtrello</i>&#x2013;checks-before-sync-checklist/ function.
If ok, continue otherwise return the error message.
Then extract the needed metadata:
</p>
<ul class="org-ul">
<li>checklist identifier (optional)
</li>
<li>card identifier (mandatory, a checklist belongs to a card)
</li>
<li>checklist name (mandatory)
</li>
</ul>
<p>
Again, if checklist identifier present, we update otherwise we create.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-checklist"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--checklist</span> <span style="color: #006400;">(</span>checklist-meta <span style="color: #D8FA3C;">&amp;optional</span> card-meta grandparent-met<span style="color: #dc8cc3; background-color: #383838;">a</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Deal with create/update checklist query build. If the checks are ko, the erro</span><span style="color: #dc8cc3; background-color: #383838;">r message is returned."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>checks-ok-or-error-message <span style="color: #00ff00;">(</span>orgtrello/--checks-before-sync-checklist ch<span style="color: #dc8cc3; background-color: #383838;">ecklist-meta card-meta</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">title is mandatory</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>equal <span style="color: #FF6400;">:ok</span> checks-ok-or-error-message<span style="color: #ffff00;">)</span>
        <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">grandparent is useless here</span>
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>orgtrello/--checklist-id   <span style="color: #ffa500;">(</span>orgtrello/--id checklist-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--card-id        <span style="color: #ffa500;">(</span>orgtrello/--id card-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--checklist-name <span style="color: #ffa500;">(</span>orgtrello/--label checklist-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--checklist-id
              <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">update</span>
              <span style="color: #add8e6;">(</span>orgtrello-api/update-checklist orgtrello/--checklist-id orgtrello<span style="color: #dc8cc3; background-color: #383838;">/--checklist-name</span><span style="color: #add8e6; background-color: #383838;">)</span>
            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">create</span>
            <span style="color: #add8e6;">(</span>orgtrello-api/add-checklist orgtrello/--card-id orgtrello/--checkli<span style="color: #dc8cc3; background-color: #383838;">st-name</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
      checks-ok-or-error-message<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="sec-5-4-4-2-2-2" name="sec-5-4-4-2-2-2"></a>orgtrello/&#x2013;checks-before-sync-checklist<br  /><div class="outline-text-7" id="text-5-4-4-2-2-2">
<p>
A little more complex check are done.
We need to ensure:
</p>
<ul class="org-ul">
<li>the card's id is present
</li>
<li>the checklist's name is present too.
</li>
</ul>
<p>
If some are missing, send the error message corresponding.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-checks-before-sync-checklist"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--checks-before-sync-checklist</span> <span style="color: #006400;">(</span>checklist-meta card-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Checks done before synchronizing the checklist."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--checklist-name <span style="color: #00ff00;">(</span>orgtrello/--label checklist-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span>orgtrello/--card-id        <span style="color: #00ff00;">(</span>orgtrello/--id card-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--checklist-name
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--card-id
            <span style="color: #FF6400;">:ok</span>
          <span style="color: #61CE3C;">"Cannot synchronize the checklist - the card must be synchronized firs</span><span style="color: #dc8cc3; background-color: #383838;">t. Skip it..."</span><span style="color: #ffff00; background-color: #383838;">)</span>
      <span style="color: #61CE3C;">"Cannot synchronize the checklist - missing mandatory label. Skip it..."</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</li></ul>
</li>

<li><a id="sec-5-4-4-2-3" name="sec-5-4-4-2-3"></a>task/item<br  /><ul class="org-ul"><li><a id="sec-5-4-4-2-3-1" name="sec-5-4-4-2-3-1"></a>orgtrello/&#x2013;task<br  /><div class="outline-text-7" id="text-5-4-4-2-3-1">
<p>
Update the task/item.
First checks.
If ok, continue otherwise return the error message.
Metadata extracted:
</p>
<ul class="org-ul">
<li>task/item's id (optional)
</li>
<li>checklist's id (mandatory)
</li>
<li>card's id (mandatory)
</li>
<li>task/item's name (mandatory)
</li>
<li>checklist's state (trello api distinguish between the state at update time from the check status at creation time)
</li>
<li>checklist's check status
</li>
</ul>

<p>
Depending on the presence of the task/item's identifier, we update or create.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-task"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--task</span> <span style="color: #006400;">(</span>task-meta <span style="color: #D8FA3C;">&amp;optional</span> checklist-meta card-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Deal with create/update task query build. If the checks are ko, the error mes</span><span style="color: #dc8cc3; background-color: #383838;">sage is returned."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>checks-ok-or-error-message <span style="color: #00ff00;">(</span>orgtrello/--checks-before-sync-item task-me<span style="color: #dc8cc3; background-color: #383838;">ta checklist-meta card-meta</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">title is mandatory</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>equal <span style="color: #FF6400;">:ok</span> checks-ok-or-error-message<span style="color: #ffff00;">)</span>
        <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">card-meta is only usefull for the update part</span>
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>orgtrello/--task-id      <span style="color: #ffa500;">(</span>orgtrello/--id task-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--checklist-id <span style="color: #ffa500;">(</span>orgtrello/--id checklist-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--card-id      <span style="color: #ffa500;">(</span>orgtrello/--id card-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--task-name    <span style="color: #ffa500;">(</span>orgtrello/--label task-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--task-state   <span style="color: #ffa500;">(</span>orgtrello/--keyword task-meta<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>orgtrello/--checklist-state    <span style="color: #ffa500;">(</span>orgtrello/--keyword checklist-me<span style="color: #dc8cc3; background-color: #383838;">ta</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>

          <span style="color: #00ff00;">(</span>orgtrello/--update-item-according-to-checklist-status *ORGTRELLO-CHEC<span style="color: #dc8cc3; background-color: #383838;">KLIST-UPDATE-ITEMS* checklist-meta</span><span style="color: #00ff00; background-color: #383838;">)</span>
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">update/create items</span>
          <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--task-id
              <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">update - rename, check or uncheck the task</span>
              <span style="color: #add8e6;">(</span>orgtrello-api/update-task orgtrello/--card-id orgtrello/--checkli<span style="color: #dc8cc3; background-color: #383838;">st-id orgtrello/--task-id orgtrello/--task-name </span><span style="color: #ffa500; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">orgtrello/--task-compute-state *ORGTRELLO-CHECKLIST-UPDATE-ITEMS* orgtrello/--task-state orgtrello/--checklist-state</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span>
            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">create</span>
            <span style="color: #add8e6;">(</span>orgtrello-api/add-tasks orgtrello/--checklist-id orgtrello/--task-n<span style="color: #dc8cc3; background-color: #383838;">ame </span><span style="color: #ffa500; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">orgtrello/--task-compute-check *ORGTRELLO-CHECKLIST-UPDATE-ITEMS* orgtrello/--task-state orgtrello/--checklist-state</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
      checks-ok-or-error-message<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>

<p>
Also, there is a sublety.
<b>ORGTRELLO-CHECKLIST-UPDATE-ITEMS</b> is a global setup that permits the override of the task/item's status (checked or not).
if <b>ORGTRELLO-CHECKLIST-UPDATE-ITEMS</b> is set to 't, this will override such setup.
Otherwise, the item's status is computed depending on org's keyword.
This means that if <b>ORGTRELLO-CHECKLIST-UPDATE-ITEMS</b> is 't, we need to update the buffer accordingly to such status since this will be synchronized on trello.
That's the responsibility of the function <i>orgtrello</i>&#x2013;update-item-according-to-checklist-status/.
</p>
</div>
</li>

<li><a id="sec-5-4-4-2-3-2" name="sec-5-4-4-2-3-2"></a>orgtrello/&#x2013;checks-before-sync-item<br  /><div class="outline-text-7" id="text-5-4-4-2-3-2">
<p>
The control function which ensures:
</p>
<ul class="org-ul">
<li>task/item's id
</li>
<li>checklist's id
</li>
<li>card's id
</li>
</ul>
<p>
are presents.
If some are missing, the corresponding error message is sent, :ok otherwise.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-checks-before-sync-item"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--checks-before-sync-item</span> <span style="color: #006400;">(</span>task-meta checklist-meta card-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Checks done before synchronizing the checklist."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--task-name    <span style="color: #00ff00;">(</span>orgtrello/--label task-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span>orgtrello/--checklist-id <span style="color: #00ff00;">(</span>orgtrello/--id checklist-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span>orgtrello/--card-id      <span style="color: #00ff00;">(</span>orgtrello/--id card-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--task-name
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--checklist-id
            <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--card-id
                <span style="color: #FF6400;">:ok</span>
              <span style="color: #61CE3C;">"Cannot synchronize the item - the card must be synchronized first</span><span style="color: #dc8cc3; background-color: #383838;">. Skip it..."</span><span style="color: #00ff00; background-color: #383838;">)</span>
          <span style="color: #61CE3C;">"Cannot synchronize the item - the checklist must be synchronized firs</span><span style="color: #dc8cc3; background-color: #383838;">t. Skip it..."</span><span style="color: #ffff00; background-color: #383838;">)</span>
      <span style="color: #61CE3C;">"Cannot synchronize the item - missing mandatory label. Skip it..."</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-5-4-4-2-3-3" name="sec-5-4-4-2-3-3"></a>orgtrello/&#x2013;task-compute-state-or-check<br  /><div class="outline-text-7" id="text-5-4-4-2-3-3">
<p>
An HOF (higher order function) that captures the computation of the state (update) or the check (create) of an item/task.
</p>
<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-task-compute-state-or-check"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--task-compute-state-or-check</span> <span style="color: #006400;">(</span>checklist-update-items-p task-st<span style="color: #dc8cc3; background-color: #383838;">ate checklist-state possible-states</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Compute the task's state/check (for creation/update). The 2 possible states a</span><span style="color: #dc8cc3; background-color: #383838;">re in the list possible states, first position is the 'checked' one, and second the unchecked one."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--task-checked   <span style="color: #00ff00;">(</span>first possible-states<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello/--task-unchecked <span style="color: #00ff00;">(</span>second possible-states<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">cond</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>and checklist-update-items-p <span style="color: #add8e6;">(</span>string= *DONE* checklist-state<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>      <span style="color: #dc8cc3; background-color: #383838;">                orgtrello/--task-checked</span><span style="color: #ffff00; background-color: #383838;">)</span>
          <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>and checklist-update-items-p <span style="color: #add8e6;">(</span>or checklist-state <span style="color: #ffa500;">(</span>string= *TODO* che<span style="color: #dc8cc3; background-color: #383838;">cklist-state</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> orgtrello/--task-unchecked</span><span style="color: #ffff00; background-color: #383838;">)</span>
          <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>string= *DONE* task-state<span style="color: #00ff00;">)</span>                                          <span style="color: #dc8cc3; background-color: #383838;">                orgtrello/--task-checked</span><span style="color: #ffff00; background-color: #383838;">)</span>
          <span style="color: #ffff00;">(</span>t                                                                    <span style="color: #dc8cc3; background-color: #383838;">                orgtrello/--task-unchecked</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-5-4-4-2-3-4" name="sec-5-4-4-2-3-4"></a>orgtrello/&#x2013;task-compute-state<br  /><div class="outline-text-7" id="text-5-4-4-2-3-4">
<p>
A function to compute the state (update) of the task/item:
</p>
<ul class="org-ul">
<li>complete
</li>
<li>incomplete
</li>
</ul>

<p>
There is a subtlety here.
<i>checklist-update-items-p</i> represents a global setup to make the checklist's status more important than the current item/task's status.
</p>

<p>
Here is the truth table:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">checklist-update-items-p</th>
<th scope="col" class="left">checklist's status</th>
<th scope="col" class="left">task/item's status</th>
<th scope="col" class="left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">t</td>
<td class="left">c-st</td>
<td class="left">X</td>
<td class="left">(= c-st <b>DONE</b> "complete" "incomplete")</td>
</tr>

<tr>
<td class="left">nil</td>
<td class="left">X</td>
<td class="left">t-st</td>
<td class="left">(= t-st <b>DONE</b> "complete" "incomplete")</td>
</tr>
</tbody>
</table>
<p>
n
</p>
<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-task-compute-state"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--task-compute-state</span> <span style="color: #006400;">(</span>checklist-update-items-p task-state check<span style="color: #dc8cc3; background-color: #383838;">list-state</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Compute the task's state (for creation)."</span>
  <span style="color: #006400;">(</span>orgtrello/--task-compute-state-or-check checklist-update-items-p task-state c<span style="color: #dc8cc3; background-color: #383838;">hecklist-state '</span><span style="color: #ff1493; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">"complete"</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #dc8cc3; background-color: #383838;">"incomplete"</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-5-4-4-2-3-5" name="sec-5-4-4-2-3-5"></a>orgtrello/&#x2013;task-compute-check<br  /><div class="outline-text-7" id="text-5-4-4-2-3-5">
<p>
A function to compute the check status of the task/item:
</p>
<ul class="org-ul">
<li>t
</li>
<li>nil
</li>
</ul>

<p>
There is a subtlety here.
<i>checklist-update-items-p</i> represents a global setup to make the checklist's status more important than the current item/task's status.
</p>

<p>
Here is the truth table:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">checklist-update-items-p</th>
<th scope="col" class="left">checklist's status</th>
<th scope="col" class="left">task/item's check status</th>
<th scope="col" class="left">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">t</td>
<td class="left">c-st</td>
<td class="left">X</td>
<td class="left">(= c-st <b>DONE</b> t nil)</td>
</tr>

<tr>
<td class="left">nil</td>
<td class="left">X</td>
<td class="left">t-st</td>
<td class="left">(= t-st <b>DONE</b> t nil)</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-task-compute-check"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--task-compute-check</span> <span style="color: #006400;">(</span>checklist-update-items-p task-state check<span style="color: #dc8cc3; background-color: #383838;">list-state</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Compute the task's check status (for update)."</span>
    <span style="color: #006400;">(</span>orgtrello/--task-compute-state-or-check checklist-update-items-p task-state<span style="color: #dc8cc3; background-color: #383838;"> checklist-state '</span><span style="color: #ff1493; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">t nil</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-5-4-4-2-3-6" name="sec-5-4-4-2-3-6"></a>orgtrello/&#x2013;update-item-according-to-checklist-status<br  /><div class="outline-text-7" id="text-5-4-4-2-3-6">
<p>
This is a function, depending on <i>checklist-update-items-p</i>, which is in charge of aligning the status of the keyword in the org buffer according to the checklist's keyword.
if <i>checklist-update-items-p</i> is 't, then update else does nothing.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-update-item-according-to-checklist-status"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--update-item-according-to-checklist-status</span> <span style="color: #006400;">(</span>checklist-update-i<span style="color: #dc8cc3; background-color: #383838;">tems-p checklist-meta</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Update the item of the checklist according to the status of the checklist."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">if</span> checklist-update-items-p
      <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>orgtrello/--checklist-status <span style="color: #add8e6;">(</span>orgtrello/--compute-state-from-keywor<span style="color: #dc8cc3; background-color: #383838;">d </span><span style="color: #ffa500; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">orgtrello/--keyword checklist-meta</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
        <span style="color: #ffff00;">(</span>org-todo orgtrello/--checklist-status<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</li>

<li><a id="sec-5-4-4-2-3-7" name="sec-5-4-4-2-3-7"></a>orgtrello/&#x2013;compute-state-from-keyword<br  /><div class="outline-text-7" id="text-5-4-4-2-3-7">
<p>
Given a state, compute its org equivalent:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">state</th>
<th scope="col" class="left">org</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">nil</td>
<td class="left">""</td>
</tr>

<tr>
<td class="left">""</td>
<td class="left">""</td>
</tr>

<tr>
<td class="left"><b>DONE</b></td>
<td class="left"><b>DONE</b></td>
</tr>

<tr>
<td class="left"><b>TODO</b></td>
<td class="left"><b>TODO</b></td>
</tr>

<tr>
<td class="left">Otherwise</td>
<td class="left"><b>TODO</b></td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-compute-state-from-keyword"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--compute-state-from-keyword</span> <span style="color: #006400;">(</span>state<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a state, compute the org equivalent (to use with org-todo function)"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">cond</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>or <span style="color: #00ff00;">(</span>not state<span style="color: #00ff00;">)</span> <span style="color: #00ff00;">(</span>string= <span style="color: #61CE3C;">""</span> state<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span> *TODO*<span style="color: #ff1493;">)</span>
        <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>string= *DONE* state<span style="color: #ffff00;">)</span>              'done<span style="color: #ff1493;">)</span>
        <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>string= *TODO* state<span style="color: #ffff00;">)</span>              *TODO*<span style="color: #ff1493;">)</span>
        <span style="color: #ff1493;">(</span>t                                   *TODO*<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</li></ul>
</li></ul>
</div>

<div id="outline-container-sec-5-4-4-3" class="outline-5">
<h5 id="sec-5-4-4-3">orgtrello/&#x2013;too-deep-level</h5>
<div class="outline-text-5" id="text-5-4-4-3">
<p>
A function which simply displays that the arborescence depth is too deep.
We only deal with 3 levels (1 -&gt; card, 2 -&gt; checklist, 3 -&gt; item/task).
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-too-deep-level"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--too-deep-level</span> <span style="color: #006400;">(</span>meta <span style="color: #D8FA3C;">&amp;optional</span> parent-meta grandparent-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Deal with too deep level."</span>
  <span style="color: #61CE3C;">"Your arborescence depth is too deep. We only support up to depth 3.\nLevel 1 </span><span style="color: #dc8cc3; background-color: #383838;">- card\nLevel 2 - checklist\nLevel 3 - items/tasks"</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-4-4" class="outline-5">
<h5 id="sec-5-4-4-4">orgtrello/&#x2013;dispatch-map-creation</h5>
<div class="outline-text-5" id="text-5-4-4-4">
<p>
An initialization of the dispatch creation/update function depending on the level (1, 2, 3).
We use this function to initialize once the <b>MAP-DISPATCH-CREATE-UPDATE</b> which will be use to dispatch on the level of the entity to sync.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-dispatch-map-creation"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--dispatch-map-creation</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Dispatch map for the creation of card/checklist/item."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>dispatch-map <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash 1 'orgtrello/--card      dispatch-map<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash 2 'orgtrello/--checklist dispatch-map<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash 3 'orgtrello/--task      dispatch-map<span style="color: #ff1493;">)</span>
    dispatch-map<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*MAP-DISPATCH-CREATE-UPDATE*</span> <span style="color: #006400;">(</span>orgtrello/--dispatch-map-creation<span style="color: #006400;">)</span> <span style="color: #61CE3C;">"Dispat</span><span style="color: #dc8cc3; background-color: #383838;">ch map for the creation/update of card/checklist/task"</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-4-5" class="outline-5">
<h5 id="sec-5-4-4-5">orgtrello/&#x2013;set-marker</h5>
<div class="outline-text-5" id="text-5-4-4-5">
<p>
A simple routine to install an orgtrello-marker before launching any synchronization.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-set-marker"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--set-marker</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Set the consumer-key to make a pointer to get back to when the request is fin</span><span style="color: #dc8cc3; background-color: #383838;">ished"</span>
  <span style="color: #006400;">(</span>org-set-property *ORGTRELLO-MARKER* *ORGTRELLO-MARKER*<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-4-6" class="outline-5">
<h5 id="sec-5-4-4-6">orgtrello/&#x2013;dispatch-create</h5>
<div class="outline-text-5" id="text-5-4-4-6">
<p>
The function which will extract the current level of the entity and call the function to generate the create/update request for the current entity.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-dispatch-create"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--dispatch-create</span> <span style="color: #006400;">(</span>meta <span style="color: #D8FA3C;">&amp;optional</span> parent-meta grandparent-meta<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>level       <span style="color: #00ff00;">(</span>orgtrello/--level meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>dispatch-fn <span style="color: #00ff00;">(</span>gethash level *MAP-DISPATCH-CREATE-UPDATE* 'orgtrello/--t<span style="color: #dc8cc3; background-color: #383838;">oo-deep-level</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">then execute the call</span>
    <span style="color: #ff1493;">(</span>funcall dispatch-fn meta parent-meta grandparent-meta<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-5" class="outline-4">
<h4 id="sec-5-4-5">Create complex entity</h4>
<div class="outline-text-4" id="text-5-4-5">
</div><div id="outline-container-sec-5-4-5-1" class="outline-5">
<h5 id="sec-5-4-5-1">orgtrello/&#x2013;board-name</h5>
<div class="outline-text-5" id="text-5-4-5-1">
<p>
Extract the board name from the org buffer's metadata.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-board-name"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--board-name</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Compute the board's name"</span>
  <span style="color: #006400;">(</span>assoc-default *BOARD-NAME* org-file-properties<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-5-2" class="outline-5">
<h5 id="sec-5-4-5-2">orgtrello/do-create-complex-entity</h5>
<div class="outline-text-5" id="text-5-4-5-2">
<p>
The main function in charge of synchronizing the entity (with its arborescence):
</p>
<ul class="org-ul">
<li>Get back to the upper level of the current entry
</li>
<li>Map over the full arborescence (in order) and sync the entity (using the primitive <i>orgtrello/do-create-simple-entity</i>)
</li>
<li>Return a success message
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-create-complex-entity"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-create-complex-entity</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Do the actual full card creation - from card to task. Beware full side effect</span><span style="color: #dc8cc3; background-color: #383838;">s..."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--board-name-to-sync <span style="color: #00ff00;">(</span>orgtrello/--board-name<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>message <span style="color: #61CE3C;">"Synchronizing full entity with its structure on board '%s'..."</span> org<span style="color: #dc8cc3; background-color: #383838;">trello/--board-name-to-sync</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span>save-excursion
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">iterate over the map of</span>
      <span style="color: #ffff00;">(</span>org-map-tree <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #add8e6;">()</span> <span style="color: #add8e6;">(</span>orgtrello/do-create-simple-entity t<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"Synchronizing full entity with its structure on board '%s' - done"</span> <span style="color: #dc8cc3; background-color: #383838;">orgtrello/--board-name-to-sync</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-6" class="outline-4">
<h4 id="sec-5-4-6">Synchronize full org buffer to trello</h4>
<div class="outline-text-4" id="text-5-4-6">
<p>
Synchronize the full org file to the trello board.
The idea is to send all the cards presents in the buffer to the trello board (no merge, org buffer has all the rights here).
At the end, return a success message.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-sync-full-file"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-sync-full-file</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Full org-mode file synchronisation. Beware, this will block emacs as the requ</span><span style="color: #dc8cc3; background-color: #383838;">est is synchronous."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--board-name-to-sync <span style="color: #00ff00;">(</span>orgtrello/--board-name<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>message <span style="color: #61CE3C;">"Synchronizing org-mode file to the board '%s'. This may take some </span><span style="color: #dc8cc3; background-color: #383838;">time, some coffee may be a good idea..."</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffff00; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">orgtrello/--board-name</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span>org-map-entries <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #00ff00;">()</span> <span style="color: #00ff00;">(</span>orgtrello/do-create-simple-entity t<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span> t 'file<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"Synchronizing org-mode file to the board '%s' - done!"</span> orgtrello/--<span style="color: #dc8cc3; background-color: #383838;">board-name-to-sync</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7" class="outline-4">
<h4 id="sec-5-4-7">Synchronize full org buffer from trello</h4>
<div class="outline-text-4" id="text-5-4-7">
<p>
Synchronize the full org file from the trello board.
The idea is to compute all the trello cards from trello.
Map over the current org buffer, synchronize from trello (no merge, trello has all power here) and overwrite the trello data for each entry.
Each data remaining not already present on the buffer are then dumped in the current buffer.
</p>
</div>

<div id="outline-container-sec-5-4-7-1" class="outline-5">
<h5 id="sec-5-4-7-1">orgtrello/do-sync-full-from-trello</h5>
<div class="outline-text-5" id="text-5-4-7-1">
<p>
Main function:
</p>
<ul class="org-ul">
<li>retrieve the board id from the org metadata
</li>
<li>compute the cards from the trello board
</li>
<li>synchronize all the entities present on the buffer with the data from trello (remove them as soon as they are synced)
</li>
<li>synchronize all the remaining entities into the current buffer
</li>
<li>return a successfull message
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-sync-full-from-trello"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-sync-full-from-trello</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Full org-mode file synchronisation. Beware, this will block emacs as the requ</span><span style="color: #dc8cc3; background-color: #383838;">est is synchronous."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--board-name-to-sync <span style="color: #00ff00;">(</span>orgtrello/--board-name<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>message <span style="color: #61CE3C;">"Synchronizing the trello board '%s' to the org-mode file. This may</span><span style="color: #dc8cc3; background-color: #383838;"> take a moment, some coffee may be a good idea..."</span><span style="color: #dc8cc3; background-color: #383838;"> orgtrello/--board-name-to-sync</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>orgtrello/--board-id           <span style="color: #add8e6;">(</span>assoc-default *BOARD-ID* org-file-pr<span style="color: #dc8cc3; background-color: #383838;">operties</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
           <span style="color: #00ff00;">(</span>orgtrello/--cards              <span style="color: #add8e6;">(</span>orgtrello-query/http <span style="color: #ffa500;">(</span>orgtrello-api/<span style="color: #dc8cc3; background-color: #383838;">get-cards orgtrello/--board-id</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> t</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
           <span style="color: #00ff00;">(</span>orgtrello/--entities-hash-map  <span style="color: #add8e6;">(</span>orgtrello/--compute-full-entities-fr<span style="color: #dc8cc3; background-color: #383838;">om-trello orgtrello/--cards</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
           <span style="color: #00ff00;">(</span>orgtrello/--remaining-entities <span style="color: #add8e6;">(</span>orgtrello/--sync-buffer-with-trello-<span style="color: #dc8cc3; background-color: #383838;">data orgtrello/--entities-hash-map</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
      <span style="color: #ffff00;">(</span>orgtrello/--update-buffer-with-remaining-trello-data orgtrello/--remainin<span style="color: #dc8cc3; background-color: #383838;">g-entities</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"Synchronizing the trello board '%s' to the org-mode file - done!"</span> o<span style="color: #dc8cc3; background-color: #383838;">rgtrello/--board-name-to-sync</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-2" class="outline-5">
<h5 id="sec-5-4-7-2">orgtrello/&#x2013;sync-buffer-with-trello-data</h5>
<div class="outline-text-5" id="text-5-4-7-2">
<p>
Given a map of entities to sync, update each entry with such data.
After each entry update, the entity is removed.
Return the map of entities with the sync entry removed.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-sync-buffer-with-trello-data"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--sync-buffer-with-trello-data</span> <span style="color: #006400;">(</span>entities<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given all the entities, update the current buffer with those."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">with-current-buffer</span> <span style="color: #ff1493;">(</span>current-buffer<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>org-map-entries
     <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #00ff00;">()</span>
       <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span>entry-metadata <span style="color: #6a5acd;">(</span>orgtrello-data/entry-get-full-metadata<span style="color: #6a5acd;">)</span><span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
         <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">if</span> entry-metadata <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">if level &gt; 4, entry-metadata is not considered as</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;"> this is not represented in trello board</span>
             <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">will search 'entities' hash table for updates (do not compute di</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">ffs, take them as is)</span>
             <span style="color: #ffa500;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #6a5acd;">(</span><span style="color: #d3d3d3;">(</span>orgtrello/--entity         <span style="color: #8b0000;">(</span>gethash <span style="color: #FF6400;">:current</span> entry-metadata<span style="color: #8b0000; background-color: #383838;">)</span><span style="color: #d3d3d3; background-color: #383838;">)</span>
                    <span style="color: #d3d3d3;">(</span>orgtrello/--entity-id      <span style="color: #8b0000;">(</span>orgtrello/--id orgtrello/--enti<span style="color: #dc8cc3; background-color: #383838;">ty</span><span style="color: #8b0000; background-color: #383838;">)</span><span style="color: #d3d3d3; background-color: #383838;">)</span>
                    <span style="color: #d3d3d3;">(</span>orgtrello/--entity-updated <span style="color: #8b0000;">(</span>gethash orgtrello/--entity-id e<span style="color: #dc8cc3; background-color: #383838;">ntities</span><span style="color: #8b0000; background-color: #383838;">)</span><span style="color: #d3d3d3; background-color: #383838;">)</span><span style="color: #6a5acd; background-color: #383838;">)</span>
               <span style="color: #6a5acd;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--entity-updated
                   <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">found something, we update by squashing the current conten</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">ts</span>
                   <span style="color: #d3d3d3;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #8b0000;">(</span><span style="color: #006400;">(</span>orgtrello/--entry-new-id    <span style="color: #ff1493;">(</span>orgtrello-query/--id   o<span style="color: #dc8cc3; background-color: #383838;">rgtrello/--entity-updated</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span>
                          <span style="color: #006400;">(</span>orgtrello/--entity-due-date <span style="color: #ff1493;">(</span>orgtrello-query/--due  o<span style="color: #dc8cc3; background-color: #383838;">rgtrello/--entity-updated</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span>
                          <span style="color: #006400;">(</span>orgtrello/--entry-new-name  <span style="color: #ff1493;">(</span>orgtrello-query/--name o<span style="color: #dc8cc3; background-color: #383838;">rgtrello/--entity-updated</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
                     <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">update the buffer with the new updates (there may be non</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">e but naively we will overwrite at the moment)</span>
                     <span style="color: #8b0000;">(</span>message <span style="color: #61CE3C;">"Synchronizing entity '%s' with id '%s'..."</span> orgtre<span style="color: #dc8cc3; background-color: #383838;">llo/--entry-new-name orgtrello/--entry-new-id</span><span style="color: #8b0000; background-color: #383838;">)</span>
                     <span style="color: #8b0000;">(</span>org-show-entry<span style="color: #8b0000;">)</span>
                     <span style="color: #8b0000;">(</span>kill-whole-line<span style="color: #8b0000;">)</span>
                     <span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--entity-due-date <span style="color: #006400;">(</span>kill-whole-line<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
                     <span style="color: #8b0000;">(</span>insert <span style="color: #006400;">(</span>orgtrello/--compute-entity-to-org-entry orgtrello/<span style="color: #dc8cc3; background-color: #383838;">--entity-updated</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
                     <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">remove the entry from the hash-table</span>
                     <span style="color: #8b0000;">(</span>remhash orgtrello/--entity-id entities<span style="color: #8b0000;">)</span><span style="color: #d3d3d3;">)</span><span style="color: #6a5acd;">)</span><span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
     t
     'file<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">return the entities which has been dryed</span>
  entities<span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-3" class="outline-5">
<h5 id="sec-5-4-7-3">orgtrello/&#x2013;update-buffer-with-remaining-trello-data</h5>
<div class="outline-text-5" id="text-5-4-7-3">
<p>
Given a map of entities:
</p>
<ul class="org-ul">
<li>goes at the end of the file
</li>
<li>add the entities present on such map in the org format
</li>
<li>return at the beginning of the file
</li>
<li>sort all the buffer on the org todo keywords order (only the first level -&gt; card).
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-update-buffer-with-remaining-trello-data"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--update-buffer-with-remaining-trello-data</span> <span style="color: #006400;">(</span>entities<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a map of entities, dump those entities in the current buffer."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">if</span> entities <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">could be empty</span>
      <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">with-current-buffer</span> <span style="color: #ffff00;">(</span>current-buffer<span style="color: #ffff00;">)</span>
        <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">go at the end of the file</span>
        <span style="color: #ffff00;">(</span>goto-char <span style="color: #00ff00;">(</span>point-max<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
        <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">dump the remaining entities</span>
        <span style="color: #ffff00;">(</span>maphash
         <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #add8e6;">(</span>orgtrello/--entry-new-id orgtrello/--entity<span style="color: #add8e6;">)</span>
           <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ffa500;">(</span><span style="color: #6a5acd;">(</span>orgtrello/--entry-new-name  <span style="color: #d3d3d3;">(</span>orgtrello-query/--name orgtrello/<span style="color: #dc8cc3; background-color: #383838;">--entity</span><span style="color: #d3d3d3; background-color: #383838;">)</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #ffa500; background-color: #383838;">)</span>
             <span style="color: #ffa500;">(</span>message <span style="color: #61CE3C;">"Synchronizing new entity '%s' with id '%s'..."</span> orgtrello/<span style="color: #dc8cc3; background-color: #383838;">--entry-new-name orgtrello/--entry-new-id</span><span style="color: #ffa500; background-color: #383838;">)</span>
             <span style="color: #ffa500;">(</span>insert <span style="color: #6a5acd;">(</span>orgtrello/--compute-entity-to-org-entry orgtrello/--entity<span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #ffa500; background-color: #383838;">)</span>
             <span style="color: #ffa500;">(</span>org-set-property *ORGTRELLO-ID* orgtrello/--entry-new-id<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>
         entities<span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span>goto-char <span style="color: #00ff00;">(</span>point-min<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span>org-sort-entries t ?o<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-4" class="outline-5">
<h5 id="sec-5-4-7-4">orgtrello/&#x2013;compute-card-status</h5>
<div class="outline-text-5" id="text-5-4-7-4">
<p>
Given a card list id (which represent an org keyword), compute the keywords (this works with the metadata of the file).
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-compute-card-status"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--compute-card-status</span> <span style="color: #006400;">(</span>card-id-list<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a card's id, compute its status."</span>
  <span style="color: #006400;">(</span>gethash card-id-list *HMAP-ID-NAME*<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-5" class="outline-5">
<h5 id="sec-5-4-7-5">orgtrello/&#x2013;compute-card-to-org-entry</h5>
<div class="outline-text-5" id="text-5-4-7-5">
<p>
Given an entry which represents a card, compute its equivalent org format.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-compute-card-to-org-entry"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--compute-card-to-org-entry</span> <span style="color: #006400;">(</span>card<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a card, compute its org-mode entry equivalence."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--card-name     <span style="color: #00ff00;">(</span>orgtrello-query/--name card<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello/--card-status   <span style="color: #00ff00;">(</span>orgtrello/--compute-card-status <span style="color: #add8e6;">(</span>orgtrello-<span style="color: #dc8cc3; background-color: #383838;">query/--list-id card</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello/--card-due-date <span style="color: #00ff00;">(</span>orgtrello-query/--due card<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"* %s %s\n%s"</span> orgtrello/--card-status orgtrello/--card-name
            <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello/--card-due-date <span style="color: #00ff00;">(</span>format <span style="color: #61CE3C;">"DEADLINE: &lt;%s&gt;\n"</span> orgtrello/-<span style="color: #dc8cc3; background-color: #383838;">-card-due-date</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #dc8cc3; background-color: #383838;">""</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-6" class="outline-5">
<h5 id="sec-5-4-7-6">orgtrello/&#x2013;compute-checklist-to-org-entry</h5>
<div class="outline-text-5" id="text-5-4-7-6">
<p>
Given an entry which represents a checklist, compute its equivalent org format.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-compute-checklist-to-org-entry"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--compute-checklist-to-org-entry</span> <span style="color: #006400;">(</span>checklist<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a checklist, compute its org-mode entry equivalence."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--checklist-name  <span style="color: #00ff00;">(</span>orgtrello-query/--name checklist<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"** %s\n"</span> orgtrello/--checklist-name<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-7" class="outline-5">
<h5 id="sec-5-4-7-7">orgtrello/&#x2013;compute-item-to-org-entry</h5>
<div class="outline-text-5" id="text-5-4-7-7">
<p>
Given an entry which represents an item/task, compute its equivalent org format.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-compute-item-to-org-entry"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--compute-item-to-org-entry</span> <span style="color: #006400;">(</span>item<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a checklist item, compute its org-mode entry equivalence."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--item-name  <span style="color: #00ff00;">(</span>orgtrello-query/--name  item<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello/--item-state <span style="color: #00ff00;">(</span>orgtrello-query/--state item<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"*** %s %s\n"</span>
            <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #00ff00;">(</span>string= <span style="color: #61CE3C;">"complete"</span> orgtrello/--item-state<span style="color: #00ff00;">)</span> *DONE* *TODO*<span style="color: #ffff00;">)</span>
            orgtrello/--item-name<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-8" class="outline-5">
<h5 id="sec-5-4-7-8">orgtrello/&#x2013;compute-entity-to-org-entry</h5>
<div class="outline-text-5" id="text-5-4-7-8">
<p>
Given an entry, determine according to its structure the nature of such entity:
</p>
<ul class="org-ul">
<li>list-id, it's a card
</li>
<li>card-id, it's a checklist
</li>
<li>state, it's an item/task
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-compute-entity-to-org-entry"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--compute-entity-to-org-entry</span> <span style="color: #006400;">(</span>entity<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given an entity, compute its org representation."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">cond</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello-query/--list-id entity<span style="color: #ffff00;">)</span> <span style="color: #ffff00;">(</span>orgtrello/--compute-card-to-org-ent<span style="color: #dc8cc3; background-color: #383838;">ry entity</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;">           </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">;; </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">card      (level 1)</span>
        <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello-query/--card-id entity<span style="color: #ffff00;">)</span> <span style="color: #ffff00;">(</span>orgtrello/--compute-checklist-to-or<span style="color: #dc8cc3; background-color: #383838;">g-entry entity</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;">      </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">;; </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">checklist (level 2)</span>
        <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello-query/--state entity<span style="color: #ffff00;">)</span>  <span style="color: #ffff00;">(</span>orgtrello/--compute-item-to-org-entr<span style="color: #dc8cc3; background-color: #383838;">y entity</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;">          </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">;; </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">items     (level 3)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-9" class="outline-5">
<h5 id="sec-5-4-7-9">orgtrello/&#x2013;do-retrieve-checklists-from-card</h5>
<div class="outline-text-5" id="text-5-4-7-9">
<p>
Given a card, retrieve its full checklist and return a list composed of the card cons'ed to such entities.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-do-retrieve-checklists-from-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--do-retrieve-checklists-from-card</span> <span style="color: #006400;">(</span>card<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a card, return the list containing the card, the checklists from this c</span><span style="color: #dc8cc3; background-color: #383838;">ard, and the items from the checklists. The order is guaranted."</span>
  <span style="color: #006400;">(</span>cl-reduce
   <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">(</span>acc-list checklist-id<span style="color: #ffff00;">)</span>
     <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>orgtrello/--checklist <span style="color: #ffa500;">(</span>orgtrello-query/http <span style="color: #6a5acd;">(</span>orgtrello-api/get-check<span style="color: #dc8cc3; background-color: #383838;">list checklist-id</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> t</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
       <span style="color: #00ff00;">(</span>append <span style="color: #add8e6;">(</span>cons orgtrello/--checklist <span style="color: #ffa500;">(</span>orgtrello/--do-retrieve-checklists-a<span style="color: #dc8cc3; background-color: #383838;">nd-items orgtrello/--checklist</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> acc-list</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
   <span style="color: #ff1493;">(</span>orgtrello-query/--checklist-ids card<span style="color: #ff1493;">)</span>
   <span style="color: #FF6400;">:initial-value</span> nil<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-10" class="outline-5">
<h5 id="sec-5-4-7-10">orgtrello/&#x2013;do-retrieve-checklists-and-items</h5>
<div class="outline-text-5" id="text-5-4-7-10">
<p>
Given a checklist, retrieve its full items/tasks and return a list composed of the checklist cons'ed to such entities.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-do-retrieve-checklists-and-items"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--do-retrieve-checklists-and-items</span> <span style="color: #006400;">(</span>checklist<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a checklist id, retrieve all the items from the checklist and return a </span><span style="color: #dc8cc3; background-color: #383838;">list containing first the checklist, then the items."</span>
  <span style="color: #006400;">(</span>--map it <span style="color: #ff1493;">(</span>orgtrello-query/--check-items checklist<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7-11" class="outline-5">
<h5 id="sec-5-4-7-11">orgtrello/&#x2013;compute-full-entities-from-trello</h5>
<div class="outline-text-5" id="text-5-4-7-11">
<p>
Given a list of cards, retrieve the full arborescence of such cards (computing their checklists and items/tasks) and return a map of entities.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-compute-full-entities-from-trello"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--compute-full-entities-from-trello</span> <span style="color: #006400;">(</span>cards<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a list of cards, compute the full cards data from the trello boards. Th</span><span style="color: #dc8cc3; background-color: #383838;">e order from the trello board is now kept."</span>
  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">will compute the hash-table of entities (id, entity)</span>
  <span style="color: #006400;">(</span>cl-reduce
   <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">(</span>orgtrello/--acc-hash orgtrello/--entity-card<span style="color: #ffff00;">)</span>
     <span style="color: #ffff00;">(</span>message <span style="color: #61CE3C;">"Computing card '%s' data..."</span> <span style="color: #00ff00;">(</span>orgtrello-query/--name orgtrello/--<span style="color: #dc8cc3; background-color: #383838;">entity-card</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
     <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">adding the entity card</span>
     <span style="color: #ffff00;">(</span>puthash <span style="color: #00ff00;">(</span>orgtrello-query/--id orgtrello/--entity-card<span style="color: #00ff00;">)</span> orgtrello/--entity-<span style="color: #dc8cc3; background-color: #383838;">card orgtrello/--acc-hash</span><span style="color: #ffff00; background-color: #383838;">)</span>
     <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">fill in the other remaining entities (checklist/items)</span>
     <span style="color: #ffff00;">(</span>mapc
      <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #add8e6;">(</span>it<span style="color: #add8e6;">)</span>
        <span style="color: #add8e6;">(</span>puthash <span style="color: #ffa500;">(</span>orgtrello-query/--id it<span style="color: #ffa500;">)</span> it orgtrello/--acc-hash<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>
      <span style="color: #00ff00;">(</span>orgtrello/--do-retrieve-checklists-from-card orgtrello/--entity-card<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
     orgtrello/--acc-hash<span style="color: #ff1493;">)</span>
   cards
   <span style="color: #FF6400;">:initial-value</span> <span style="color: #ff1493;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-8" class="outline-4">
<h4 id="sec-5-4-8">Delete entity</h4>
<div class="outline-text-4" id="text-5-4-8">
</div><div id="outline-container-sec-5-4-8-1" class="outline-5">
<h5 id="sec-5-4-8-1">orgtrello/do-delete-simple</h5>
<div class="outline-text-5" id="text-5-4-8-1">
<p>
The main function to delete the current entity.
This checks if the id is present.
If not present, return an error message explaining the entity must be synced first.
Otherwise, execute the trello deletion.
Return a message of success.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-delete-simple"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-delete-simple</span> <span style="color: #006400;">(</span><span style="color: #D8FA3C;">&amp;optional</span> sync<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Do the simple deletion of a card, checklist or task."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>entry-metadata   <span style="color: #00ff00;">(</span>orgtrello-data/entry-get-full-metadata<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>current-metadata <span style="color: #00ff00;">(</span>gethash <span style="color: #FF6400;">:current</span> entry-metadata<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>id               <span style="color: #00ff00;">(</span>orgtrello/--id current-metadata<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>and current-metadata id<span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>query-http-or-error-msg <span style="color: #ffa500;">(</span>orgtrello/--dispatch-delete <span style="color: #6a5acd;">(</span>gethash <span style="color: #FF6400;">:cu</span><span style="color: #dc8cc3; background-color: #383838;">rrent</span><span style="color: #dc8cc3; background-color: #383838;"> entry-metadata</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #6a5acd; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">gethash </span><span style="color: #dc8cc3; background-color: #383838;">:parent</span><span style="color: #dc8cc3; background-color: #383838;"> entry-metadata</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
          <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #add8e6;">(</span>hash-table-p query-http-or-error-msg<span style="color: #add8e6;">)</span>
              <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">progn</span>
                <span style="color: #ffa500;">(</span>orgtrello-query/http query-http-or-error-msg sync 'orgtrello-qu<span style="color: #dc8cc3; background-color: #383838;">ery/--delete-success-callback</span><span style="color: #ffa500; background-color: #383838;">)</span>
                <span style="color: #61CE3C;">"Delete entity done!"</span><span style="color: #add8e6;">)</span>
            query-http-or-error-msg<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
      <span style="color: #61CE3C;">"Entity not synchronized on trello yet!"</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-4-8-2" class="outline-5">
<h5 id="sec-5-4-8-2">orgtrello/&#x2013;dispatch-map-delete</h5>
<div class="outline-text-5" id="text-5-4-8-2">
<p>
The computation of the <b>MAP-DISPATCH-DELETE</b> which will be used to dispatch the deletion of an entity.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-dispatch-map-delete"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--dispatch-map-delete</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Dispatch map for the deletion of card/checklist/item."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>dispatch-map <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash 1 'orgtrello/--card-delete      dispatch-map<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash 2 'orgtrello/--checklist-delete dispatch-map<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash 3 'orgtrello/--task-delete      dispatch-map<span style="color: #ff1493;">)</span>
    dispatch-map<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*MAP-DISPATCH-DELETE*</span> <span style="color: #006400;">(</span>orgtrello/--dispatch-map-delete<span style="color: #006400;">)</span> <span style="color: #61CE3C;">"Dispatch map fo</span><span style="color: #dc8cc3; background-color: #383838;">r the deletion query of card/checklist/task."</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-8-3" class="outline-5">
<h5 id="sec-5-4-8-3">orgtrello/&#x2013;dispatch-delete</h5>
<div class="outline-text-5" id="text-5-4-8-3">
<p>
The actual entity deletion using the <b>MAP-DISPATCH-DELETE</b> as a dispatch function.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-dispatch-delete"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--dispatch-delete</span> <span style="color: #006400;">(</span>meta <span style="color: #D8FA3C;">&amp;optional</span> parent-meta<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>level       <span style="color: #00ff00;">(</span>orgtrello/--level meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>dispatch-fn <span style="color: #00ff00;">(</span>gethash level *MAP-DISPATCH-DELETE* 'orgtrello/--too-deep<span style="color: #dc8cc3; background-color: #383838;">-level</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span>funcall dispatch-fn meta parent-meta<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-8-4" class="outline-5">
<h5 id="sec-5-4-8-4">orgtrello/&#x2013;card-delete</h5>
<div class="outline-text-5" id="text-5-4-8-4">
<p>
Specific card deletion request computation.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-card-delete"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--card-delete</span> <span style="color: #006400;">(</span>card-meta <span style="color: #D8FA3C;">&amp;optional</span> parent-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Deal with the deletion query of a card"</span>
  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">parent is useless here</span>
  <span style="color: #006400;">(</span>orgtrello-api/delete-card <span style="color: #ff1493;">(</span>orgtrello/--id card-meta<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-8-5" class="outline-5">
<h5 id="sec-5-4-8-5">orgtrello/&#x2013;checklist-delete</h5>
<div class="outline-text-5" id="text-5-4-8-5">
<p>
Specific checklist deletion request computation.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-checklist-delete"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--checklist-delete</span> <span style="color: #006400;">(</span>checklist-meta <span style="color: #D8FA3C;">&amp;optional</span> parent-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Deal with the deletion query of a checklist"</span>
  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">parent is useless here</span>
  <span style="color: #006400;">(</span>orgtrello-api/delete-checklist <span style="color: #ff1493;">(</span>orgtrello/--id checklist-meta<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-8-6" class="outline-5">
<h5 id="sec-5-4-8-6">orgtrello/&#x2013;task-delete</h5>
<div class="outline-text-5" id="text-5-4-8-6">
<p>
Specific task/item deletion request computation.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-task-delete"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--task-delete</span> <span style="color: #006400;">(</span>task-meta <span style="color: #D8FA3C;">&amp;optional</span> checklist-meta<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Deal with create/update task query build"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--task-id      <span style="color: #00ff00;">(</span>orgtrello/--id task-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello/--checklist-id <span style="color: #00ff00;">(</span>orgtrello/--id checklist-meta<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-api/delete-task orgtrello/--checklist-id orgtrello/--task-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-9" class="outline-4">
<h4 id="sec-5-4-9">Install key and token configuration</h4>
<div class="outline-text-4" id="text-5-4-9">
</div><div id="outline-container-sec-5-4-9-1" class="outline-5">
<h5 id="sec-5-4-9-1">orgtrello/do-install-key-and-token</h5>
<div class="outline-text-5" id="text-5-4-9-1">
<p>
First routine to ask input for the user:
</p>
<ul class="org-ul">
<li>open the consumer key page for the user to retrieve his/her consumer key.
</li>
<li>then open the access token page to ask for the user to permit org-trello to act on her/his behalf.
</li>
<li>at last, generate the config.el file inside his/her home.
</li>
<li>return a successfull message
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-install-key-and-token"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-install-key-and-token</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Procedure to install the *consumer-key* and the token for the user in the con</span><span style="color: #dc8cc3; background-color: #383838;">fig-file."</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>browse-url <span style="color: #61CE3C;">"https://trello.com/1/appKey/generate"</span><span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello/--*consumer-key* <span style="color: #00ff00;">(</span>read-string <span style="color: #61CE3C;">"*consumer-key*: "</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>browse-url <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"https://trello.com/1/authorize?response_type=token&amp;name</span><span style="color: #dc8cc3; background-color: #383838;">=org-trello&amp;scope=read,write&amp;expiration=never&amp;key=%s"</span><span style="color: #dc8cc3; background-color: #383838;"> orgtrello/--*consumer-key*</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>orgtrello/--access-token <span style="color: #add8e6;">(</span>read-string <span style="color: #61CE3C;">"Access-token: "</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
      <span style="color: #ffff00;">(</span>orgtrello/--do-install-config-file orgtrello/--*consumer-key* orgtrello/-<span style="color: #dc8cc3; background-color: #383838;">-access-token</span><span style="color: #ffff00; background-color: #383838;">)</span>
      <span style="color: #61CE3C;">"Install key and read/write access token done!"</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-9-2" class="outline-5">
<h5 id="sec-5-4-9-2">orgtrello/&#x2013;do-install-config-file</h5>
<div class="outline-text-5" id="text-5-4-9-2">
<p>
Given a consumer-key and an access token, generate a <i>config.el</i> file.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-do-install-config-file"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--do-install-config-file</span> <span style="color: #006400;">(</span>*consumer-key* *access-token*<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Persist the file config-file with the input of the user."</span>
  <span style="color: #006400;">(</span>make-directory *CONFIG-DIR* t<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">with-temp-file</span> *CONFIG-FILE*
    <span style="color: #ff1493;">(</span>erase-buffer<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>goto-char <span style="color: #ffff00;">(</span>point-min<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>insert <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"(setq *consumer-key* \"%s\")\n"</span> *consumer-key*<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>insert <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"(setq *access-token* \"%s\")"</span> *access-token*<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>write-file *CONFIG-FILE* 't<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-5-4-10" class="outline-4">
<h4 id="sec-5-4-10">Install board and lists configuration</h4>
<div class="outline-text-4" id="text-5-4-10">
<p>
The install board and lists configuration. There is an alternative to such setup with the create board routine.
</p>
</div>

<div id="outline-container-sec-5-4-10-1" class="outline-5">
<h5 id="sec-5-4-10-1">orgtrello/do-install-board-and-lists</h5>
<div class="outline-text-5" id="text-5-4-10-1">
<p>
Main routine to ask for the user's input to setup his/her board to attach to his/her current org buffer.
This:
</p>
<ul class="org-ul">
<li>generates a list of his/her current board from his/her trello's account.
</li>
<li>ask for the user to input which board he/she wants to use
</li>
<li>then generate the metadata regarding his/her choice to the org buffer's beginning
</li>
<li>return a message of success
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-install-board-and-lists"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-install-board-and-lists</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Interactive command to install the list boards"</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>cl-destructuring-bind
      <span style="color: #ff1493;">(</span>orgtrello/--chosen-board-id orgtrello/--chosen-board-name<span style="color: #ff1493;">)</span> <span style="color: #ff1493;">(</span>-&gt; <span style="color: #ffff00;">(</span>orgtrello<span style="color: #dc8cc3; background-color: #383838;">/--list-boards</span><span style="color: #ffff00; background-color: #383838;">)</span>
                                                                      orgtrello/<span style="color: #dc8cc3; background-color: #383838;">--id-name</span>
                                                                      orgtrello/<span style="color: #dc8cc3; background-color: #383838;">--choose-board</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>orgtrello/--board-lists-hname-id <span style="color: #add8e6;">(</span>-&gt; orgtrello/--chosen-board-id
                                                orgtrello/--list-board-lists
                                                orgtrello/--name-id<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">remove any eventual present entry</span>
      <span style="color: #ffff00;">(</span>orgtrello/--remove-properties-file orgtrello/--board-lists-hname-id t<span style="color: #ffff00;">)</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">update with new ones</span>
      <span style="color: #ffff00;">(</span>orgtrello/update-orgmode-file-with-properties
       orgtrello/--chosen-board-name
       orgtrello/--chosen-board-id
       orgtrello/--board-lists-hname-id
       t<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Install board and list ids done!"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-2" class="outline-5">
<h5 id="sec-5-4-10-2">orgtrello/&#x2013;choose-board</h5>
<div class="outline-text-5" id="text-5-4-10-2">
<p>
The routine that asks the user:
</p>
<ul class="org-ul">
<li>to select the board he/she wants to work with
</li>
<li>return the list of board id, board name
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-choose-board"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--choose-board</span> <span style="color: #006400;">(</span>boards<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a map of boards, display the possible boards for the user to choose whi</span><span style="color: #dc8cc3; background-color: #383838;">ch one he wants to work with."</span>
  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">ugliest ever</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">orgtrello/--board-chosen</span> nil<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>setq orgtrello/--board-chosen nil<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>str-key-val  <span style="color: #61CE3C;">""</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>i            0<span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>i-id <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>maphash <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #00ff00;">(</span>id name<span style="color: #00ff00;">)</span>
               <span style="color: #00ff00;">(</span>setq str-key-val <span style="color: #add8e6;">(</span>format <span style="color: #61CE3C;">"%s%d: %s\n"</span> str-key-val i name<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>
               <span style="color: #00ff00;">(</span>puthash <span style="color: #add8e6;">(</span>format <span style="color: #61CE3C;">"%d"</span> i<span style="color: #add8e6;">)</span> id i-id<span style="color: #00ff00;">)</span>
               <span style="color: #00ff00;">(</span>setq i <span style="color: #add8e6;">(</span>+ 1 i<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
             boards<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">while</span> <span style="color: #ffff00;">(</span>not <span style="color: #00ff00;">(</span>gethash orgtrello/--board-chosen i-id<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
      <span style="color: #ffff00;">(</span>setq orgtrello/--board-chosen
            <span style="color: #00ff00;">(</span>read-string <span style="color: #add8e6;">(</span>format <span style="color: #61CE3C;">"%s\nInput the number of the board desired: "</span> s<span style="color: #dc8cc3; background-color: #383838;">tr-key-val</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>orgtrello/--chosen-board-id   <span style="color: #add8e6;">(</span>gethash orgtrello/--board-chosen i-id<span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
           <span style="color: #00ff00;">(</span>orgtrello/--chosen-board-name <span style="color: #add8e6;">(</span>gethash orgtrello/--chosen-board-id b<span style="color: #dc8cc3; background-color: #383838;">oards</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
      `<span style="color: #ffff00;">(</span>,orgtrello/--chosen-board-id ,orgtrello/--chosen-board-name<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-3" class="outline-5">
<h5 id="sec-5-4-10-3">orgtrello/&#x2013;remove-properties-file</h5>
<div class="outline-text-5" id="text-5-4-10-3">
<p>
Remove some file properties before applying new ones.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-remove-properties-file"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--delete-buffer-property</span> <span style="color: #006400;">(</span>property-name<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"A simple routine to delete a #+property: entry from the org-mode buffer."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>current-point <span style="color: #00ff00;">(</span>search-forward property-name nil t<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> current-point
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">progn</span>
          <span style="color: #00ff00;">(</span>goto-char current-point<span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span>beginning-of-line<span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span>kill-line<span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span>kill-line<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--remove-properties-file</span> <span style="color: #006400;">(</span>board-lists-hash-name-id <span style="color: #D8FA3C;">&amp;optional</span> up<span style="color: #dc8cc3; background-color: #383838;">date-todo-keywords</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Remove the current org-trello properties"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">with-current-buffer</span> <span style="color: #ff1493;">(</span>current-buffer<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>goto-char <span style="color: #ffff00;">(</span>point-min<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello/--delete-buffer-property <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"#+property: %s"</span> *BOARD-ID*<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello/--delete-buffer-property <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"#+property: %s"</span> *BOARD-NAME*<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>maphash
     <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #00ff00;">(</span>name id<span style="color: #00ff00;">)</span>
       <span style="color: #00ff00;">(</span>orgtrello/--delete-buffer-property <span style="color: #add8e6;">(</span>format <span style="color: #61CE3C;">"#+property: %s"</span> <span style="color: #ffa500;">(</span>orgtrello/c<span style="color: #dc8cc3; background-color: #383838;">onvention-property-name name</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
     board-lists-hash-name-id<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> update-todo-keywords
        <span style="color: #ffff00;">(</span>orgtrello/--delete-buffer-property <span style="color: #61CE3C;">"#+</span><span style="color: #ff69b4;">TODO:</span><span style="color: #61CE3C;"> "</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-4" class="outline-5">
<h5 id="sec-5-4-10-4">orgtrello/update-orgmode-file-with-properties</h5>
<div class="outline-text-5" id="text-5-4-10-4">
<p>
Given a board name, board id, list of list ids, map of list names, insert such informations to the beginning of the org buffer.
Then save the buffer and restart org-mode.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/update-orgmode-file-with-properties"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/update-orgmode-file-with-properties</span> <span style="color: #006400;">(</span>board-name board-id board-<span style="color: #dc8cc3; background-color: #383838;">lists-hash-name-id </span><span style="color: #dc8cc3; background-color: #383838;">&amp;optional</span><span style="color: #dc8cc3; background-color: #383838;"> update-todo-keywords</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Update the orgmode file with the needed headers for org-trello to work."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">with-current-buffer</span> <span style="color: #ff1493;">(</span>current-buffer<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>goto-char <span style="color: #ffff00;">(</span>point-min<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">force utf-8</span>
    <span style="color: #ff1493;">(</span>set-buffer-file-coding-system 'utf-8-auto<span style="color: #ff1493;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">install board-name and board-id</span>
    <span style="color: #ff1493;">(</span>insert <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"#+property: %s    %s\n"</span> *BOARD-NAME* board-name<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>insert <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"#+property: %s      %s\n"</span> *BOARD-ID* board-id<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">install the other properties regarding the org keywords</span>
    <span style="color: #ff1493;">(</span>maphash
     <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #00ff00;">(</span>name id<span style="color: #00ff00;">)</span>
       <span style="color: #00ff00;">(</span>insert <span style="color: #add8e6;">(</span>format <span style="color: #61CE3C;">"#+property: %s %s\n"</span> <span style="color: #ffa500;">(</span>orgtrello/convention-property-name<span style="color: #dc8cc3; background-color: #383838;"> name</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> id</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
     board-lists-hash-name-id<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> update-todo-keywords
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">progn</span>
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">install the todo list</span>
          <span style="color: #00ff00;">(</span>insert <span style="color: #61CE3C;">"#+</span><span style="color: #ff69b4;">TODO:</span><span style="color: #61CE3C;"> "</span><span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span>maphash <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffa500;">(</span>name _<span style="color: #ffa500;">)</span> <span style="color: #ffa500;">(</span>insert <span style="color: #6a5acd;">(</span>concat <span style="color: #d3d3d3;">(</span>orgtrello/convention-proper<span style="color: #dc8cc3; background-color: #383838;">ty-name name</span><span style="color: #d3d3d3; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #dc8cc3; background-color: #383838;">" "</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> board-lists-hash-name-id</span><span style="color: #00ff00; background-color: #383838;">)</span>
          <span style="color: #00ff00;">(</span>insert <span style="color: #61CE3C;">"\n"</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">save the buffer</span>
    <span style="color: #ff1493;">(</span>save-buffer<span style="color: #ff1493;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">restart org to make org-trello aware of the new setup</span>
    <span style="color: #ff1493;">(</span>org-mode-restart<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-5" class="outline-5">
<h5 id="sec-5-4-10-5">orgtrello/&#x2013;id-name</h5>
<div class="outline-text-5" id="text-5-4-10-5">
<p>
Given a list of entities, return a map of (id . name)
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-id-name"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--id-name</span> <span style="color: #006400;">(</span>entities<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a list of entities, return a map of (id, name)."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>id-name <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>mapc <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #00ff00;">(</span>it<span style="color: #00ff00;">)</span> <span style="color: #00ff00;">(</span>puthash <span style="color: #add8e6;">(</span>orgtrello-query/--id it<span style="color: #add8e6;">)</span> <span style="color: #add8e6;">(</span>orgtrello-query/--nam<span style="color: #dc8cc3; background-color: #383838;">e it</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> id-name</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> entities</span><span style="color: #ff1493; background-color: #383838;">)</span>
    id-name<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-6" class="outline-5">
<h5 id="sec-5-4-10-6">orgtrello/&#x2013;name-id</h5>
<div class="outline-text-5" id="text-5-4-10-6">
<p>
Given a list of entities, return a map of (name . id)
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-name-id"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--name-id</span> <span style="color: #006400;">(</span>entities<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a list of entities, return a map of (id, name)."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>name-id <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>mapc <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #00ff00;">(</span>it<span style="color: #00ff00;">)</span> <span style="color: #00ff00;">(</span>puthash <span style="color: #add8e6;">(</span>orgtrello-query/--name it<span style="color: #add8e6;">)</span> <span style="color: #add8e6;">(</span>orgtrello-query/--i<span style="color: #dc8cc3; background-color: #383838;">d it</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> name-id</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> entities</span><span style="color: #ff1493; background-color: #383838;">)</span>
    name-id<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-7" class="outline-5">
<h5 id="sec-5-4-10-7">orgtrello/&#x2013;list-boards</h5>
<div class="outline-text-5" id="text-5-4-10-7">
<p>
Execute the query that return a list of boards from the user's current trello account.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-list-boards"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--list-boards</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Return the map of the existing boards associated to the current account. (Syn</span><span style="color: #dc8cc3; background-color: #383838;">chronous request)"</span>
  <span style="color: #006400;">(</span>cl-remove-if-not
   <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">(</span>board<span style="color: #ffff00;">)</span> <span style="color: #ffff00;">(</span>equal <span style="color: #FF6400;">:json-false</span> <span style="color: #00ff00;">(</span>orgtrello-query/--close-property board<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
   <span style="color: #ff1493;">(</span>orgtrello-query/http <span style="color: #ffff00;">(</span>orgtrello-api/get-boards<span style="color: #ffff00;">)</span> t<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-8" class="outline-5">
<h5 id="sec-5-4-10-8">orgtrello/&#x2013;list-board-lists</h5>
<div class="outline-text-5" id="text-5-4-10-8">
<p>
Execute the query that return a list of the board lists from the user's current trello account.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-list-board-lists"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--list-board-lists</span> <span style="color: #006400;">(</span>board-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Return the map of the existing list of the board with id board-id. (Synchrono</span><span style="color: #dc8cc3; background-color: #383838;">us request)"</span>
  <span style="color: #006400;">(</span>orgtrello-query/http <span style="color: #ff1493;">(</span>orgtrello-api/get-lists board-id<span style="color: #ff1493;">)</span> t<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10-9" class="outline-5">
<h5 id="sec-5-4-10-9">orgtrello/convention-property-name</h5>
<div class="outline-text-5" id="text-5-4-10-9">
<p>
A function to help eventually decorate the name of the keywords.
Replace the space by dash at the moment.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/convention-property-name"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/convention-property-name</span> <span style="color: #006400;">(</span>name<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Use the right convention for the property used in the headers of the org-mode</span><span style="color: #dc8cc3; background-color: #383838;"> file."</span>
  <span style="color: #006400;">(</span>replace-regexp-in-string <span style="color: #61CE3C;">" "</span> <span style="color: #61CE3C;">"-"</span> name<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-11" class="outline-4">
<h4 id="sec-5-4-11">Create board</h4>
<div class="outline-text-4" id="text-5-4-11">
<p>
The main function regarding the creation of the board and the org attachment to such board.
</p>
</div>

<div id="outline-container-sec-5-4-11-1" class="outline-5">
<h5 id="sec-5-4-11-1">orgtrello/do-create-board-and-lists</h5>
<div class="outline-text-5" id="text-5-4-11-1">
<p>
The main entry.
We will ask the user to:
</p>
<ul class="org-ul">
<li>input the name of the board he/she wants.
</li>
<li>input an optional board description
</li>
</ul>
<p>
Then launch the creation of the board.
This will:
</p>
<ul class="org-ul">
<li>create the board
</li>
<li>close the default lists created by trello
</li>
<li>create as much list as the user's keywords with the same name as the corresponding keywords.
</li>
<li>at last, update the beginning of the org buffer with the corresponding metadata:
<ul class="org-ul">
<li>board-name
</li>
<li>board-id
</li>
<li>list-id for all lists created
</li>
</ul>
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/do-create-board-and-lists"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/do-create-board-and-lists</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Interactive command to create a board and the lists"</span>
  <span style="color: #006400;">(</span>interactive<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">orgtrello/--board-name</span> nil<span style="color: #006400;">)</span>        <span style="color: #006400;">(</span>setq orgtrello/--board-name nil<span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">orgtrello/--board-description</span> nil<span style="color: #006400;">)</span> <span style="color: #006400;">(</span>setq orgtrello/--board-description<span style="color: #dc8cc3; background-color: #383838;"> nil</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">while</span> <span style="color: #ff1493;">(</span>not orgtrello/--board-name<span style="color: #ff1493;">)</span> <span style="color: #ff1493;">(</span>setq orgtrello/--board-name <span style="color: #ffff00;">(</span>read-string <span style="color: #dc8cc3; background-color: #383838;">"Please, input the desired board name: "</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #006400;">(</span>setq orgtrello/--board-description <span style="color: #ff1493;">(</span>read-string <span style="color: #61CE3C;">"Please, input the board desc</span><span style="color: #dc8cc3; background-color: #383838;">ription (empty for none): "</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #006400;">(</span>cl-destructuring-bind <span style="color: #ff1493;">(</span>orgtrello/--board-id orgtrello/--board-name<span style="color: #ff1493;">)</span> <span style="color: #ff1493;">(</span>orgtrell<span style="color: #dc8cc3; background-color: #383838;">o/--create-board orgtrello/--board-name orgtrello/--board-description</span><span style="color: #ff1493; background-color: #383838;">)</span>
                         <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>orgtrello/--board-list-ids       <span style="color: #add8e6;">(</span>--map <span style="color: #ffa500;">(</span>orgtre<span style="color: #dc8cc3; background-color: #383838;">llo-query/--id it</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffa500; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">orgtrello/--list-board-lists orgtrello/--board-id</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;">  </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">;; </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">first retrieve the existing lists (created by default on trello)</span>
                                <span style="color: #00ff00;">(</span>orgtrello/--lists-to-close       <span style="color: #add8e6;">(</span>orgtrello/--c<span style="color: #dc8cc3; background-color: #383838;">lose-lists orgtrello/--board-list-ids</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;">                                </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">;; </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">close those lists (they may surely not match the name we want)</span>
                                <span style="color: #00ff00;">(</span>orgtrello/--board-lists-hname-id <span style="color: #add8e6;">(</span>orgtrello/--c<span style="color: #dc8cc3; background-color: #383838;">reate-lists-according-to-keywords orgtrello/--board-id *LIST-NAMES*</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">;; </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">create the list, this returns the ids list</span>
                           <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">remove eventual already present entry</span>
                           <span style="color: #ffff00;">(</span>orgtrello/--remove-properties-file orgtrello/--board<span style="color: #dc8cc3; background-color: #383838;">-lists-hname-id</span><span style="color: #ffff00; background-color: #383838;">)</span>
                           <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">update org buffer with new ones</span>
                           <span style="color: #ffff00;">(</span>orgtrello/update-orgmode-file-with-properties orgtre<span style="color: #dc8cc3; background-color: #383838;">llo/--board-name orgtrello/--board-id orgtrello/--board-lists-hname-id</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Create board and lists done!"</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>message <span style="color: #61CE3C;">"org-trello - orgtrello loaded!"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-4-11-2" class="outline-5">
<h5 id="sec-5-4-11-2">orgtrello/&#x2013;create-board</h5>
<div class="outline-text-5" id="text-5-4-11-2">
<p>
The actual board creation.
This return a list of board id, board name.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-create-board"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--create-board</span> <span style="color: #006400;">(</span>board-name <span style="color: #D8FA3C;">&amp;optional</span> board-description<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Create a board with name and eventually a description."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">progn</span>
    <span style="color: #ff1493;">(</span>message <span style="color: #61CE3C;">"Creating board '%s'"</span> board-name<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>board-data <span style="color: #add8e6;">(</span>orgtrello-query/http <span style="color: #ffa500;">(</span>orgtrello-api/add-board board-name<span style="color: #dc8cc3; background-color: #383838;"> board-description</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> t</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
      <span style="color: #ffff00;">(</span>list <span style="color: #00ff00;">(</span>orgtrello-query/--id board-data<span style="color: #00ff00;">)</span> <span style="color: #00ff00;">(</span>orgtrello-query/--name board-data<span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-11-3" class="outline-5">
<h5 id="sec-5-4-11-3">orgtrello/&#x2013;close-lists</h5>
<div class="outline-text-5" id="text-5-4-11-3">
<p>
The close list routine.
Given a list of list ids, close each of those list.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-close-lists"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--close-lists</span> <span style="color: #006400;">(</span>list-ids<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a list of ids, close those lists."</span>
  <span style="color: #006400;">(</span>mapc <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">(</span>list-id<span style="color: #ffff00;">)</span>
          <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">progn</span>
            <span style="color: #00ff00;">(</span>message <span style="color: #61CE3C;">"Closing default list with id %s"</span> list-id<span style="color: #00ff00;">)</span>
            <span style="color: #00ff00;">(</span>orgtrello-query/http <span style="color: #add8e6;">(</span>orgtrello-api/close-list list-id<span style="color: #add8e6;">)</span> nil nil 'si<span style="color: #dc8cc3; background-color: #383838;">mple-error-callback</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
        list-ids<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-11-4" class="outline-5">
<h5 id="sec-5-4-11-4">orgtrello/&#x2013;create-lists-according-to-keywords</h5>
<div class="outline-text-5" id="text-5-4-11-4">
<p>
Create as much list as the keywords to the board <i>board-id</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello/-create-lists-according-to-keywords"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello/--create-lists-according-to-keywords</span> <span style="color: #006400;">(</span>board-id list-keywords<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given a list of names, build those lists on the trello boards. Return the has</span><span style="color: #dc8cc3; background-color: #383838;">hmap (name, id) of the new lists created."</span>
  <span style="color: #006400;">(</span>cl-reduce
   <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">lambda</span> <span style="color: #ffff00;">(</span>acc-hash-name-id list-name<span style="color: #ffff00;">)</span>
     <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">progn</span>
       <span style="color: #00ff00;">(</span>message <span style="color: #61CE3C;">"Board id %s - Creating list '%s'"</span> board-id list-name<span style="color: #00ff00;">)</span>
       <span style="color: #00ff00;">(</span>puthash list-name <span style="color: #add8e6;">(</span>orgtrello-query/--id <span style="color: #ffa500;">(</span>orgtrello-query/http <span style="color: #6a5acd;">(</span>orgtrello<span style="color: #dc8cc3; background-color: #383838;">-api/add-list list-name board-id</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> t</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> acc-hash-name-id</span><span style="color: #00ff00; background-color: #383838;">)</span>
       acc-hash-name-id<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
   list-keywords
   <span style="color: #FF6400;">:initial-value</span> <span style="color: #ff1493;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-12" class="outline-4">
<h4 id="sec-5-4-12">Utility function</h4>
<div class="outline-text-4" id="text-5-4-12">
<p>
An utility decorator function to help in debugging without breakpoint.
This is mostly for user when we need them to help us remotely debug.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="trace"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">trace</span> <span style="color: #006400;">(</span>e <span style="color: #D8FA3C;">&amp;optional</span> label<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Decorator for some inaccessible code to easily 'message'."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">progn</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> label
        <span style="color: #ffff00;">(</span>message <span style="color: #61CE3C;">"TRACE: %s: %S"</span> label e<span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span>message <span style="color: #61CE3C;">"TRACE: %S"</span> e<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    e<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5">orgtrello-query</h3>
<div class="outline-text-3" id="text-5-5">
<p>
Namespace in charge of the http request to the trello api.
</p>
</div>

<div id="outline-container-sec-5-5-1" class="outline-4">
<h4 id="sec-5-5-1">Namespace Setup</h4>
<div class="outline-text-4" id="text-5-5-1">
<p>
Static setup the user does not need to tinker with.
This resumes to only one variable which is the prefix url for the trello api access.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query-setup">&#12;

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">#################### orgtrello-query/</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*TRELLO-URL*</span> <span style="color: #61CE3C;">"https://api.trello.com/1"</span> <span style="color: #61CE3C;">"The needed prefix url for trell</span><span style="color: #dc8cc3; background-color: #383838;">o"</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-2" class="outline-4">
<h4 id="sec-5-5-2">orgtrello-query/&#x2013;make-dispatch-http-query</h4>
<div class="outline-text-4" id="text-5-5-2">
<p>
As we do not have multi-methods (as in clojure), we tried to reproduce a similar behaviour.
This describes a function which will setup a map to dispatch on the method (:get, :post, :put, :delete) on the other function describes in the namespace).
</p>

<p>
This function is used only once to initialize the variable <b>MAP-DISPATCH-HTTP-QUERY</b>, which will be used later to dispatch on the http request built.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-make-dispatch-http-query"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--make-dispatch-http-query</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Make a map that will dispatch the function to call depending on the http verb</span><span style="color: #dc8cc3; background-color: #383838;"> :get, :put, :post, etc..."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>map-dispatch <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:get</span>    'orgtrello-query/--get         map-dispatch<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:put</span>    'orgtrello-query/--post-or-put map-dispatch<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:post</span>   'orgtrello-query/--post-or-put map-dispatch<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:delete</span> 'orgtrello-query/--delete      map-dispatch<span style="color: #ff1493;">)</span>
    map-dispatch<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*MAP-DISPATCH-HTTP-QUERY*</span> <span style="color: #006400;">(</span>orgtrello-query/--make-dispatch-http-query<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-3" class="outline-4">
<h4 id="sec-5-5-3">orgtrello-query/http</h4>
<div class="outline-text-4" id="text-5-5-3">
<p>
This is the main function from the namespace in charge of executing the http request.
We pass the query-map which is been built from the orgtrello-api namespace.
Optionally, we pass a:
</p>
<ul class="org-ul">
<li>success-callback in charge of doing some action when the request finishes successfully.
</li>
<li>error-callback in  charge of doing some action when the request finishes erroneously.
</li>
<li>sync flag to render the request synchronous (default is asynchronous)
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/http"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/http</span> <span style="color: #006400;">(</span>query-map <span style="color: #D8FA3C;">&amp;optional</span> sync success-callback error-cal<span style="color: #dc8cc3; background-color: #383838;">lback</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Query the trello api asynchronously."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>method      <span style="color: #00ff00;">(</span>gethash <span style="color: #FF6400;">:method</span> query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>fn-dispatch <span style="color: #00ff00;">(</span>gethash method *MAP-DISPATCH-HTTP-QUERY*<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> sync
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">progn</span> <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">synchronous request</span>
          <span style="color: #00ff00;">(</span>puthash <span style="color: #FF6400;">:sync</span> t query-map<span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span>request-response <span style="color: #6a5acd;">(</span>funcall fn-dispatch query-map success-callbac<span style="color: #dc8cc3; background-color: #383838;">k error-callback</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span>
            <span style="color: #add8e6;">(</span>request-response-data request-response<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
      <span style="color: #ffff00;">(</span>funcall fn-dispatch query-map success-callback error-callback<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-4" class="outline-4">
<h4 id="sec-5-5-4">orgtrello-query/&#x2013;map-dispatch-http-verb</h4>
<div class="outline-text-4" id="text-5-5-4">
<p>
As described earlier, no multi-method, we use the same techniques to setup a map to dispatch on the method (:get, :post, :put, :delete) to map to the request http client DSL.
This function is again called once.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-map-dispatch-http-verb"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--map-dispatch-http-verb</span> <span style="color: #006400;">()</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>map-dispatch <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:get</span>    <span style="color: #61CE3C;">"GET"</span>    map-dispatch<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:put</span>    <span style="color: #61CE3C;">"PUT"</span>    map-dispatch<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:post</span>   <span style="color: #61CE3C;">"POST"</span>   map-dispatch<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:delete</span> <span style="color: #61CE3C;">"DELETE"</span> map-dispatch<span style="color: #ff1493;">)</span>
    map-dispatch<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*MAP-DISPATCH-HTTP-VERB*</span> <span style="color: #006400;">(</span>orgtrello-query/--map-dispatch-http-verb<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-5" class="outline-4">
<h4 id="sec-5-5-5">orgtrello-query/&#x2013;compute-method</h4>
<div class="outline-text-4" id="text-5-5-5">
<p>
Exploiting the dispatch map, we compute the http method (GET, POST, PUT, DELETE).
We could also have implemented this using simply cond.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-compute-method"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--compute-method</span> <span style="color: #006400;">(</span>method<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given the keywords :get, :post, :put, :delete, map them into standard upperca</span><span style="color: #dc8cc3; background-color: #383838;">se string."</span>
  <span style="color: #006400;">(</span>gethash method *MAP-DISPATCH-HTTP-VERB*<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-6" class="outline-4">
<h4 id="sec-5-5-6">orgtrello-query/&#x2013;compute-url</h4>
<div class="outline-text-4" id="text-5-5-6">
<p>
A function to compute the full trello url given an uri.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-compute-url"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--compute-url</span> <span style="color: #006400;">(</span>uri<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Compute the trello url from the given uri."</span>
  <span style="color: #006400;">(</span>format <span style="color: #61CE3C;">"%s%s"</span> *TRELLO-URL* uri<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-7" class="outline-4">
<h4 id="sec-5-5-7">Input request abstraction extract functions</h4>
<div class="outline-text-4" id="text-5-5-7">
<p>
Some functions around the data stored in the query-map, hiding the implementation details of such query-map.
</p>
</div>

<div id="outline-container-sec-5-5-7-1" class="outline-5">
<h5 id="sec-5-5-7-1">orgtrello-query/&#x2013;method</h5>
<div class="outline-text-5" id="text-5-5-7-1">
<p>
Extract the http method.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-method"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--method</span> <span style="color: #006400;">(</span>query-map<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the http method"</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:method</span> query-map<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-7-2" class="outline-5">
<h5 id="sec-5-5-7-2">orgtrello-query/&#x2013;uri</h5>
<div class="outline-text-5" id="text-5-5-7-2">
<p>
Extract the trello api uri.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-uri"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--uri</span> <span style="color: #006400;">(</span>query-map<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the http uri"</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:uri</span> query-map<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-7-3" class="outline-5">
<h5 id="sec-5-5-7-3">orgtrello-query/&#x2013;sync</h5>
<div class="outline-text-5" id="text-5-5-7-3">
<p>
Retrieve the flag sync or not of the query-map.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-sync"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--sync</span> <span style="color: #006400;">(</span>query-map<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the http sync flag"</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:sync</span> query-map<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-7-4" class="outline-5">
<h5 id="sec-5-5-7-4">orgtrello-query/&#x2013;params</h5>
<div class="outline-text-5" id="text-5-5-7-4">
<p>
Retrieve the params of the query.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-params"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--params</span> <span style="color: #006400;">(</span>query-map<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the http params"</span>
  <span style="color: #006400;">(</span>gethash <span style="color: #FF6400;">:params</span> query-map<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5-5-8" class="outline-4">
<h4 id="sec-5-5-8">Output request abstraction extract function</h4>
<div class="outline-text-4" id="text-5-5-8">
<p>
Some functions around the data stored in the http query response, hiding the implementation details.
</p>
</div>
<div id="outline-container-sec-5-5-8-1" class="outline-5">
<h5 id="sec-5-5-8-1">orgtrello-query/&#x2013;id</h5>
<div class="outline-text-5" id="text-5-5-8-1">
<p>
Extract the id of the entity from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-id"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--id</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the id of the entity from the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'id entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-2" class="outline-5">
<h5 id="sec-5-5-8-2">orgtrello-query/&#x2013;name</h5>
<div class="outline-text-5" id="text-5-5-8-2">
<p>
Extract the name of the entity from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-name"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--name</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the name of the entity from the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'name entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-3" class="outline-5">
<h5 id="sec-5-5-8-3">orgtrello-query/&#x2013;list-id</h5>
<div class="outline-text-5" id="text-5-5-8-3">
<p>
Extract the list identifier from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-list-id"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--list-id</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the list identitier of the entity from the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'idList entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-4" class="outline-5">
<h5 id="sec-5-5-8-4">orgtrello-query/&#x2013;checklist-ids</h5>
<div class="outline-text-5" id="text-5-5-8-4">
<p>
Extract the list of checklist ids from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-checklist-ids"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--checklist-ids</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the checklist identifier of the entity from the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'idChecklists entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-5" class="outline-5">
<h5 id="sec-5-5-8-5">orgtrello-query/&#x2013;check-items</h5>
<div class="outline-text-5" id="text-5-5-8-5">
<p>
Extract the list of items/tasks from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-check-items"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--check-items</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the checklist identifier of the entity from the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'checkItems entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-6" class="outline-5">
<h5 id="sec-5-5-8-6">orgtrello-query/&#x2013;card-id</h5>
<div class="outline-text-5" id="text-5-5-8-6">
<p>
Extract the card id from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-card-id"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--card-id</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the card identifier of the entity from the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'idCard entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-7" class="outline-5">
<h5 id="sec-5-5-8-7">orgtrello-query/&#x2013;due</h5>
<div class="outline-text-5" id="text-5-5-8-7">
<p>
Extract the card id from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-due"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--due</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the due date of the entity from the query response"</span>
  <span style="color: #006400;">(</span>assoc-default 'due entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-8" class="outline-5">
<h5 id="sec-5-5-8-8">orgtrello-query/&#x2013;state</h5>
<div class="outline-text-5" id="text-5-5-8-8">
<p>
Extract the state from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-state"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--state</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the state of the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'state entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-8-9" class="outline-5">
<h5 id="sec-5-5-8-9">orgtrello-query/&#x2013;close-property</h5>
<div class="outline-text-5" id="text-5-5-8-9">
<p>
Extract the close flag from the entity-data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-close-property"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--close-property</span> <span style="color: #006400;">(</span>entity-data<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Extract the closed property of the entity"</span>
  <span style="color: #006400;">(</span>assoc-default 'closed entity-data<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-9" class="outline-4">
<h4 id="sec-5-5-9">HTTP request functions</h4>
<div class="outline-text-4" id="text-5-5-9">
<p>
Those represent the actual http actions.
They are closures on the trello identifier (consumer-key and access-token).
</p>
</div>

<div id="outline-container-sec-5-5-9-1" class="outline-5">
<h5 id="sec-5-5-9-1">orgtrello-query/&#x2013;get</h5>
<div class="outline-text-5" id="text-5-5-9-1">
<p>
The function around the GET http request.
This will extract the method, uri and sync flag and build the http request.
This is a closure around the consumer-key and access-token.
The request's response is some json which will be parsed by the function 'json-read.
In case of optional success or error callback are passed, they will be used.
Otherwise, the 'standard-success-callback or the 'standard-error-callback will be used.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-get"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--get</span> <span style="color: #006400;">(</span>query-map <span style="color: #D8FA3C;">&amp;optional</span> success-callback error-callbac<span style="color: #dc8cc3; background-color: #383838;">k</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"GET"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>method <span style="color: #00ff00;">(</span>orgtrello-query/--method query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>uri    <span style="color: #00ff00;">(</span>orgtrello-query/--uri    query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>sync   <span style="color: #00ff00;">(</span>orgtrello-query/--sync   query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>request <span style="color: #ffff00;">(</span>orgtrello-query/--compute-url uri<span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:sync</span>    sync
             <span style="color: #FF6400;">:type</span>    <span style="color: #ffff00;">(</span>orgtrello-query/--compute-method method<span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:params</span>  `<span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>key . ,*consumer-key*<span style="color: #00ff00;">)</span>
                        <span style="color: #00ff00;">(</span>token . ,*access-token*<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:parser</span>  'json-read
             <span style="color: #FF6400;">:success</span> <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> success-callback success-callback 'standard-success-ca<span style="color: #dc8cc3; background-color: #383838;">llback</span><span style="color: #ffff00; background-color: #383838;">)</span>
             <span style="color: #FF6400;">:error</span>   <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> error-callback error-callback 'standard-error-callback<span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-9-2" class="outline-5">
<h5 id="sec-5-5-9-2">orgtrello-query/&#x2013;post-or-put</h5>
<div class="outline-text-5" id="text-5-5-9-2">
<p>
The function around the POST/PUT verbs.
This is similar to the get function but does some extract actions:
</p>
<ul class="org-ul">
<li>It extracts the params (which represents the needed information for the trello entity we will sync).
</li>
<li>It encodes the payload in json with the json-encode function
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-post-or-put"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--post-or-put</span> <span style="color: #006400;">(</span>query-map <span style="color: #D8FA3C;">&amp;optional</span> success-callback error<span style="color: #dc8cc3; background-color: #383838;">-callback</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"POST or PUT"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>method  <span style="color: #00ff00;">(</span>orgtrello-query/--method query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>uri     <span style="color: #00ff00;">(</span>orgtrello-query/--uri    query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>payload <span style="color: #00ff00;">(</span>orgtrello-query/--params query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>sync    <span style="color: #00ff00;">(</span>orgtrello-query/--sync   query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>request <span style="color: #ffff00;">(</span>orgtrello-query/--compute-url uri<span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:sync</span>    sync
             <span style="color: #FF6400;">:type</span>    <span style="color: #ffff00;">(</span>orgtrello-query/--compute-method method<span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:params</span>  `<span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>key . ,*consumer-key*<span style="color: #00ff00;">)</span>
                        <span style="color: #00ff00;">(</span>token . ,*access-token*<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:headers</span> '<span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span><span style="color: #61CE3C;">"Content-type"</span> . <span style="color: #61CE3C;">"application/json"</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:data</span>    <span style="color: #ffff00;">(</span>json-encode payload<span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:parser</span>  'json-read
             <span style="color: #FF6400;">:success</span> <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> success-callback success-callback 'standard-success-ca<span style="color: #dc8cc3; background-color: #383838;">llback</span><span style="color: #ffff00; background-color: #383838;">)</span>
             <span style="color: #FF6400;">:error</span>   <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> error-callback error-callback 'standard-error-callback<span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-9-3" class="outline-5">
<h5 id="sec-5-5-9-3">orgtrello-query/&#x2013;delete</h5>
<div class="outline-text-5" id="text-5-5-9-3">
<p>
The last verb we deal with, the DELETE action.
Again similar as GET but does a DELETE.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-delete"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-query/--delete</span> <span style="color: #006400;">(</span>query-map <span style="color: #D8FA3C;">&amp;optional</span> success-callback error-call<span style="color: #dc8cc3; background-color: #383838;">back</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"DELETE"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>method <span style="color: #00ff00;">(</span>orgtrello-query/--method query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>uri    <span style="color: #00ff00;">(</span>orgtrello-query/--uri    query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>sync   <span style="color: #00ff00;">(</span>orgtrello-query/--sync   query-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>request <span style="color: #ffff00;">(</span>orgtrello-query/--compute-url uri<span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:sync</span>    sync
             <span style="color: #FF6400;">:type</span>    <span style="color: #ffff00;">(</span>orgtrello-query/--compute-method method<span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:params</span>  `<span style="color: #ffff00;">(</span><span style="color: #00ff00;">(</span>key . ,*consumer-key*<span style="color: #00ff00;">)</span>
                        <span style="color: #00ff00;">(</span>token . ,*access-token*<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
             <span style="color: #FF6400;">:success</span> <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> success-callback success-callback 'standard-success-ca<span style="color: #dc8cc3; background-color: #383838;">llback</span><span style="color: #ffff00; background-color: #383838;">)</span>
             <span style="color: #FF6400;">:error</span>   <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">if</span> error-callback error-callback 'standard-error-callback<span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span>message <span style="color: #61CE3C;">"org-trello - orgtrello-query/ loaded!"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-10" class="outline-4">
<h4 id="sec-5-5-10">HTTP callbacks</h4>
<div class="outline-text-4" id="text-5-5-10">
<p>
Those are actions done at the end of the http request.
</p>
</div>

<div id="outline-container-sec-5-5-10-1" class="outline-5">
<h5 id="sec-5-5-10-1">standard-error-callback</h5>
<div class="outline-text-5" id="text-5-5-10-1">
<p>
The standard error-callback in charge of removing the orgtrello-marker written before synchronization.
This display an error message on the minibuffer too.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="standard-error-callback"><span style="color: #8b0000;">(</span>cl-defun standard-error-callback <span style="color: #006400;">(</span><span style="color: #D8FA3C;">&amp;key</span> error-thrown <span style="color: #D8FA3C;">&amp;allow-other-keys</span><span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Standard error callback"</span>
  <span style="color: #006400;">(</span>save-excursion
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">find the current entry through the pointer</span>
      <span style="color: #ff1493;">(</span>org-goto-local-search-headings *ORGTRELLO-MARKER* nil t<span style="color: #ff1493;">)</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">remove the marker now that we're done</span>
      <span style="color: #ff1493;">(</span>org-delete-property *ORGTRELLO-MARKER*<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span>message <span style="color: #61CE3C;">"There was some problem during the request to trello: %s"</span> error-throw<span style="color: #dc8cc3; background-color: #383838;">n</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-10-2" class="outline-5">
<h5 id="sec-5-5-10-2">standard-success-callback</h5>
<div class="outline-text-5" id="text-5-5-10-2">
<p>
A standard success callback that displays a simple message "Success." in the minibuffer.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="standard-success-callback"><span style="color: #8b0000;">(</span>cl-defun standard-success-callback <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Standard success callback"</span>
  <span style="color: #006400;">(</span>message <span style="color: #61CE3C;">"Success."</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-10-3" class="outline-5">
<h5 id="sec-5-5-10-3">simple-error-callback</h5>
<div class="outline-text-5" id="text-5-5-10-3">
<p>
A simpler error message callback which simply displays an error message on the minibuffer, indicating the error thrown by the execution of the request.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="simple-error-callback"><span style="color: #8b0000;">(</span>cl-defun simple-error-callback <span style="color: #006400;">(</span><span style="color: #D8FA3C;">&amp;key</span> error-thrown <span style="color: #D8FA3C;">&amp;allow-other-keys</span><span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Standard error callback"</span>
  <span style="color: #006400;">(</span>message <span style="color: #61CE3C;">"There was some problem during the request to trello: %s"</span> error-throw<span style="color: #dc8cc3; background-color: #383838;">n</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-10-4" class="outline-5">
<h5 id="sec-5-5-10-4">orgtrello-query/&#x2013;delete-success-callback</h5>
<div class="outline-text-5" id="text-5-5-10-4">
<p>
This one is the default delete success callback.
It needs to synchronize back the buffer to remove the entry we just destroyed on trello.
</p>
<ul class="org-ul">
<li>Return to the heading we want to delete
</li>
<li>Delete the property which represents the trello identifier
</li>
<li>Remove the full entity (for this we hide the subtree)
</li>
<li>Go at the beginning of the line
</li>
<li>Kill the next 2 lines
</li>
<li>At last display a simple message to notify the end of the removal.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-delete-success-callback"><span style="color: #8b0000;">(</span>cl-defun orgtrello-query/--delete-success-callback <span style="color: #006400;">(</span><span style="color: #D8FA3C;">&amp;key</span> data response <span style="color: #D8FA3C;">&amp;allow-o</span><span style="color: #dc8cc3; background-color: #383838;">ther-keys</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Callback function called at the end of a successful delete request."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">progn</span>
    <span style="color: #ff1493;">(</span>org-back-to-heading t<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>org-delete-property *ORGTRELLO-ID*<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>hide-subtree<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>beginning-of-line<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>kill-line<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>kill-line<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>message <span style="color: #61CE3C;">"Entity deleted!"</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5-10-5" class="outline-5">
<h5 id="sec-5-5-10-5">orgtrello-query/&#x2013;post-put-success-callback-update-id</h5>
<div class="outline-text-5" id="text-5-5-10-5">
<p>
This one is the default post/put success callback.
It's in charge of updating the org buffer with the trello id for the entity that has been synchronized.
What it does:
</p>
<ul class="org-ul">
<li>Get back to the current max header
</li>
<li>Then place itself to the org-trello marker put at the beginning of the synchronization.
</li>
<li>Remove such marker
</li>
<li>Get the current header information
</li>
<li>If an identifier is already present, simply display a message. Otherwise, add the property orgtrello-id with the identifier returned by the query.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-query/-post-put-success-callback-update-id"><span style="color: #8b0000;">(</span>cl-defun orgtrello-query/--post-put-success-callback-update-id <span style="color: #006400;">(</span><span style="color: #D8FA3C;">&amp;key</span> data <span style="color: #D8FA3C;">&amp;allo</span><span style="color: #dc8cc3; background-color: #383838;">w-other-keys</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Called back function at the end of the post/put request to update the trello </span><span style="color: #dc8cc3; background-color: #383838;">id in the org-mode file."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello-query/--entry-new-id <span style="color: #00ff00;">(</span>orgtrello-query/--id data<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello-query/--entry-name   <span style="color: #00ff00;">(</span>orgtrello-query/--name data<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">will update via tag the trello id of the new persisted data (if needed)</span>
    <span style="color: #ff1493;">(</span>save-excursion
      <span style="color: #8B8989; font-style: italic;">;;</span><span style="color: #8B8989; font-style: italic;">(while (org-up-heading-safe))</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">find the current entry through the pointer</span>
      <span style="color: #ffff00;">(</span>org-goto-local-search-headings *ORGTRELLO-MARKER* nil t<span style="color: #ffff00;">)</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">remove the marker now that we're done</span>
      <span style="color: #ffff00;">(</span>org-delete-property *ORGTRELLO-MARKER*<span style="color: #ffff00;">)</span>
      <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">now we extract the data</span>
      <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>orgtrello-query/--entry-metadata <span style="color: #ffa500;">(</span>orgtrello-data/metadata<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
             <span style="color: #add8e6;">(</span>orgtrello-query/--entry-id       <span style="color: #ffa500;">(</span>orgtrello/--id orgtrello-query/-<span style="color: #dc8cc3; background-color: #383838;">-entry-metadata</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
        <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> orgtrello-query/--entry-id <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">id already present in the org-mode fil</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">e</span>
            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">no need to add another</span>
            <span style="color: #add8e6;">(</span>message <span style="color: #61CE3C;">"Entity '%s' synced with id '%s'"</span> orgtrello-query/--entry-n<span style="color: #dc8cc3; background-color: #383838;">ame orgtrello-query/--entry-id</span><span style="color: #add8e6; background-color: #383838;">)</span>
          <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">progn</span>
            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">not present, this was just created, we add a simple property</span>
            <span style="color: #ffa500;">(</span>org-set-property *ORGTRELLO-ID* orgtrello-query/--entry-new-id<span style="color: #ffa500;">)</span>
            <span style="color: #ffa500;">(</span>message <span style="color: #61CE3C;">"Newly entity '%s' synced with id '%s'"</span> orgtrello-query/--e<span style="color: #dc8cc3; background-color: #383838;">ntry-name orgtrello-query/--entry-new-id</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6">orgtrello-api</h3>
<div class="outline-text-3" id="text-5-6">
<p>
This is the namespace responsible for the interface with trello's public api.
We have decoupled the http request from the http request data structure.
This way, we can test the api's request.
</p>
</div>

<div id="outline-container-sec-5-6-1" class="outline-4">
<h4 id="sec-5-6-1">orgtrello-api/add-board</h4>
<div class="outline-text-4" id="text-5-6-1">
<p>
A simple function to create a board.
We need a name and an optional description.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/add-board">&#12;

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">#################### orgtrello-api</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/add-board</span> <span style="color: #006400;">(</span>name <span style="color: #D8FA3C;">&amp;optional</span> description<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Create a board"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>payload <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> description
                      `<span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffa500;">)</span>
                        <span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"desc"</span> . ,description<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
                    `<span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:post</span> <span style="color: #61CE3C;">"/boards"</span> payload<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-2" class="outline-4">
<h4 id="sec-5-6-2">orgtrello-api/get-boards</h4>
<div class="outline-text-4" id="text-5-6-2">
<p>
A function to retrieve the list of boards of the user.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-boards"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-boards</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Retrieve the boards of the current user."</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #61CE3C;">"/members/me/boards"</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-3" class="outline-4">
<h4 id="sec-5-6-3">orgtrello-api/get-board</h4>
<div class="outline-text-4" id="text-5-6-3">
<p>
A function to retrieve all the information about the board with id.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-board"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-board</span> <span style="color: #006400;">(</span>id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve the boards of the current user."</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/boards/%s"</span> id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-4" class="outline-4">
<h4 id="sec-5-6-4">orgtrello-api/get-cards</h4>
<div class="outline-text-4" id="text-5-6-4">
<p>
Retrieve all the cards from the board with id board-id.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-cards"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-cards</span> <span style="color: #006400;">(</span>board-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"cards of a board"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/boards/%s/cards"</span> board-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-5" class="outline-4">
<h4 id="sec-5-6-5">orgtrello-api/get-card</h4>
<div class="outline-text-4" id="text-5-6-5">
<p>
Retrieve the information of the specific card with id card-id.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-card</span> <span style="color: #006400;">(</span>card-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Detail of a card with id card-id."</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/cards/%s"</span> card-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-6" class="outline-4">
<h4 id="sec-5-6-6">orgtrello-api/delete-card</h4>
<div class="outline-text-4" id="text-5-6-6">
<p>
Delete the card with id card-id.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/delete-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/delete-card</span> <span style="color: #006400;">(</span>card-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Delete a card with id card-id."</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:delete</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/cards/%s"</span> card-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-7" class="outline-4">
<h4 id="sec-5-6-7">orgtrello-api/get-lists</h4>
<div class="outline-text-4" id="text-5-6-7">
<p>
Retrieve the lists of the board with id board-id.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-lists"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-lists</span> <span style="color: #006400;">(</span>board-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Display the lists of the board"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/boards/%s/lists"</span> board-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-8" class="outline-4">
<h4 id="sec-5-6-8">orgtrello-api/close-list</h4>
<div class="outline-text-4" id="text-5-6-8">
<p>
We need a routine to be able to close a list (typically when we create a board, we do not want the default list created by trello).
So a function to close a specific list with id list-id.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/close-list"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/close-list</span> <span style="color: #006400;">(</span>list-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"'Close' the list with id list-id."</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:put</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/lists/%s/closed"</span> list-id<span style="color: #ff1493;">)</span> '<span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>value . <span style="color: #dc8cc3; background-color: #383838;">t</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-9" class="outline-4">
<h4 id="sec-5-6-9">orgtrello-api/get-list</h4>
<div class="outline-text-4" id="text-5-6-9">
<p>
Retrieve the information about the list with id list-id.
</p>
<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-list"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-list</span> <span style="color: #006400;">(</span>list-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Get a list by id"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/lists/%s"</span> list-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-10" class="outline-4">
<h4 id="sec-5-6-10">orgtrello-api/add-list</h4>
<div class="outline-text-4" id="text-5-6-10">
<p>
Adding a list named <i>name</i> to a board with id <i>idBoard</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/add-list"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/add-list</span> <span style="color: #006400;">(</span>name idBoard<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Add a list - the name and the board id are mandatory (so i say!)."</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:post</span> <span style="color: #61CE3C;">"/lists/"</span> `<span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffff00;">)</span> <span style="color: #ffff00;">(</span><span style="color: #61CE3C;">"idBoard"</span> . ,idB<span style="color: #dc8cc3; background-color: #383838;">oard</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-11" class="outline-4">
<h4 id="sec-5-6-11">orgtrello-api/add-card</h4>
<div class="outline-text-4" id="text-5-6-11">
<p>
Adding a card with name <i>name</i> to the list idList.
Optionally, we can use a due date.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/add-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/add-card</span> <span style="color: #006400;">(</span>name idList <span style="color: #D8FA3C;">&amp;optional</span> due<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Add a card to a board"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello-api/add-card--default-params `<span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #add8e6;">)</span> <span style="color: #add8e6;">(</span><span style="color: #61CE3C;">"idList"</span> . <span style="color: #dc8cc3; background-color: #383838;">,idList</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello-api/add-card--params <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> due <span style="color: #add8e6;">(</span>cons `<span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"due"</span> . ,due<span style="color: #ffa500;">)</span> orgtrello<span style="color: #dc8cc3; background-color: #383838;">-api/add-card--default-params</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> orgtrello-api/add-card--default-params</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:post</span> <span style="color: #61CE3C;">"/cards/"</span> orgtrello-api/add-card--params<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-12" class="outline-4">
<h4 id="sec-5-6-12">orgtrello-api/get-cards-from-list</h4>
<div class="outline-text-4" id="text-5-6-12">
<p>
A function to retrieve the full list of cards a list with id <i>list-id</i> owns.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-cards-from-list"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-cards-from-list</span> <span style="color: #006400;">(</span>list-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"List all the cards"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/lists/%s/cards"</span> list-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-13" class="outline-4">
<h4 id="sec-5-6-13">orgtrello-api/move-card</h4>
<div class="outline-text-4" id="text-5-6-13">
<p>
An update function for the card card-id which belongs to the idList.
This can simply move the card from its current list to another.
Optionally, we can rename the card to <i>name</i> and update its <i>due</i> date.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/move-card"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/move-card</span> <span style="color: #006400;">(</span>card-id idList <span style="color: #D8FA3C;">&amp;optional</span> name due<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Move a card to another list"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello-api/move-card--default-params `<span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span><span style="color: #61CE3C;">"idList"</span> . ,idList<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello-api/move-card--params-name <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> name <span style="color: #add8e6;">(</span>cons `<span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffa500;">)</span> <span style="color: #dc8cc3; background-color: #383838;">orgtrello-api/move-card--default-params</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> orgtrello-api/move-card--default-params</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello-api/move-card--params-due  <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> due <span style="color: #add8e6;">(</span>cons `<span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"due"</span> . ,due<span style="color: #ffa500;">)</span> org<span style="color: #dc8cc3; background-color: #383838;">trello-api/move-card--params-name</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> orgtrello-api/move-card--params-name</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:put</span> <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"/cards/%s"</span> card-id<span style="color: #ffff00;">)</span> orgtrello-api/mo<span style="color: #dc8cc3; background-color: #383838;">ve-card--params-due</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-14" class="outline-4">
<h4 id="sec-5-6-14">orgtrello-api/add-checklist</h4>
<div class="outline-text-4" id="text-5-6-14">
<p>
We can add a checklist entitled <i>name</i> to the card with id <i>card-id</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/add-checklist"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/add-checklist</span> <span style="color: #006400;">(</span>card-id name<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Add a checklist to a card"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:post</span>
             <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/cards/%s/checklists"</span> card-id<span style="color: #ff1493;">)</span>
             `<span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-15" class="outline-4">
<h4 id="sec-5-6-15">orgtrello-api/update-checklist</h4>
<div class="outline-text-4" id="text-5-6-15">
<p>
Also, we can update the checklist with id <i>checklist-id</i> to a new name <i>name</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/update-checklist"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/update-checklist</span> <span style="color: #006400;">(</span>checklist-id name<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Update the checklist's name"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:put</span>
             <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/checklists/%s"</span> checklist-id<span style="color: #ff1493;">)</span>
             `<span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-16" class="outline-4">
<h4 id="sec-5-6-16">orgtrello-api/get-checklists</h4>
<div class="outline-text-4" id="text-5-6-16">
<p>
Retrieve the list of checklist from the card with id <i>card-id</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-checklists"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-checklists</span> <span style="color: #006400;">(</span>card-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"List the checklists of a card"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/cards/%s/checklists"</span> card-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-17" class="outline-4">
<h4 id="sec-5-6-17">orgtrello-api/get-checklist</h4>
<div class="outline-text-4" id="text-5-6-17">
<p>
Or simply retrieve the detail about the checklist with id <i>checklist-id</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-checklist"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-checklist</span> <span style="color: #006400;">(</span>checklist-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Retrieve all the information from a checklist"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/checklists/%s"</span> checklist-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-18" class="outline-4">
<h4 id="sec-5-6-18">orgtrello-api/delete-checklist</h4>
<div class="outline-text-4" id="text-5-6-18">
<p>
We need to be able to remove checklist <i>checklist-id</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/delete-checklist"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/delete-checklist</span> <span style="color: #006400;">(</span>checklist-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Delete a checklist with checklist-id"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:delete</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/checklists/%s"</span> checklist-id<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-19" class="outline-4">
<h4 id="sec-5-6-19">orgtrello-api/add-tasks</h4>
<div class="outline-text-4" id="text-5-6-19">
<p>
Adding a task/item entitled <i>name</i> to the checklist <i>checklist-id</i> with an optional <i>checked</i> state.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/add-tasks"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/add-tasks</span> <span style="color: #006400;">(</span>checklist-id name <span style="color: #D8FA3C;">&amp;optional</span> checked<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Add todo tasks (trello items) to a checklist with id 'id'"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>payload <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> checked
                      `<span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"name"</span>  . ,name<span style="color: #ffa500;">)</span> <span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"checked"</span> . ,checked<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
                    `<span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:post</span> <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"/checklists/%s/checkItems"</span> checklis<span style="color: #dc8cc3; background-color: #383838;">t-id</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> payload</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-20" class="outline-4">
<h4 id="sec-5-6-20">orgtrello-api/update-task</h4>
<div class="outline-text-4" id="text-5-6-20">
<p>
A function to deal with the update of the task/item with id <i>task-id</i> and name <i>name</i> from the checklist <i>checklist-id</i> (trello api forces the <i>card</i>-id too).
Optionally, we can change its checked <i>state</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/update-task"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/update-task</span> <span style="color: #006400;">(</span>card-id checklist-id task-id name <span style="color: #D8FA3C;">&amp;optional</span> st<span style="color: #dc8cc3; background-color: #383838;">ate</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #61CE3C;">"Update a task"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>payload <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> state
                      `<span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"name"</span>  . ,name<span style="color: #ffa500;">)</span> <span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"state"</span> . ,state<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
                    `<span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span><span style="color: #61CE3C;">"name"</span> . ,name<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-hash/make-hash
     <span style="color: #FF6400;">:put</span>
     <span style="color: #ffff00;">(</span>format <span style="color: #61CE3C;">"/cards/%s/checklist/%s/checkItem/%s"</span> card-id checklist-id task-id<span style="color: #ffff00;">)</span>
     payload<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-21" class="outline-4">
<h4 id="sec-5-6-21">orgtrello-api/get-tasks</h4>
<div class="outline-text-4" id="text-5-6-21">
<p>
Retrieve the list of tasks from the checklist <i>checklist-id</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/get-tasks"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/get-tasks</span> <span style="color: #006400;">(</span>checklist-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"List the checklist items."</span>
    <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:get</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/checklists/%s/checkItems/"</span> checklis<span style="color: #dc8cc3; background-color: #383838;">t-id</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6-22" class="outline-4">
<h4 id="sec-5-6-22">orgtrello-api/delete-task</h4>
<div class="outline-text-4" id="text-5-6-22">
<p>
To keep the symmetry with the other entities, we need to be able to destroy the task/item <i>task-id</i> from the checklist <i>checklist-id</i>.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-api/delete-task"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-api/delete-task</span> <span style="color: #006400;">(</span>checklist-id task-id<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Delete a task with id task-id"</span>
  <span style="color: #006400;">(</span>orgtrello-hash/make-hash <span style="color: #FF6400;">:delete</span> <span style="color: #ff1493;">(</span>format <span style="color: #61CE3C;">"/checklists/%s/checkItems/%s"</span> check<span style="color: #dc8cc3; background-color: #383838;">list-id task-id</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span>message <span style="color: #61CE3C;">"org-trello - orgtrello-api loaded!"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7">orgtrello-data</h3>
<div class="outline-text-3" id="text-5-7">
<p>
Namespace in charge of manipulating/extracting the org buffer's data.
</p>
</div>

<div id="outline-container-sec-5-7-1" class="outline-4">
<h4 id="sec-5-7-1">orgtrello-data/&#x2013;convert-orgmode-date-to-trello-date</h4>
<div class="outline-text-4" id="text-5-7-1">
<p>
A simple function to help in transforming the org format used in deadline into trello format.
This is really basic.
We must improve this.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-data/-convert-orgmode-date-to-trello-date">&#12;

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">#################### orgtrello-data</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defvar</span> <span style="color: #D8FA3C;">*ORGTRELLO-ID*</span> <span style="color: #61CE3C;">"orgtrello-id"</span> <span style="color: #61CE3C;">"Marker used for the trello identifier"</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-data/--convert-orgmode-date-to-trello-date</span> <span style="color: #006400;">(</span>orgmode-date<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Convert the org-mode deadline into a time adapted for trello."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ff1493;">(</span>and orgmode-date <span style="color: #ffff00;">(</span>not <span style="color: #00ff00;">(</span>string-match-p <span style="color: #61CE3C;">"T*Z"</span> orgmode-date<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
      <span style="color: #ff1493;">(</span>cl-destructuring-bind <span style="color: #ffff00;">(</span>sec min hour day mon year dow dst tz<span style="color: #ffff00;">)</span>
                             <span style="color: #ffff00;">(</span>--map <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> it
                                        <span style="color: #add8e6;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffa500;">(</span>&lt; it 10<span style="color: #ffa500;">)</span>
                                            <span style="color: #ffa500;">(</span>concat <span style="color: #61CE3C;">"0"</span> <span style="color: #6a5acd;">(</span>int-to-string it<span style="color: #6a5acd;">)</span><span style="color: #ffa500;">)</span>
                                          <span style="color: #ffa500;">(</span>int-to-string it<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>
                                    <span style="color: #00ff00;">(</span>parse-time-string orgmode-date<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
                             <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>year-mon-day <span style="color: #ffa500;">(</span>concat year <span style="color: #61CE3C;">"-"</span> mon <span style="color: #61CE3C;">"-"</span> day <span style="color: #61CE3C;">"</span><span style="color: #dc8cc3; background-color: #383838;">T"</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span>
                                    <span style="color: #add8e6;">(</span>hour-min-sec <span style="color: #ffa500;">(</span><span style="color: #FBDE2D;">if</span> hour <span style="color: #6a5acd;">(</span>concat hour <span style="color: #61CE3C;">":"</span> min <span style="color: #dc8cc3; background-color: #383838;">":"</span><span style="color: #dc8cc3; background-color: #383838;"> sec</span><span style="color: #6a5acd; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #dc8cc3; background-color: #383838;">"00:00:00"</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span>
                               <span style="color: #00ff00;">(</span>concat year-mon-day hour-min-sec <span style="color: #61CE3C;">".000Z"</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    orgmode-date<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-7-2" class="outline-4">
<h4 id="sec-5-7-2">orgtrello-data/metadata</h4>
<div class="outline-text-4" id="text-5-7-2">
<p>
This is an important routine which will extract all the informations from the org buffer for a given entity (typically the entity under the caret's current position):
</p>
<ul class="org-ul">
<li>level
</li>
<li>label
</li>
<li>id
</li>
<li>due
</li>
</ul>
<p>
This uses org's api and add some extra information specific to org-trello.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-data/metadata"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-data/metadata</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Compute the metadata from the org-heading-components entry, add the identifie</span><span style="color: #dc8cc3; background-color: #383838;">r and extract the metadata needed."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>orgtrello-data/metadata--id       <span style="color: #00ff00;">(</span>org-entry-get <span style="color: #add8e6;">(</span>point<span style="color: #add8e6;">)</span> *ORGTRELLO-ID<span style="color: #dc8cc3; background-color: #383838;">*</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello-data/metadata--due      <span style="color: #00ff00;">(</span>orgtrello-data/--convert-orgmode-da<span style="color: #dc8cc3; background-color: #383838;">te-to-trello-date </span><span style="color: #add8e6; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">org-entry-get </span><span style="color: #ffa500; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">point</span><span style="color: #ffa500; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #dc8cc3; background-color: #383838;">"DEADLINE"</span><span style="color: #add8e6; background-color: #383838;">)</span><span style="color: #00ff00; background-color: #383838;">)</span><span style="color: #ffff00; background-color: #383838;">)</span>
         <span style="color: #ffff00;">(</span>orgtrello-data/metadata--metadata <span style="color: #00ff00;">(</span>org-heading-components<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>-&gt;&gt; orgtrello-data/metadata--metadata
         <span style="color: #ffff00;">(</span>cons orgtrello-data/metadata--due<span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>cons orgtrello-data/metadata--id<span style="color: #ffff00;">)</span>
         orgtrello-data/--get-metadata<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-7-3" class="outline-4">
<h4 id="sec-5-7-3">orgtrello-data/&#x2013;parent-metadata</h4>
<div class="outline-text-4" id="text-5-7-3">
<p>
This function permits to retrieve the metadata of the current entry.
Note that if we are to the upper level already, this will return the exact same data as the current entry.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-data/-parent-metadata"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-data/--parent-metadata</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Extract the metadata from the current heading's parent."</span>
  <span style="color: #006400;">(</span>save-excursion
    <span style="color: #ff1493;">(</span>org-up-heading-safe<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-data/metadata<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-7-4" class="outline-4">
<h4 id="sec-5-7-4">orgtrello-data/&#x2013;grandparent-metadata</h4>
<div class="outline-text-4" id="text-5-7-4">
<p>
Again, from a current entry, return the metadata of the grand-parent entry.
Note again that if we are to the upper level, the same data as the current entry will be returned.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-data/-grandparent-metadata"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-data/--grandparent-metadata</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Extract the metadata from the current heading's grandparent."</span>
  <span style="color: #006400;">(</span>save-excursion
    <span style="color: #ff1493;">(</span>org-up-heading-safe<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>org-up-heading-safe<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>orgtrello-data/metadata<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-7-5" class="outline-4">
<h4 id="sec-5-7-5">orgtrello-data/entry-get-full-metadata</h4>
<div class="outline-text-4" id="text-5-7-5">
<p>
This is an orchestration from the previous functions.
This will return a map with as key:
</p>
<ul class="org-ul">
<li>:current     the current entity under the caret's position
</li>
<li>:parent      the current entity's parent
</li>
<li>:grandparent the current entity's grandparent
</li>
</ul>

<p>
If the level of the current entity exceeds level 4, the entry is dismissed (only 3 levels can be compatible in trello) so the function will return nil.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-data/entry-get-full-metadata"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-data/entry-get-full-metadata</span> <span style="color: #006400;">()</span>
  <span style="color: #61CE3C;">"Compute the metadata needed for one entry into a map with keys :current, :par</span><span style="color: #dc8cc3; background-color: #383838;">ent, :grandparent.</span>
<span style="color: #61CE3C;">   Returns nil if the level is superior to 4."</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>heading <span style="color: #00ff00;">(</span>orgtrello-data/metadata<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
         <span style="color: #ffff00;">(</span>level   <span style="color: #00ff00;">(</span>gethash <span style="color: #FF6400;">:level</span> heading<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>&lt; level 4<span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">let*</span> <span style="color: #00ff00;">(</span><span style="color: #add8e6;">(</span>parent-heading      <span style="color: #ffa500;">(</span>orgtrello-data/--parent-metadata<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>grandparent-heading <span style="color: #ffa500;">(</span>orgtrello-data/--grandparent-metadata<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span>
               <span style="color: #add8e6;">(</span>mapdata <span style="color: #ffa500;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #ffa500;">)</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span>
          <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">build the metadata with every important pieces</span>
          <span style="color: #00ff00;">(</span>puthash <span style="color: #FF6400;">:current</span>     heading             mapdata<span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span>puthash <span style="color: #FF6400;">:parent</span>      parent-heading      mapdata<span style="color: #00ff00;">)</span>
          <span style="color: #00ff00;">(</span>puthash <span style="color: #FF6400;">:grandparent</span> grandparent-heading mapdata<span style="color: #00ff00;">)</span>
          mapdata<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-7-6" class="outline-4">
<h4 id="sec-5-7-6">orgtrello-data/&#x2013;get-metadata</h4>
<div class="outline-text-4" id="text-5-7-6">
<p>
An adapter function to transform any org data into org-trello data.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-data/-get-metadata"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-data/--get-metadata</span> <span style="color: #006400;">(</span>heading-metadata<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Given the heading-metadata returned by the function 'org-heading-components, </span><span style="color: #dc8cc3; background-color: #383838;">make it a hashmap with key :level, :keyword, :title. and their respective value"</span>
  <span style="color: #006400;">(</span>cl-destructuring-bind <span style="color: #ff1493;">(</span>id due level _ keyword _ title <span style="color: #D8FA3C;">&amp;rest</span><span style="color: #ff1493;">)</span> heading-metadata
                         <span style="color: #ff1493;">(</span>orgtrello-hash/make-hash-org level keyword title id du<span style="color: #dc8cc3; background-color: #383838;">e</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span>message <span style="color: #61CE3C;">"org-trello - orgtrello-data loaded!"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5-8" class="outline-3">
<h3 id="sec-5-8">orgtrello-hash</h3>
<div class="outline-text-3" id="text-5-8">
<p>
Utility namespace in charge of simplifying the construction of org-trello data.
</p>
</div>

<div id="outline-container-sec-5-8-1" class="outline-4">
<h4 id="sec-5-8-1">orgtrello-hash/make-hash-org</h4>
<div class="outline-text-4" id="text-5-8-1">
<p>
A simple factory function to create a map from the needed org entity data.
</p>
<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-hash/make-hash-org">&#12;

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">#################### orgtrello-hash</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-hash/make-hash-org</span> <span style="color: #006400;">(</span>level keyword title id due<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Utility function to ease the creation of the orgtrello-metadata"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>h <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:level</span>   level   h<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:keyword</span> keyword h<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:title</span>   title   h<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:id</span>      id      h<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:due</span>     due     h<span style="color: #ff1493;">)</span>
    h<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-8-2" class="outline-4">
<h4 id="sec-5-8-2">orgtrello-hash/make-hash</h4>
<div class="outline-text-4" id="text-5-8-2">
<p>
A simple utility function to help in creating the http request map to feed to the orgtrello-query namespace.
</p>

<div class="org-src-container">

<pre class="src src-lisp" id="orgtrello-hash/make-hash"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defun</span> <span style="color: #ff1493;">orgtrello-hash/make-hash</span> <span style="color: #006400;">(</span>method uri <span style="color: #D8FA3C;">&amp;optional</span> params<span style="color: #006400;">)</span>
  <span style="color: #61CE3C;">"Utility function to ease the creation of the map - wait, where are my clojure</span><span style="color: #dc8cc3; background-color: #383838;"> data again!?"</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">(</span><span style="color: #ffff00;">(</span>h <span style="color: #00ff00;">(</span>make-hash-table <span style="color: #FF6400;">:test</span> 'equal<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:method</span> method h<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span>puthash <span style="color: #FF6400;">:uri</span>    uri    h<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> params <span style="color: #ffff00;">(</span>puthash <span style="color: #FF6400;">:params</span> params h<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
    h<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>message <span style="color: #61CE3C;">"org-trello - orgtrello-hash loaded!"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Resulting</h2>
<div class="outline-text-2" id="text-6">
<p>
Now let's generate the full code.
</p>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Source</h2>
<div class="outline-text-2" id="text-7">
<p>
Project: <a href="http://ardumont.github.io/org-trello/">http://ardumont.github.io/org-trello/</a>
source: <a href="https://github.com/org-trello/org-trello/blob/master/org-trello.org">org-trello.org</a>
</p>
</div>
</div>
