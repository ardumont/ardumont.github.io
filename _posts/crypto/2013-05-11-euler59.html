---
layout: post
title: XOR decryption - Euler 59 in Clojure
date: 2013-05-11
categories:
- clojure
- crypto
- euler-project
- exercises
- xor
author: nil
excerpt: XOR decryption in Clojure
---
<p>
It has been some time since I solved an <a href="https://projecteuler.net/">euler project</a> problem.
As I'm learning stuff around cryptography, I thought this was about the right time to solve the xor decryption <a href="http://projecteuler.net/problem=59">euler 59</a> in clojure.
</p>

<p>
<span class="underline">Disclaimer:</span>
If you read this post, you will have a solution to the <a href="http://projecteuler.net/problem=59">euler 59 problem</a>. Don't come and blame me for posting the solution.
A more constructive approach would be to try and solve the problem yourself and then come back to confront your solution against mine.
</p>

<p>
<span class="underline">Note:</span>
As usual, you will find <code>fact</code> just below the code that are tests using the midje testing library.
This gives documentation about use cases of the functions.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Problem</h2>
<div class="outline-text-2" id="text-1">
<blockquote>
<p>
Each character on a computer is assigned a unique code and the preferred standard is ASCII (American Standard Code for Information Interchange).
For example, uppercase A = 65, asterisk (*) = 42, and lowercase k = 107.
A modern encryption method is to take a text file, convert the bytes to ASCII, then XOR each byte with a given value, taken from a secret key.
The advantage with the XOR function is that using the same encryption key on the cipher text, restores the plain text; for example, 65 XOR 42 = 107, then 107 XOR 42 = 65.
For unbreakable encryption, the key is the same length as the plain text message, and the key is made up of random bytes.
The user would keep the encrypted message and the encryption key in different locations, and without both "halves", it is impossible to decrypt the message.
Unfortunately, this method is impractical for most users, so the modified method is to use a password as a key.
If the password is shorter than the message, which is likely, the key is repeated cyclically throughout the message.
The balance for this method is using a sufficiently long password key for security, but short enough to be memorable.
Your task has been made easy, as the encryption key consists of three lower case characters. Using cipher1.txt (right click and 'Save Link/Target As&#x2026;'), a file containing the encrypted ASCII codes, and the knowledge that the plain text must contain common English words, decrypt the message and find the sum of the ASCII values in the original text.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Solution</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Data</h3>
<div class="outline-text-3" id="text-2-1">
<p>
First we need to load the file and "clojurify" it.
The content of the file is simply a list of comma separated bytes.
</p>

<p>
So we need simply to load the file and replace every ',' or 'newline' character with a <code>space</code> character, enclose the string into <code>[</code> <code>]</code> and let the clojure reader do it's magic.
This will return a byte vector that we can manipulate in the rest of the article to solve the problem.
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">load-csv</span>
  <span style="color: #2aa198;">"Compute a comma separated bytes values into a clojure byte vector."</span>
  <span style="color: #006400;">[</span>s<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>read-string <span style="color: #ff1493;">(</span>str <span style="color: #61CE3C;">"["</span> <span style="color: #ffff00;">(</span><span style="color: #D8FA3C;">string</span>/replace s #<span style="color: #61CE3C;">",</span><span style="color: #ff0000; font-weight: bold;">|</span><span style="color: #61CE3C;">\n"</span> <span style="color: #61CE3C;">" "</span><span style="color: #ffff00;">)</span> <span style="color: #61CE3C;">"]"</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>load-csv <span style="color: #61CE3C;">"1, 2, 4, 8"</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>1 2 4 8<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">load-f</span> <span style="color: #2aa198;">"Load the file"</span>
  <span style="color: #006400;">[</span>filepath<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;</span> filepath
      slurp
      load-csv<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">def</span> <span style="color: #D8FA3C;">ascii-encrypted</span> <span style="color: #006400;">(</span>load-f <span style="color: #61CE3C;">"./resources/euler-59-cipher"</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>

<p>
<a href="https://github.com/ardumont/crypto/blob/master/src/crypto/euler59.clj">euler59.clj</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Cipher</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Now that we loaded the data, we need to decrypt the text.
For this we need to:
</p>
<ul class="org-ul">
<li>compute the key
</li>
<li>decipher the text using the key
</li>
</ul>
</div>

<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">Key</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Here is the main call to compute the key:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">def</span> <span style="color: #D8FA3C;">key-cipher</span> <span style="color: #006400;">(</span><span style="color: #D8FA3C;">key</span>/compute-key ascii-encrypted 3<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>

<div id="outline-container-sec-2-2-1-1" class="outline-5">
<h5 id="sec-2-2-1-1">compute-key</h5>
<div class="outline-text-5" id="text-2-2-1-1">
<p>
The compute-key function has 2 arities:
</p>
<ul class="org-ul">
<li>(<code>[byte-input]</code>): This one will first compute the keysize and then the key.
</li>
<li>(<code>[byte-input key-size]</code>): This will simply compute the key.
</li>
</ul>


<p>
As we do not need to determine the keysize, so we can concentrate on the second arity (<code>[byte-input key-size]</code>).
</p>

<p>
The idea is:
</p>
<ul class="org-ul">
<li>as we know the keysize, it means that each byte at a position <code>n mod keysize</code> is a different character enciphered by the same character key.
</li>
</ul>
<p>
Don't forget this problem sentence "If the password is shorter than the message, which is likely, the key is repeated cyclically throughout the message.".
</p>
<ul class="org-ul">
<li>so we can create a byte vector of all characters enciphered by the same character key
</li>
<li>then brute force each 'key-character-to-determine block' (we will be using frequency attack underneath).
</li>
<li>at last, join each character key found into a string and there we have the key (as we kept the block in character order).
</li>
</ul>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">compute-key</span>
  <span style="color: #2aa198;">"Given a byte-input, compute its keysize and try and compute the key by transp</span><span style="color: #dc8cc3; background-color: #383838;">osing block of keysize."</span>
  <span style="color: #006400;">(</span><span style="color: #ff1493;">[</span>byte-input<span style="color: #ff1493;">]</span>
     <span style="color: #ff1493;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ffff00;">(</span>range 2 40<span style="color: #ffff00;">)</span>
          <span style="color: #ffff00;">(</span>keysize byte-input<span style="color: #ffff00;">)</span>
          <span style="color: #ffff00;">(</span>compute-key byte-input<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #ff1493;">[</span>byte-input key-size<span style="color: #ff1493;">]</span>
     <span style="color: #ff1493;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ffff00;">(</span><span style="color: #D8FA3C;">block</span>/transpose byte-input key-size<span style="color: #ffff00;">)</span>
          <span style="color: #ffff00;">(</span>map <span style="color: #00ff00;">(</span>comp first <span style="color: #D8FA3C;">xor</span>/decrypt-brute-force<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
          <span style="color: #ffff00;">(</span><span style="color: #D8FA3C;">string</span>/join <span style="color: #61CE3C;">""</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">let</span> <span style="color: #ff1493;">[</span>msg-to-encrypt <span style="color: #61CE3C;">"Let's continue our assumption that this text file is wri</span><span style="color: #dc8cc3; background-color: #383838;">tten in English. Therefore, we know which words are the most common in this language. We also know that each byte represents a character that stands for a letter or punctuation mark in the text. So it has a meaning. Because in every text different parts and words appear multiple times, we can use an algorithm that applies XOR until we get a meaningful text-file. This stands for a text file that does not contain gibberish."</span><span style="color: #ff1493; background-color: #383838;">]</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;</span> <span style="color: #ffff00;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"secret"</span>
         <span style="color: #4c83ff; font-weight: bold;">:msg</span> msg-to-encrypt<span style="color: #ffff00;">}</span>
        <span style="color: #D8FA3C;">xor</span>/encrypt-bytes
        <span style="color: #ffff00;">(</span>compute-key <span style="color: #00ff00;">(</span>count <span style="color: #61CE3C;">"secret"</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span> =&gt; <span style="color: #61CE3C;">"secret"</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;</span> <span style="color: #ffff00;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"secret"</span>
         <span style="color: #4c83ff; font-weight: bold;">:msg</span> msg-to-encrypt<span style="color: #ffff00;">}</span>
        <span style="color: #D8FA3C;">xor</span>/encrypt-bytes
        compute-key<span style="color: #ff1493;">)</span>                    =&gt; <span style="color: #61CE3C;">"secret"</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
<p>
<a href="https://github.com/ardumont/crypto/blob/master/src/crypto/key.clj#L45">key.clj</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-2-1-2" class="outline-5">
<h5 id="sec-2-2-1-2">block/transpose</h5>
<div class="outline-text-5" id="text-2-2-1-2">
<p>
The <code>block/transpose</code> function to help in slicing the bytes vector into the same enciphered character block:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">transpose</span>
  <span style="color: #2aa198;">"Given a data vector v and a size n, return the data vector transposed in row,</span><span style="color: #dc8cc3; background-color: #383838;"> column vector."</span>
  <span style="color: #006400;">[</span>v n<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> v
       <span style="color: #ff1493;">(</span>reduce
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D; font-weight: bold;">fn</span> <span style="color: #00ff00;">[</span><span style="color: #add8e6;">[</span>i m<span style="color: #add8e6;">]</span> b<span style="color: #00ff00;">]</span>
          <span style="color: #00ff00;">(</span><span style="color: #FBDE2D; font-weight: bold;">let</span> <span style="color: #add8e6;">[</span>idx <span style="color: #ffa500;">(</span><span style="color: #FBDE2D; font-weight: bold;">if</span> <span style="color: #6a5acd;">(</span>zero? i<span style="color: #6a5acd;">)</span> 0 <span style="color: #6a5acd;">(</span>mod i n<span style="color: #6a5acd;">)</span><span style="color: #ffa500;">)</span><span style="color: #add8e6;">]</span>
            <span style="color: #add8e6;">[</span><span style="color: #ffa500;">(</span>+ 1 i<span style="color: #ffa500;">)</span> <span style="color: #ffa500;">(</span>update-in m <span style="color: #6a5acd;">[</span>idx<span style="color: #6a5acd;">]</span> conj b<span style="color: #ffa500;">)</span><span style="color: #add8e6;">]</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span>
        <span style="color: #ffff00;">[</span>0 <span style="color: #00ff00;">(</span>sorted-map<span style="color: #00ff00;">)</span><span style="color: #ffff00;">]</span><span style="color: #ff1493;">)</span>
       second
       <span style="color: #ff1493;">(</span>map <span style="color: #ffff00;">(</span>comp reverse second<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>transpose <span style="color: #ff1493;">[</span>0  1  2  3
              4  5  6  7
              8  9 10  11
              12 13 14 15
              16 17 18 19<span style="color: #ff1493;">]</span> 4<span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span><span style="color: #ff1493;">[</span>0 4 8 12 16<span style="color: #ff1493;">]</span>
                                  <span style="color: #ff1493;">[</span>1 5 9 13 17<span style="color: #ff1493;">]</span>
                                  <span style="color: #ff1493;">[</span>2 6 10 14 18<span style="color: #ff1493;">]</span>
                                  <span style="color: #ff1493;">[</span>3 7 11 15 19<span style="color: #ff1493;">]</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>
</pre>
</div>
<p>
<a href="https://github.com/ardumont/crypto/blob/master/src/crypto/block.clj#L20">block.clj</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-2-1-3" class="outline-5">
<h5 id="sec-2-2-1-3">decrypt-brute-force</h5>
<div class="outline-text-5" id="text-2-2-1-3">
<p>
The brute force algorithm's basis is the frequency of the english letters:
</p>
<ul class="org-ul">
<li>for each possible character in the range 0 to 255 (sure I could use less here), we elect it as a potential key character
</li>
<li>compute the xor operation on the byte block with the key
</li>
<li>compute the frequency difference to the result with the english frequency table
</li>
<li>the one character of all tested with the less difference is the one
</li>
</ul>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">decrypt-brute-force</span>
  <span style="color: #2aa198;">"Decrypt by brute forcing"</span>
  <span style="color: #006400;">[</span>byte-secret<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ff1493;">(</span>range 0 255<span style="color: #ff1493;">)</span>                                <span style="color: #586e75;">;; </span><span style="color: #8B8989; font-style: italic;">generate all possible cha</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">racters</span>
       <span style="color: #ff1493;">(</span>map <span style="color: #ffff00;">(</span><span style="color: #FBDE2D; font-weight: bold;">fn</span> <span style="color: #00ff00;">[</span>k<span style="color: #00ff00;">]</span> <span style="color: #00ff00;">[</span>k <span style="color: #add8e6;">(</span>xor byte-secret <span style="color: #ffa500;">[</span>k<span style="color: #ffa500;">]</span><span style="color: #add8e6;">)</span><span style="color: #00ff00;">]</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>     <span style="color: #586e75;">;; </span><span style="color: #8B8989; font-style: italic;">compute xor it with the f</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">ixed hex encrypted secret</span>
       <span style="color: #ff1493;">(</span>reduce
        <span style="color: #ffff00;">(</span><span style="color: #FBDE2D; font-weight: bold;">fn</span> <span style="color: #00ff00;">[</span>m <span style="color: #add8e6;">[</span>k x <span style="color: #4c83ff; font-weight: bold;">:as</span> r<span style="color: #add8e6;">]</span><span style="color: #00ff00;">]</span>
           <span style="color: #00ff00;">(</span>assoc m <span style="color: #add8e6;">(</span><span style="color: #D8FA3C;">frequency</span>/compute-diff x<span style="color: #add8e6;">)</span> r<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span> <span style="color: #586e75;">;; </span><span style="color: #8B8989; font-style: italic;">compute the frequency for </span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">each possible xor'd results into a sorted map (by its key)</span>
        <span style="color: #ffff00;">(</span>sorted-map<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
       first                                       <span style="color: #586e75;">;; </span><span style="color: #8B8989; font-style: italic;">first element is the small</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">est frequency difference</span>
       <span style="color: #ff1493;">(</span>#<span style="color: #ffff00;">(</span><span style="color: #FBDE2D; font-weight: bold;">let</span> <span style="color: #00ff00;">[</span><span style="color: #add8e6;">[</span>comp-diff <span style="color: #ffa500;">[</span>key secret<span style="color: #ffa500;">]</span><span style="color: #add8e6;">]</span> <span style="color: #D8FA3C;">%</span><span style="color: #00ff00;">]</span>         <span style="color: #586e75;">;; </span><span style="color: #8B8989; font-style: italic;">use destructuring to go an</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">d fetch what we want (I use let other her to explicit the result even if it's not needed)</span>
           <span style="color: #00ff00;">[</span><span style="color: #add8e6;">(</span><span style="color: #ffa500;">(</span>comp str char<span style="color: #ffa500;">)</span> key<span style="color: #add8e6;">)</span>
            <span style="color: #add8e6;">(</span><span style="color: #D8FA3C;">byte</span>/to-ascii secret<span style="color: #add8e6;">)</span><span style="color: #00ff00;">]</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>            <span style="color: #586e75;">;; </span><span style="color: #8B8989; font-style: italic;">key + decoded secret key i</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">n ascii</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>decrypt-brute-force <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">hex</span>/to-bytes <span style="color: #61CE3C;">"1b37373331363f78151b7f2b783431333d78397828</span><span style="color: #dc8cc3; background-color: #383838;">372d363c78373e783a393b3736"</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span>
  =&gt; <span style="color: #006400;">[</span><span style="color: #61CE3C;">"X"</span> <span style="color: #61CE3C;">"Cooking MC's like a pound of bacon"</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>
</pre>
</div>
<p>
<a href="https://github.com/ardumont/crypto/blob/master/src/crypto/xor.clj#L97">xor.clj</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-2-1-4" class="outline-5">
<h5 id="sec-2-2-1-4">xor</h5>
<div class="outline-text-5" id="text-2-2-1-4">
<p>
The xor operation:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">bitxor</span>
  <span style="color: #2aa198;">"Apply bit-xor to the seq using key as the key"</span>
  <span style="color: #006400;">[</span>seq key<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>map bit-xor seq key<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>bitxor <span style="color: #ff1493;">[</span>0 0 0 0 1 1 1 1<span style="color: #ff1493;">]</span> <span style="color: #ff1493;">[</span>0 0 0 0 1 1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>bitxor <span style="color: #ff1493;">[</span>0 0 0 0 1 1 1 1<span style="color: #ff1493;">]</span> <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>1 1 1 1 0 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>bitxor <span style="color: #ff1493;">[</span>0 0 0 0 1 1 1 1<span style="color: #ff1493;">]</span> <span style="color: #ff1493;">[</span>1 1 1 1 0 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>1 1 1 1 1 1 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>bitxor <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 1<span style="color: #ff1493;">]</span> <span style="color: #ff1493;">[</span>1 1 1 1 0 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 1 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>apply bitxor <span style="color: #ff1493;">[</span><span style="color: #ffff00;">[</span>0 0 0 0 1 1 1 1<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>1 1 1 1 1 1 1 1<span style="color: #ffff00;">]</span><span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>1 1 1 1 0 0 0 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn-</span> <span style="color: #ff1493;">xor-byte</span>
  <span style="color: #2aa198;">"Compute the xor between the input by (byte) and the key key (byte). No check </span><span style="color: #dc8cc3; background-color: #383838;">on key."</span>
  <span style="color: #006400;">[</span>by0 by1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ff1493;">[</span>by0 by1<span style="color: #ff1493;">]</span>
       <span style="color: #ff1493;">(</span>map <span style="color: #D8FA3C;">byte</span>/to-bits<span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>apply bitxor<span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>partition 8<span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>map <span style="color: #D8FA3C;">binary</span>/to-bytes<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact <span style="color: #4c83ff; font-weight: bold;">:one-way-and-back</span>
  <span style="color: #006400;">(</span>xor-byte <span style="color: #ff1493;">[</span>0 1 2 3 4 5<span style="color: #ff1493;">]</span> <span style="color: #ff1493;">[</span>0 1 2 3 4 5<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>xor-byte <span style="color: #ff1493;">[</span>0 0 0 0 0 0<span style="color: #ff1493;">]</span> <span style="color: #ff1493;">[</span>0 1 2 3 4 5<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 2 3 4 5<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">xor</span>
  <span style="color: #2aa198;">"Compute the xor between the input by (byte) and the key key (byte). The key i</span><span style="color: #dc8cc3; background-color: #383838;">s repeated if need be."</span>
  <span style="color: #006400;">[</span>by key<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> key
       cycle
       <span style="color: #ff1493;">(</span>take <span style="color: #ffff00;">(</span>count by<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>xor-byte by<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>xor <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">hex</span>/to-bytes <span style="color: #61CE3C;">"abcd"</span><span style="color: #ff1493;">)</span> <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">hex</span>/to-bytes <span style="color: #61CE3C;">"de"</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>                               <span style="color: #dc8cc3; background-color: #383838;">                                    =&gt; </span><span style="color: #006400; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">hex</span><span style="color: #dc8cc3; background-color: #383838;">/to-bytes </span><span style="color: #dc8cc3; background-color: #383838;">"7513"</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #006400;">(</span>xor <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">hex</span>/to-bytes <span style="color: #61CE3C;">"1c0111001f010100061a024b53535009181c"</span><span style="color: #ff1493;">)</span> <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">hex</span>/to-bytes <span style="color: #61CE3C;">"6869</span><span style="color: #dc8cc3; background-color: #383838;">74207468652062756c6c277320657965"</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> =&gt; </span><span style="color: #006400; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">hex</span><span style="color: #dc8cc3; background-color: #383838;">/to-bytes </span><span style="color: #dc8cc3; background-color: #383838;">"746865206b696420646f6e277420706c6179"</span><span style="color: #006400; background-color: #383838;">)</span>
  <span style="color: #006400;">(</span>xor <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">hex</span>/to-bytes <span style="color: #61CE3C;">"746865206b696420646f6e277420706c6179"</span><span style="color: #ff1493;">)</span> <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">hex</span>/to-bytes <span style="color: #61CE3C;">"6869</span><span style="color: #dc8cc3; background-color: #383838;">74207468652062756c6c277320657965"</span><span style="color: #ff1493; background-color: #383838;">)</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #dc8cc3; background-color: #383838;"> =&gt; </span><span style="color: #006400; background-color: #383838;">(</span><span style="color: #dc8cc3; background-color: #383838;">hex</span><span style="color: #dc8cc3; background-color: #383838;">/to-bytes </span><span style="color: #dc8cc3; background-color: #383838;">"1c0111001f010100061a024b53535009181c"</span><span style="color: #006400; background-color: #383838;">)</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
<p>
<a href="https://github.com/ardumont/crypto/blob/master/src/crypto/xor.clj#L35">xor.clj</a>
</p>
</div>
</div>

<div id="outline-container-sec-2-2-1-5" class="outline-5">
<h5 id="sec-2-2-1-5">frequency/compute-diff</h5>
<div class="outline-text-5" id="text-2-2-1-5">
<p>
The compute-diff function simply compute the frequency in the word w and compute the difference with the frequency map of the english language:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">def</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff; font-weight: bold;">:doc</span> <span style="color: #61CE3C;">"English letter frequency - http://www.math.cornell.edu/~mec/2003-20</span><span style="color: #dc8cc3; background-color: #383838;">04/cryptography/subs/frequencies.html"</span><span style="color: #006400; background-color: #383838;">}</span>
  <span style="color: #D8FA3C;">frequency</span>
  <span style="color: #006400;">(</span>into <span style="color: #ff1493;">{}</span> <span style="color: #ff1493;">[</span><span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\e</span> 12.02<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">E</span> 12.02<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\t</span> 9.10<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">T</span> 9.10<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\a</span> 8.12<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">A</span> 8.12<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\o</span> 7.<span style="color: #dc8cc3; background-color: #383838;">68</span><span style="color: #ffff00; background-color: #383838;">]</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffff00; background-color: #383838;">[</span><span style="color: #dc8cc3; background-color: #383838;">\</span><span style="color: #dc8cc3; background-color: #383838; font-weight: bold;">O</span><span style="color: #dc8cc3; background-color: #383838;"> 7.68</span><span style="color: #ffff00; background-color: #383838;">]</span>
            <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\i</span> 7.31<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">I</span> 7.31<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\n</span> 6.95<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">N</span> 6.95<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\s</span> 6.28<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">S</span> 6.28<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\r</span> 6.02<span style="color: #ffff00; background-color: #383838;">]</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffff00; background-color: #383838;">[</span><span style="color: #dc8cc3; background-color: #383838;">\</span><span style="color: #dc8cc3; background-color: #383838; font-weight: bold;">R</span><span style="color: #dc8cc3; background-color: #383838;"> 6.02</span><span style="color: #ffff00; background-color: #383838;">]</span>
            <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\h</span> 5.92<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">H</span> 5.92<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\d</span> 4.32<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">D</span> 4.32<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\l</span> 3.98<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">L</span> 3.98<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\u</span> 2.88<span style="color: #ffff00; background-color: #383838;">]</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffff00; background-color: #383838;">[</span><span style="color: #dc8cc3; background-color: #383838;">\</span><span style="color: #dc8cc3; background-color: #383838; font-weight: bold;">U</span><span style="color: #dc8cc3; background-color: #383838;"> 2.88</span><span style="color: #ffff00; background-color: #383838;">]</span>
            <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\c</span> 2.71<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">C</span> 2.71<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\m</span> 2.61<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">M</span> 2.61<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\f</span> 2.30<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">F</span> 2.30<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\y</span> 2.11<span style="color: #ffff00; background-color: #383838;">]</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffff00; background-color: #383838;">[</span><span style="color: #dc8cc3; background-color: #383838;">\</span><span style="color: #dc8cc3; background-color: #383838; font-weight: bold;">Y</span><span style="color: #dc8cc3; background-color: #383838;"> 2.11</span><span style="color: #ffff00; background-color: #383838;">]</span>
            <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\w</span> 2.09<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">W</span> 2.09<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\g</span> 2.03<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">G</span> 2.03<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\p</span> 1.82<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">P</span> 1.82<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\b</span> 1.49<span style="color: #ffff00; background-color: #383838;">]</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffff00; background-color: #383838;">[</span><span style="color: #dc8cc3; background-color: #383838;">\</span><span style="color: #dc8cc3; background-color: #383838; font-weight: bold;">B</span><span style="color: #dc8cc3; background-color: #383838;"> 1.49</span><span style="color: #ffff00; background-color: #383838;">]</span>
            <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\v</span> 1.11<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">V</span> 1.11<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\k</span> 0.69<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">K</span> 0.69<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\x</span> 0.17<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">X</span> 0.17<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\q</span> 0.11<span style="color: #ffff00; background-color: #383838;">]</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #ffff00; background-color: #383838;">[</span><span style="color: #dc8cc3; background-color: #383838;">\</span><span style="color: #dc8cc3; background-color: #383838; font-weight: bold;">Q</span><span style="color: #dc8cc3; background-color: #383838;"> 0.11</span><span style="color: #ffff00; background-color: #383838;">]</span>
            <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\j</span> 0.10<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">J</span> 0.10<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\z</span> 0.07<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">[</span>\<span style="color: #4c83ff; font-weight: bold;">Z</span> 0.07<span style="color: #ffff00;">]</span>
            <span style="color: #ffff00;">[</span><span style="color: #61CE3C;">\space</span> 12.03<span style="color: #ffff00;">]</span> <span style="color: #586e75;">;; </span><span style="color: #8B8989; font-style: italic;">space is slightly more frequent than \e</span>
            <span style="color: #ff1493;">]</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">crypto.util</span>/rng-char <span style="color: #61CE3C;">\a</span> <span style="color: #61CE3C;">\z</span><span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>map frequency<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  =&gt; <span style="color: #006400;">[</span>8.12 1.49 2.71 4.32 12.02 2.30 2.03 5.92 7.31 0.10 0.69 3.98 2.61 6.95 7.6<span style="color: #dc8cc3; background-color: #383838;">8 1.82 0.11 6.02 6.28 9.10 2.88 1.11 2.09 0.17 2.11 0.07</span><span style="color: #006400; background-color: #383838;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">crypto.util</span>/rng-char \<span style="color: #4c83ff; font-weight: bold;">A</span> \<span style="color: #4c83ff; font-weight: bold;">Z</span><span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>map frequency<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  =&gt; <span style="color: #006400;">[</span>8.12 1.49 2.71 4.32 12.02 2.30 2.03 5.92 7.31 0.10 0.69 3.98 2.61 6.95 7.6<span style="color: #dc8cc3; background-color: #383838;">8 1.82 0.11 6.02 6.28 9.10 2.88 1.11 2.09 0.17 2.11 0.07</span><span style="color: #006400; background-color: #383838;">]</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">def</span> <span style="color: #D8FA3C;">byte-freq</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff; font-weight: bold;">:doc</span> <span style="color: #61CE3C;">"frequency of english, key are encoded in bytes."</span><span style="color: #006400;">}</span>
  <span style="color: #006400;">(</span>reduce <span style="color: #ff1493;">(</span><span style="color: #FBDE2D; font-weight: bold;">fn</span> <span style="color: #ffff00;">[</span>m <span style="color: #00ff00;">[</span>k v<span style="color: #00ff00;">]</span><span style="color: #ffff00;">]</span> <span style="color: #ffff00;">(</span>assoc m <span style="color: #00ff00;">(</span>int k<span style="color: #00ff00;">)</span> v<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span> <span style="color: #ff1493;">{}</span> frequency<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">crypto.util</span>/rng <span style="color: #61CE3C;">\a</span> <span style="color: #61CE3C;">\z</span><span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>map <span style="color: #ffff00;">(</span>comp byte-freq int<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  =&gt; <span style="color: #006400;">[</span>8.12 1.49 2.71 4.32 12.02 2.30 2.03 5.92 7.31 0.10 0.69 3.98 2.61 6.95 7.6<span style="color: #dc8cc3; background-color: #383838;">8 1.82 0.11 6.02 6.28 9.10 2.88 1.11 2.09 0.17 2.11 0.07</span><span style="color: #006400; background-color: #383838;">]</span>
    <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">crypto.util</span>/rng \<span style="color: #4c83ff; font-weight: bold;">A</span> \<span style="color: #4c83ff; font-weight: bold;">Z</span><span style="color: #ff1493;">)</span>
         <span style="color: #ff1493;">(</span>map <span style="color: #ffff00;">(</span>comp byte-freq int<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span>
  =&gt; <span style="color: #006400;">[</span>8.12 1.49 2.71 4.32 12.02 2.30 2.03 5.92 7.31 0.10 0.69 3.98 2.61 6.95 7.6<span style="color: #dc8cc3; background-color: #383838;">8 1.82 0.11 6.02 6.28 9.10 2.88 1.11 2.09 0.17 2.11 0.07</span><span style="color: #006400; background-color: #383838;">]</span><span style="color: #8b0000; background-color: #383838;">)</span>

...

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">compute-diff</span>
  <span style="color: #2aa198;">"Given a hexadecimal encoded word, compute the difference frequency from the s</span><span style="color: #dc8cc3; background-color: #383838;">tandard english frequency map."</span>
  <span style="color: #006400;">[</span>w<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> w
       compute-freq
       <span style="color: #ff1493;">(</span>diff-freq byte-freq<span style="color: #ff1493;">)</span>
       sum-diff-map<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>compute-diff <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">crypto.ascii</span>/to-bytes <span style="color: #61CE3C;">"hello"</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span> =&gt; 211.0099999850989<span style="color: #8b0000;">)</span>
</pre>
</div>
<p>
<a href="https://github.com/ardumont/crypto/blob/master/src/crypto/frequency.clj#L10">frequency.clj</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-2-2" class="outline-4">
<h4 id="sec-2-2-2">Decipher</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
Now that we have the key, we can decipher the message:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">def</span> <span style="color: #D8FA3C;">ascii-decrypted</span> <span style="color: #006400;">(</span><span style="color: #D8FA3C;">xor</span>/decrypt <span style="color: #ff1493;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> key-cipher
                                   <span style="color: #4c83ff; font-weight: bold;">:msg</span> ascii-encrypted<span style="color: #ff1493;">}</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>
</pre>
</div>
<p>
The <code>xor/decrypt</code> and <code>xor/encrypt</code> functions:
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">encrypt-bytes</span>
  <span style="color: #2aa198;">"Given a map {:key 'ascii key' :msg 'ascii message'}, encrypt the msg with the</span><span style="color: #dc8cc3; background-color: #383838;"> hex key and return a byte sequence."</span>
  <span style="color: #006400;">[</span><span style="color: #ff1493;">{</span><span style="color: #4c83ff; font-weight: bold;">:keys</span> <span style="color: #ffff00;">[</span>key msg<span style="color: #ffff00;">]</span><span style="color: #ff1493;">}</span><span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> <span style="color: #ff1493;">[</span>msg key<span style="color: #ff1493;">]</span>
       <span style="color: #ff1493;">(</span>map <span style="color: #D8FA3C;">ascii</span>/to-bytes<span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>apply xor<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>encrypt-bytes <span style="color: #ff1493;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"X"</span>
                  <span style="color: #4c83ff; font-weight: bold;">:msg</span> <span style="color: #61CE3C;">"Cooking MC's like a pound of bacon"</span><span style="color: #ff1493;">}</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>27 55 55 51 49<span style="color: #dc8cc3; background-color: #383838;"> 54 63 120 21 27 127 43 120 52 49 51 61 120 57 120 40 55 45 54 60 120 55 62 120 58 57 59 55 54</span><span style="color: #006400; background-color: #383838;">]</span><span style="color: #dc8cc3; background-color: #383838;"> </span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">encrypt</span>
  <span style="color: #2aa198;">"Given a map {:key 'ascii key' :msg 'ascii message'}, encode the message with </span><span style="color: #dc8cc3; background-color: #383838;">the key key and return the byte encoded result."</span>
  <span style="color: #006400;">[</span>m<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>encrypt-bytes m<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span><span style="color: #D8FA3C;">byte</span>/to-hex
   <span style="color: #ff1493;">(</span>encrypt <span style="color: #ffff00;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"X"</span>
             <span style="color: #4c83ff; font-weight: bold;">:msg</span> <span style="color: #61CE3C;">"Cooking MC's like a pound of bacon"</span><span style="color: #ffff00;">}</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span> =&gt; <span style="color: #61CE3C;">"1b37373331363f7815</span><span style="color: #dc8cc3; background-color: #383838;">1b7f2b783431333d78397828372d363c78373e783a393b3736"</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D; font-weight: bold;">defn</span> <span style="color: #ff1493;">decrypt</span>
  <span style="color: #2aa198;">"Given a map {:key 'ascii key' :msg 'hex encoded message'}, decode the encrypt</span><span style="color: #dc8cc3; background-color: #383838;">ed message into ascii."</span>
  <span style="color: #006400;">[</span>m<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;</span> m
      decrypt-bytes
      <span style="color: #D8FA3C;">byte</span>/to-ascii<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>decrypt <span style="color: #ff1493;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"X"</span>
            <span style="color: #4c83ff; font-weight: bold;">:msg</span> <span style="color: #ffff00;">(</span>encrypt <span style="color: #00ff00;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"X"</span>
                           <span style="color: #4c83ff; font-weight: bold;">:msg</span> <span style="color: #61CE3C;">"Cooking MC's like a pound of bacon"</span><span style="color: #00ff00;">}</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">}</span><span style="color: #006400;">)</span>
  =&gt; <span style="color: #61CE3C;">"Cooking MC's like a pound of bacon"</span>
  <span style="color: #006400;">(</span>decrypt <span style="color: #ff1493;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"a"</span>
            <span style="color: #4c83ff; font-weight: bold;">:msg</span> <span style="color: #ffff00;">(</span>encrypt <span style="color: #00ff00;">{</span><span style="color: #4c83ff; font-weight: bold;">:key</span> <span style="color: #61CE3C;">"a"</span>
                           <span style="color: #4c83ff; font-weight: bold;">:msg</span> <span style="color: #61CE3C;">"There are some trouble in paradise, the sentenc</span><span style="color: #dc8cc3; background-color: #383838;">e needs to be very long for it to be decrypted"</span><span style="color: #00ff00; background-color: #383838;">}</span><span style="color: #ffff00; background-color: #383838;">)</span><span style="color: #ff1493; background-color: #383838;">}</span><span style="color: #006400; background-color: #383838;">)</span>
  =&gt; <span style="color: #61CE3C;">"There are some trouble in paradise, the sentence needs to be very long for</span><span style="color: #dc8cc3; background-color: #383838;"> it to be decrypted"</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
<p>
<a href="https://github.com/ardumont/crypto/blob/master/src/crypto/xor.clj#L80">xor.clj</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Finale</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The original problem was to compute the sum of the bytes decrypted.
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span><span style="color: #FBDE2D; font-weight: bold;">-&gt;&gt;</span> ascii-decrypted
       <span style="color: #D8FA3C;">crypto.ascii</span>/to-bytes
       <span style="color: #ff1493;">(</span>apply +<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span> =&gt; 107359<span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Conclusion</h2>
<div class="outline-text-2" id="text-3">
<p>
Yet again a clojure victory!
</p>
</div>
</div>
