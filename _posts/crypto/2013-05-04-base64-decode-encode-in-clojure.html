---
layout: post
title: Decode/Encode base64 in Clojure
date: 2013-05-04
categories:
- clojure
- base64
- encode
- decode
- functional-programming
author:
excerpt: Learning how to encode and decode string in base64 for fun!
---
<p>
I just wanted to try and learn the algorithm to encode a string in base64 and the other way around.
</p>

<p>
I used mainly wikipedia's <a href="https://en.wikipedia.org/wiki/Base64">english</a> and <a href="https://fr.wikipedia.org/wiki/Base64">french</a> version as source.
</p>

<p>
I hope you will enjoy this as much as I did.
</p>

<p>
Here are the sources and explanations.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Structure</h2>
<div class="outline-text-2" id="text-1">
<p>
I use 3 different namespaces.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">namespace</th>
<th scope="col" class="left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">base64</td>
<td class="left">main namespace for the encode and decode function</td>
</tr>

<tr>
<td class="left">dico</td>
<td class="left">the dictionary namespace holding the dictionary to encode and decode the characters</td>
</tr>

<tr>
<td class="left">binary</td>
<td class="left">number to bits and back manipulations</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Code</h2>
<div class="outline-text-2" id="text-2">
<p>
We'll go from the simpler to the hardest.
</p>

<p>
You'll find first the definition of the function and then the <b>fact(s)</b> (test from <a href="https://github.com/marick/midje">Midje</a> library) which are tests but also documentation about the use cases of the function.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Dico</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Just holding 2 hashmaps, <b>base64</b> to encode an ascii number into a char and <b>base64-dec</b> (which is the same map with keys and values transposed) to decode a char into a number.
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">ns</span> <span style="color: #D8FA3C;">crypto.dico</span>
  <span style="color: #61CE3C;">"A dictionary namespace"</span>
  <span style="color: #006400;">(</span><span style="color: #4c83ff;">:require</span> <span style="color: #ff1493;">[</span><span style="color: #D8FA3C;">midje.sweet</span> <span style="color: #4c83ff;">:as</span> m<span style="color: #ff1493;">]</span>
            <span style="color: #ff1493;">[</span><span style="color: #D8FA3C;">clojure.set</span> <span style="color: #4c83ff;">:as</span> set<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"base64 dictionary to encode in base64"</span><span style="color: #006400;">}</span>
  <span style="color: #D8FA3C;">base64</span> <span style="color: #006400;">{</span>0  \<span style="color: #4c83ff;">A</span>
          16 \<span style="color: #4c83ff;">Q</span>
          32 <span style="color: #61CE3C;">\g</span>
          48 <span style="color: #61CE3C;">\w</span>
          1  \<span style="color: #4c83ff;">B</span>
          17 \<span style="color: #4c83ff;">R</span>
          33 <span style="color: #61CE3C;">\h</span>
          49 <span style="color: #61CE3C;">\x</span>
          2  \<span style="color: #4c83ff;">C</span>
          18 \<span style="color: #4c83ff;">S</span>
          34 <span style="color: #61CE3C;">\i</span>
          50 <span style="color: #61CE3C;">\y</span>
          3  \<span style="color: #4c83ff;">D</span>
          19 \<span style="color: #4c83ff;">T</span>
          35 <span style="color: #61CE3C;">\j</span>
          51 <span style="color: #61CE3C;">\z</span>
          4  \<span style="color: #4c83ff;">E</span>
          20 \<span style="color: #4c83ff;">U</span>
          36 <span style="color: #61CE3C;">\k</span>
          52 <span style="color: #61CE3C;">\0</span>
          5  \<span style="color: #4c83ff;">F</span>
          21 \<span style="color: #4c83ff;">V</span>
          37 <span style="color: #61CE3C;">\l</span>
          53 <span style="color: #61CE3C;">\1</span>
          6  \<span style="color: #4c83ff;">G</span>
          22 \<span style="color: #4c83ff;">W</span>
          38 <span style="color: #61CE3C;">\m</span>
          54 <span style="color: #61CE3C;">\2</span>
          7  \<span style="color: #4c83ff;">H</span>
          23 \<span style="color: #4c83ff;">X</span>
          39 <span style="color: #61CE3C;">\n</span>
          55 <span style="color: #61CE3C;">\3</span>
          8  \<span style="color: #4c83ff;">I</span>
          24 \<span style="color: #4c83ff;">Y</span>
          40 <span style="color: #61CE3C;">\o</span>
          56 <span style="color: #61CE3C;">\4</span>
          9  \<span style="color: #4c83ff;">J</span>
          25 \<span style="color: #4c83ff;">Z</span>
          41 <span style="color: #61CE3C;">\p</span>
          57 <span style="color: #61CE3C;">\5</span>
          10 \<span style="color: #4c83ff;">K</span>
          26 <span style="color: #61CE3C;">\a</span>
          42 <span style="color: #61CE3C;">\q</span>
          58 <span style="color: #61CE3C;">\6</span>
          11 \<span style="color: #4c83ff;">L</span>
          27 <span style="color: #61CE3C;">\b</span>
          43 <span style="color: #61CE3C;">\r</span>
          59 <span style="color: #61CE3C;">\7</span>
          12 \<span style="color: #4c83ff;">M</span>
          28 <span style="color: #61CE3C;">\c</span>
          44 <span style="color: #61CE3C;">\s</span>
          60 <span style="color: #61CE3C;">\8</span>
          13 \<span style="color: #4c83ff;">N</span>
          29 <span style="color: #61CE3C;">\d</span>
          45 <span style="color: #61CE3C;">\t</span>
          61 <span style="color: #61CE3C;">\9</span>
          14 \<span style="color: #4c83ff;">O</span>
          30 <span style="color: #61CE3C;">\e</span>
          46 <span style="color: #61CE3C;">\u</span>
          62 <span style="color: #61CE3C;">\+</span>
          15 \<span style="color: #4c83ff;">P</span>
          31 <span style="color: #61CE3C;">\f</span>
          47 <span style="color: #61CE3C;">\v</span>
          63 <span style="color: #61CE3C;">\/</span><span style="color: #006400;">}</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"base64 dictionary to decode in base64"</span><span style="color: #006400;">}</span>
  <span style="color: #D8FA3C;">base64-dec</span> <span style="color: #006400;">(</span><span style="color: #D8FA3C;">set</span>/map-invert base64<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span><span style="color: #D8FA3C;">set</span>/map-invert base64<span style="color: #006400;">)</span>     =&gt; base64-dec
  <span style="color: #006400;">(</span><span style="color: #D8FA3C;">set</span>/map-invert base64-dec<span style="color: #006400;">)</span> =&gt; base64<span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Binary</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The binary namespace to help in transforming back and forth characters into sequence of bits.
</p>

<p>
I chose to represent the bits as big endian, so the bits sequence are read from the left to the right (big endian).
</p>

<p>
<span class="underline">Examples:</span>
[0 0 0 0 0 1 1 1] reads 7
[1 0 0 0 0 0 0 0] reads 128
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">ns</span> <span style="color: #D8FA3C;">crypto.binary</span>
  <span style="color: #61CE3C;">"A binary namespace to deal with transformation into binary"</span>
  <span style="color: #006400;">(</span><span style="color: #4c83ff;">:use</span> <span style="color: #ff1493;">[</span><span style="color: #D8FA3C;">midje.sweet</span> <span style="color: #4c83ff;">:only</span> <span style="color: #ffff00;">[</span>fact future-fact<span style="color: #ffff00;">]</span><span style="color: #ff1493;">]</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn-</span> <span style="color: #ff1493;">comp-bits-sequence</span>
  <span style="color: #61CE3C;">"Complement a bits sequence by providing the policy through the complement-fn </span><span style="color: #dc8cc3; background-color: #383838;">function."</span>
  <span style="color: #006400;">[</span>n b complement-fn<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">[</span>c <span style="color: #ffff00;">(</span><span style="color: #D8FA3C;">Math</span>/abs <span style="color: #00ff00;">(</span>- n <span style="color: #add8e6;">(</span>count b<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">]</span>
    <span style="color: #ff1493;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ffff00;">(</span>= 0 c<span style="color: #ffff00;">)</span>
      b
      <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">-&gt;&gt;</span> <span style="color: #00ff00;">(</span>repeat c 0<span style="color: #00ff00;">)</span>
           <span style="color: #00ff00;">(</span>complement-fn b<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #D8FA3C;">m</span>/fact
  <span style="color: #006400;">(</span>comp-bits-sequence 8  <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span>           #<span style="color: #ff1493;">(</span>concat <span style="color: #D8FA3C;">%2</span> <span style="color: #D8FA3C;">%</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 1 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence 8  <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span> #<span style="color: #ff1493;">(</span>concat <span style="color: #D8FA3C;">%2</span> <span style="color: #D8FA3C;">%</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence 4  <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span>           #<span style="color: #ff1493;">(</span>concat <span style="color: #D8FA3C;">%2</span> <span style="color: #D8FA3C;">%</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence 10 <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span> #<span style="color: #ff1493;">(</span>concat <span style="color: #D8FA3C;">%2</span> <span style="color: #D8FA3C;">%</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 0 1 0 0<span style="color: #dc8cc3; background-color: #383838;"> 0</span><span style="color: #006400; background-color: #383838;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence 8  <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span>           concat<span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>1 1 1 0 0 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence 8  <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span> concat<span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence 4  <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span>           concat<span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>1 1 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence 10 <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span> concat<span style="color: #006400;">)</span>         =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 0 0 0 0<span style="color: #dc8cc3; background-color: #383838;"> 0</span><span style="color: #006400; background-color: #383838;">]</span><span style="color: #8b0000; background-color: #383838;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn</span> <span style="color: #ff1493;">comp-before</span>
  <span style="color: #61CE3C;">"Complement by the most significant side (head) a bits sequence to n bits (if </span><span style="color: #dc8cc3; background-color: #383838;">necessary)."</span>
  <span style="color: #006400;">[</span>n b<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bits-sequence n b <span style="color: #ff1493;">(</span>partial cons 0<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>comp-before 8 <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>            =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 1 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-before 8 <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-before 4 <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>            =&gt; <span style="color: #006400;">[</span>0 1 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-before 10 <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 0 1 0 0 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn</span> <span style="color: #ff1493;">comp-after</span>
  <span style="color: #61CE3C;">"Complement by the least significant side (tail) a bit sequence to n bits (if </span><span style="color: #dc8cc3; background-color: #383838;">necessary)."</span>
  <span style="color: #006400;">[</span>n b<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-bit-sequence n b #<span style="color: #ff1493;">(</span>concat <span style="color: #D8FA3C;">%</span> <span style="color: #ffff00;">[</span>0<span style="color: #ffff00;">]</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>comp-after 10 <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>1 1 1 1 1 1 1 1 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-after 8 <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>            =&gt; <span style="color: #006400;">[</span>1 1 1 0 0 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-after 8 <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 0 0 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-after 4 <span style="color: #ff1493;">[</span>1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>            =&gt; <span style="color: #006400;">[</span>1 1 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp-after 10 <span style="color: #ff1493;">[</span>0 0 0 0 1 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 0 0 0 0 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn-</span> <span style="color: #ff1493;">bin</span>
  <span style="color: #61CE3C;">"Convert a byte into binary sequence (will create as much bits as needed)."</span>
  <span style="color: #006400;">[</span>b<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #ff1493;">(</span>= 0 b<span style="color: #ff1493;">)</span>
    <span style="color: #ff1493;">[]</span>
    <span style="color: #ff1493;">(</span>conj <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">-&gt;</span> b <span style="color: #00ff00;">(</span>/ 2<span style="color: #00ff00;">)</span> int bin<span style="color: #ffff00;">)</span> <span style="color: #ffff00;">(</span>mod b 2<span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>bin 97<span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>1 1 0 0 0 0 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>bin 2<span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>1 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn-</span> <span style="color: #ff1493;">to-binary</span>
  <span style="color: #61CE3C;">"Given a number, compute a function permitting the translation into a n-bits s</span><span style="color: #dc8cc3; background-color: #383838;">equence"</span>
  <span style="color: #006400;">[</span>n<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>comp <span style="color: #ff1493;">(</span>partial comp-before n<span style="color: #ff1493;">)</span> bin<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span><span style="color: #ff1493;">(</span>to-binary 8<span style="color: #ff1493;">)</span> 97<span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 0 0 0 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #ff1493;">(</span>to-binary 8<span style="color: #ff1493;">)</span> 2<span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 0 1 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> <span style="color: #D8FA3C;">to-8bits</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"Given a number, compute its 8-bits representation."</span><span style="color: #006400;">}</span>
  <span style="color: #006400;">(</span>to-binary 8<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>to-8bits 97<span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 0 0 0 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>to-8bits 2<span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 0 1 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> <span style="color: #D8FA3C;">to-6bits</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"Given a number, compute its 6-bits representation."</span><span style="color: #006400;">}</span>
  <span style="color: #006400;">(</span>to-binary 6<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>to-6bits 26<span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>to-6bits 1<span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 0 0 0 0 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>to-6bits 2<span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>to-6bits 3<span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 0 0 0 1 1<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn</span> <span style="color: #ff1493;">to-num</span>
  <span style="color: #61CE3C;">"Convert a bit sequence into a number"</span>
  <span style="color: #006400;">[</span>b<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">-&gt;&gt;</span> <span style="color: #ff1493;">(</span>reverse b<span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>map-indexed <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">fn</span> <span style="color: #00ff00;">[</span>i v<span style="color: #00ff00;">]</span> <span style="color: #00ff00;">[</span><span style="color: #add8e6;">(</span><span style="color: #D8FA3C;">Math</span>/pow 2 i<span style="color: #add8e6;">)</span> v<span style="color: #00ff00;">]</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>reduce <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">fn</span> <span style="color: #00ff00;">[</span>a <span style="color: #add8e6;">[</span>e n<span style="color: #add8e6;">]</span><span style="color: #00ff00;">]</span> <span style="color: #00ff00;">(</span><span style="color: #FBDE2D;">if</span> <span style="color: #add8e6;">(</span>= n 1<span style="color: #add8e6;">)</span> <span style="color: #add8e6;">(</span>+ e a<span style="color: #add8e6;">)</span> a<span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span> 0<span style="color: #ff1493;">)</span>
       int<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>to-num <span style="color: #ff1493;">[</span>1 1 0 0 0 0 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>   =&gt; 97
  <span style="color: #006400;">(</span>to-num <span style="color: #ff1493;">[</span>0 1 1 0 0 0 0 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; 97
  <span style="color: #006400;">(</span>to-num <span style="color: #ff1493;">[</span>0 0 0 0 0 0 1 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; 2
  <span style="color: #006400;">(</span>to-num <span style="color: #ff1493;">[</span>0 0 0 0 0 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; 0
  <span style="color: #006400;">(</span>to-num <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; 255
  <span style="color: #006400;">(</span>to-num <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; 254<span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Base64</h3>
<div class="outline-text-3" id="text-2-3">
<p>
At last, the main namespace holding the functions:
</p>
<ul class="org-ul">
<li>encode which takes a string and returns a base64 string
</li>
<li>decode which takes a base64 string and returns an ascii string.
</li>
</ul>
</div>
<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1">Encode</h4>
<div class="outline-text-4" id="text-2-3-1">
</div><div id="outline-container-sec-2-3-1-1" class="outline-5">
<h5 id="sec-2-3-1-1">Utilities</h5>
<div class="outline-text-5" id="text-2-3-1-1">
<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">ns</span> <span style="color: #D8FA3C;">crypto.base64</span>
  <span style="color: #61CE3C;">"encode and decode a string in base64"</span>
  <span style="color: #006400;">(</span><span style="color: #4c83ff;">:use</span> <span style="color: #ff1493;">[</span><span style="color: #D8FA3C;">midje.sweet</span> <span style="color: #4c83ff;">:only</span> <span style="color: #ffff00;">[</span>fact<span style="color: #ffff00;">]</span><span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>
  <span style="color: #006400;">(</span><span style="color: #4c83ff;">:require</span> <span style="color: #ff1493;">[</span><span style="color: #D8FA3C;">crypto-challenge.dico</span>   <span style="color: #4c83ff;">:as</span> d<span style="color: #ff1493;">]</span>
            <span style="color: #ff1493;">[</span><span style="color: #D8FA3C;">crypto-challenge.binary</span> <span style="color: #4c83ff;">:as</span> b<span style="color: #ff1493;">]</span>
            <span style="color: #ff1493;">[</span><span style="color: #D8FA3C;">clojure.string</span>          <span style="color: #4c83ff;">:as</span> s<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8B8989; font-style: italic;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; </span><span style="color: #8B8989; font-style: italic;">encoding</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Given a partition of 24 bits, compute the complement [partition of multiple 6</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;"> bits, list of complement = char]</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defmulti</span> <span style="color: #ff1493;">comp24</span> count<span style="color: #8b0000;">)</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">complement 4 bits to be able to have 2 bytes (12 bits) and we complements wit</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">h 2 = chars</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defmethod</span> <span style="color: #ff1493;">comp24</span> 8 <span style="color: #006400;">[</span>b<span style="color: #006400;">]</span> <span style="color: #006400;">[</span><span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">b</span>/comp-after 12 b<span style="color: #ff1493;">)</span>
                         <span style="color: #ff1493;">[</span><span style="color: #61CE3C;">\=</span> <span style="color: #61CE3C;">\=</span><span style="color: #ff1493;">]</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>comp24 <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span><span style="color: #ff1493;">[</span>1 1 1 1 1 1,
                                  1 1 0 0 0 0<span style="color: #ff1493;">]</span>
                                 <span style="color: #ff1493;">[</span><span style="color: #61CE3C;">\=</span> <span style="color: #61CE3C;">\=</span><span style="color: #ff1493;">]</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">complement 2 bits to be able to have 3 bytes (18 bits) and we complements wit</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">h 1 = char</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defmethod</span> <span style="color: #ff1493;">comp24</span> 16 <span style="color: #006400;">[</span>b<span style="color: #006400;">]</span> <span style="color: #006400;">[</span><span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">b</span>/comp-after 18 b<span style="color: #ff1493;">)</span>
                          <span style="color: #ff1493;">[</span><span style="color: #61CE3C;">\=</span><span style="color: #ff1493;">]</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>comp24 <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 1, 0 0 0 0 0 0 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span><span style="color: #ff1493;">[</span>1 1 1 1 1 1,
                                                   1 1 0 0 0 0,
                                                   0 0 1 1 0 0<span style="color: #ff1493;">]</span>
                                                  <span style="color: #ff1493;">[</span><span style="color: #61CE3C;">\=</span><span style="color: #ff1493;">]</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">chunk of 24 remains the same without any complement</span>
<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defmethod</span> <span style="color: #ff1493;">comp24</span> <span style="color: #4c83ff;">:default</span> <span style="color: #006400;">[</span>b<span style="color: #006400;">]</span> <span style="color: #006400;">[</span>b <span style="color: #ff1493;">[]</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>comp24 <span style="color: #ff1493;">[</span>1 1 1 1 1 1 1 1, 0 0 0 0 0 0 1 1, 1 1 1 1 1 1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span><span style="color: #ff1493;">[</span>1 1 1 1 1 1,
                                                                    1 1 0 0 0 0,
                                                                    0 0 1 1 1 1,
                                                                    1 1 1 1 1 1<span style="color: #ff1493;">]</span>
                                                                   <span style="color: #ff1493;">[]</span><span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> <span style="color: #D8FA3C;">char2bits</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"Convert a char into a 8-bits sequence"</span><span style="color: #006400;">}</span>
  <span style="color: #006400;">(</span>comp <span style="color: #D8FA3C;">b</span>/to-8bits int<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>char2bits <span style="color: #61CE3C;">\a</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 0 0 0 1<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> <span style="color: #D8FA3C;">bits2char</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"Convert a 8-bits sequence into a char"</span><span style="color: #006400;">}</span>
  <span style="color: #006400;">(</span>comp char <span style="color: #D8FA3C;">b</span>/to-num<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>bits2char <span style="color: #ff1493;">[</span>0 1 1 0 0 0 0 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #61CE3C;">\a</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> <span style="color: #D8FA3C;">to-bits</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:private</span> <span style="color: #4c83ff;">true</span>
               <span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"Transform a string into a list of bits."</span><span style="color: #006400;">}</span>
  <span style="color: #006400;">(</span>partial mapcat char2bits<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>to-bits <span style="color: #ff1493;">[</span><span style="color: #61CE3C;">\a</span> <span style="color: #61CE3C;">\b</span> <span style="color: #61CE3C;">\c</span><span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 0 0 0 1,
                           0 1 1 0 0 0 1 0,
                           0 1 1 0 0 0 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>to-bits <span style="color: #61CE3C;">"haskell"</span><span style="color: #006400;">)</span>  =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0 0 0,
                           0 1 1 0 0 0 0 1,
                           0 1 1 1 0 0 1 1,
                           0 1 1 0 1 0 1 1,
                           0 1 1 0 0 1 0 1,
                           0 1 1 0 1 1 0 0,
                           0 1 1 0 1 1 0 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn</span> <span style="color: #ff1493;">to-base64</span>
  <span style="color: #61CE3C;">"Given a 8 or 16 or 24-bits chunk, compute the bits sequence into base64."</span>
  <span style="color: #006400;">[</span>b<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">let</span> <span style="color: #ff1493;">[</span><span style="color: #ffff00;">[</span>part complement<span style="color: #ffff00;">]</span> <span style="color: #ffff00;">(</span>comp24 b<span style="color: #ffff00;">)</span>
        p24               <span style="color: #ffff00;">(</span><span style="color: #FBDE2D;">-&gt;&gt;</span> part
                               <span style="color: #00ff00;">(</span>partition 6<span style="color: #00ff00;">)</span>
                               <span style="color: #00ff00;">(</span>map <span style="color: #add8e6;">(</span>comp <span style="color: #D8FA3C;">d</span>/base64 <span style="color: #D8FA3C;">b</span>/to-num<span style="color: #add8e6;">)</span><span style="color: #00ff00;">)</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">]</span>
    <span style="color: #ff1493;">(</span>concat p24 complement<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>to-base64 <span style="color: #ff1493;">[</span>1 1 1 1 1 1, 1 1 0 0 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>                           =&gt; <span style="color: #006400;">[</span><span style="color: #61CE3C;">\/</span> <span style="color: #61CE3C;">\w</span><span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>to-base64 <span style="color: #ff1493;">[</span>1 1 1 1 1 1, 1 1 0 0 0 0, 0 0 1 1 0 0<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span>              =&gt; <span style="color: #006400;">[</span><span style="color: #61CE3C;">\/</span> <span style="color: #61CE3C;">\w</span> \<span style="color: #4c83ff;">M</span><span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>to-base64 <span style="color: #ff1493;">[</span>1 1 1 1 1 1, 1 1 0 0 0 0, 0 0 1 1 1 1, 1 1 1 1 1 1<span style="color: #ff1493;">]</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span><span style="color: #61CE3C;">\/</span> <span style="color: #61CE3C;">\w</span> \<span style="color: #4c83ff;">P</span> <span style="color: #dc8cc3; background-color: #383838;">\/</span><span style="color: #006400; background-color: #383838;">]</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-3-1-2" class="outline-5">
<h5 id="sec-2-3-1-2">Algorithm</h5>
<div class="outline-text-5" id="text-2-3-1-2">
<ul class="org-ul">
<li>Transform the string into 8-bits binary sequence
</li>
<li>Partition into chunks of 24 bits
</li>
<li>Encode each 6 bits into base64 (so 3 chars in ascii give 4 chars in base64)
</li>
</ul>
<p>
Beware, there is a subtlety regarding the last chunk which can have 8, 16 (in those case, there is the complement =) or 24 bits.
</p>
<ul class="org-ul">
<li>Join the string and you have the result
</li>
</ul>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn</span> <span style="color: #ff1493;">encode</span>
  <span style="color: #61CE3C;">"Encode into base64"</span>
  <span style="color: #006400;">[</span>s<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">-&gt;&gt;</span> s
       to-bits            <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">Transform all chars into 8-bits sequence</span>
       <span style="color: #ff1493;">(</span>partition-all 24<span style="color: #ff1493;">)</span> <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">24-bits chunks</span>
       <span style="color: #ff1493;">(</span>mapcat to-base64<span style="color: #ff1493;">)</span> <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">deal with the last chunk of bits (which can be of s</span><span style="color: #dc8cc3; background-color: #383838; font-style: italic;">ize 8, 16 or 24)</span>
       <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">s</span>/join <span style="color: #61CE3C;">""</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>encode <span style="color: #61CE3C;">"Man is distinguished, not only by his reason, but by this singular pa</span><span style="color: #dc8cc3; background-color: #383838;">ssion from other animals, which is a lust of the mind, that by a perseverance of delight in the continued and indefatigable generation of knowledge, exceeds the short vehemence of any carnal pleasure."</span><span style="color: #006400; background-color: #383838;">)</span>
  =&gt; <span style="color: #61CE3C;">"TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBieSB0aG</span><span style="color: #dc8cc3; background-color: #383838;">lzIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLCB3aGljaCBpcyBhIGx1c3Qgb2YgdGhlIG1pbmQsIHRoYXQgYnkgYSBwZXJzZXZlcmFuY2Ugb2YgZGVsaWdodCBpbiB0aGUgY29udGludWVkIGFuZCBpbmRlZmF0aWdhYmxlIGdlbmVyYXRpb24gb2Yga25vd2xlZGdlLCBleGNlZWRzIHRoZSBzaG9ydCB2ZWhlbWVuY2Ugb2YgYW55IGNhcm5hbCBwbGVhc3VyZS4="</span><span style="color: #8b0000; background-color: #383838;">)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2">decode</h4>
<div class="outline-text-4" id="text-2-3-2">
</div><div id="outline-container-sec-2-3-2-1" class="outline-5">
<h5 id="sec-2-3-2-1">Utility</h5>
<div class="outline-text-5" id="text-2-3-2-1">
<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8B8989; font-style: italic;">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; </span><span style="color: #8B8989; font-style: italic;">decoding</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">def</span> <span style="color: #D8FA3C;">decode-b64char</span> ^<span style="color: #006400;">{</span><span style="color: #4c83ff;">:doc</span> <span style="color: #61CE3C;">"Decode a 8-bit base64 representation into a 6-bits r</span><span style="color: #dc8cc3; background-color: #383838;">epresentation."</span><span style="color: #006400; background-color: #383838;">}</span>
  <span style="color: #006400;">(</span>comp <span style="color: #D8FA3C;">b</span>/to-6bits <span style="color: #D8FA3C;">d</span>/base64-dec<span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>decode-b64char <span style="color: #61CE3C;">\a</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>decode-b64char <span style="color: #61CE3C;">\b</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 1<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn</span> <span style="color: #ff1493;">decode4</span>
  <span style="color: #61CE3C;">"Decode 4 characters into 3 bytes (24 bits)"</span>
  <span style="color: #006400;">[</span>s<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">-&gt;&gt;</span> s
       <span style="color: #ff1493;">(</span>take-while #<span style="color: #ffff00;">(</span>not= <span style="color: #61CE3C;">\=</span> <span style="color: #D8FA3C;">%</span><span style="color: #ffff00;">)</span><span style="color: #ff1493;">)</span>
       <span style="color: #ff1493;">(</span>mapcat decode-b64char<span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"ab=="</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0,
                       0 1 1 0 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"ba=="</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 1,
                       0 1 1 0 1 0<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"aab="</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0,
                       0 1 1 0 1 0,
                       0 1 1 0 1 1<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"abb="</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0,
                       0 1 1 0 1 1,
                       0 1 1 0 1 1<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>
<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"aaaa"</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0,
                       0 1 1 0 1 0,
                       0 1 1 0 1 0,
                       0 1 1 0 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"abaa"</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0,
                       0 1 1 0 1 1,
                       0 1 1 0 1 0,
                       0 1 1 0 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"aaba"</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0,
                       0 1 1 0 1 0,
                       0 1 1 0 1 1,
                       0 1 1 0 1 0<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span>decode4 <span style="color: #61CE3C;">"aaab"</span><span style="color: #006400;">)</span> =&gt; <span style="color: #006400;">[</span>0 1 1 0 1 0,
                       0 1 1 0 1 0,
                       0 1 1 0 1 0,
                       0 1 1 0 1 1<span style="color: #006400;">]</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-3-2-2" class="outline-5">
<h5 id="sec-2-3-2-2">Algorithm</h5>
<div class="outline-text-5" id="text-2-3-2-2">
<ul class="org-ul">
<li>partition the string into chunk of 4 characters
</li>
<li>decode those chunk into 3 bytes (24 bits sequence).
</li>
</ul>
<p>
Here again, there is the subtlety regarding the = complement character.
Those = characters are only complements to fill in the gap in the string.
So for the decoding, we just drop them (see decode-b64char function for more details).
</p>
<ul class="org-ul">
<li>partition into 8-bits sequence
</li>
<li>transform those bits
</li>
</ul>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #8b0000;">(</span><span style="color: #FBDE2D;">defn</span> <span style="color: #ff1493;">decode</span>
  <span style="color: #61CE3C;">"Decode base64 message"</span>
  <span style="color: #006400;">[</span>s<span style="color: #006400;">]</span>
  <span style="color: #006400;">(</span><span style="color: #FBDE2D;">-&gt;&gt;</span> s
       <span style="color: #ff1493;">(</span>partition 4<span style="color: #ff1493;">)</span>    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">4 words (32 bits)</span>
       <span style="color: #ff1493;">(</span>mapcat decode4<span style="color: #ff1493;">)</span> <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">decoded into 3 bytes (24 bits)</span>
       <span style="color: #ff1493;">(</span>partition 8<span style="color: #ff1493;">)</span>    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">spliced into byte word (8 bits)</span>
       <span style="color: #ff1493;">(</span>map bits2char<span style="color: #ff1493;">)</span>  <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">converted back into char</span>
       <span style="color: #ff1493;">(</span><span style="color: #D8FA3C;">s</span>/join <span style="color: #61CE3C;">""</span><span style="color: #ff1493;">)</span><span style="color: #006400;">)</span><span style="color: #8b0000;">)</span>    <span style="color: #8B8989; font-style: italic;">;; </span><span style="color: #8B8989; font-style: italic;">then joined to form a string</span>

<span style="color: #8b0000;">(</span>fact
  <span style="color: #006400;">(</span>decode <span style="color: #61CE3C;">"TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBie</span><span style="color: #dc8cc3; background-color: #383838;">SB0aGlzIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLCB3aGljaCBpcyBhIGx1c3Qgb2YgdGhlIG1pbmQsIHRoYXQgYnkgYSBwZXJzZXZlcmFuY2Ugb2YgZGVsaWdodCBpbiB0aGUgY29udGludWVkIGFuZCBpbmRlZmF0aWdhYmxlIGdlbmVyYXRpb24gb2Yga25vd2xlZGdlLCBleGNlZWRzIHRoZSBzaG9ydCB2ZWhlbWVuY2Ugb2YgYW55IGNhcm5hbCBwbGVhc3VyZS4="</span><span style="color: #006400; background-color: #383838;">)</span>
  =&gt;  <span style="color: #61CE3C;">"Man is distinguished, not only by his reason, but by this singular passio</span><span style="color: #dc8cc3; background-color: #383838;">n from other animals, which is a lust of the mind, that by a perseverance of delight in the continued and indefatigable generation of knowledge, exceeds the short vehemence of any carnal pleasure."</span>

  <span style="color: #006400;">(</span>decode <span style="color: #61CE3C;">"YW55IGNhcm5hbCBwbGVhcw=="</span><span style="color: #006400;">)</span> =&gt; <span style="color: #61CE3C;">"any carnal pleas"</span>
  <span style="color: #006400;">(</span>decode <span style="color: #61CE3C;">"YW55IGNhcm5hbCBwbGVhc3U="</span><span style="color: #006400;">)</span> =&gt; <span style="color: #61CE3C;">"any carnal pleasu"</span>
  <span style="color: #006400;">(</span>decode <span style="color: #61CE3C;">"YW55IGNhcm5hbCBwbGVhc3Vy"</span><span style="color: #006400;">)</span> =&gt; <span style="color: #61CE3C;">"any carnal pleasur"</span><span style="color: #8b0000;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Sources</h2>
<div class="outline-text-2" id="text-3">
<p>
<a href="https://github.com/ardumont/crypto/tree/95276307cff3f98326745f8bf6ff3699129640b7">sources</a>
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Conclusion</h2>
<div class="outline-text-2" id="text-4">
<p>
I had fun even playing (again) with bits (surely, I could have reused some code that I'm not aware of!)
</p>

<p>
Coding/Programming/Developing is fun!
</p>

<p>
To sum up, "Just code it!"
</p>
</div>
</div>
