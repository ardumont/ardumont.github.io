<p>
Ok, so I got some more time and I could really test the following:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">&#xa0;</th>
<th scope="col" class="left">ghci</th>
<th scope="col" class="left">cabal-repl</th>
<th scope="col" class="left">cabal-ghci</th>
<th scope="col" class="left">cabal-dev</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Unit Tests</td>
<td class="left">OK</td>
<td class="left">OK</td>
<td class="left">OK</td>
<td class="left">OK</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="left">Manual without wrapper function (the default)</td>
<td class="left">OK</td>
<td class="left">OK</td>
<td class="left">OK</td>
<td class="left">N/A</td>
</tr>

<tr>
<td class="left">Manual with wrapper function</td>
<td class="left">OK</td>
<td class="left">OK</td>
<td class="left">OK</td>
<td class="left">N/A</td>
</tr>
</tbody>
</table>

<p>
(as before I did not test cabal-dev because I do not know this one but I ensure the initial contract stays the same as before&#x2026; in unit tests that is&#x2026;)
</p>

<p>
Here is the possible `.dir-labels` I used:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">((haskell-mode . ((haskell-process-wrapper-function . (lambda (argv) (append (list "nix-shell" "haskell-lab.nix" "--command" )
									(list (mapconcat 'identity argv " ")))))
		  (haskell-process-type . ghci)))) ;; ok

((haskell-mode . ((haskell-process-wrapper-function . (lambda (argv) (append (list "nix-shell" "haskell-lab.nix" "--command" )
									(list (mapconcat 'identity argv " ")))))
		  (haskell-process-type . cabal-repl)))) ;; ok

((haskell-mode . ((haskell-process-wrapper-function . (lambda (argv) (append (list "nix-shell" "haskell-lab.nix" "--command" )
									(list (mapconcat 'identity argv " ")))))
		  (haskell-process-type . cabal-ghci)))) ;; ok
</pre>
</div>

<p>
Their equivalence as `custom-set-variables`:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(custom-set-variables '(haskell-process-wrapper-function (lambda (argv) (append (list "nix-shell" "haskell-lab.nix" "--command" )
									   (list (mapconcat 'identity argv " ")))))
		      '(haskell-process-type ghci)) ;; ok

(custom-set-variables '(haskell-process-wrapper-function (lambda (argv) (append (list "nix-shell" "haskell-lab.nix" "--command" )
									   (list (mapconcat 'identity argv " ")))))
		      '(haskell-process-type cabal-repl)) ;; ok

(custom-set-variables '(haskell-process-wrapper-function (lambda (argv) (append (list "nix-shell" "haskell-lab.nix" "--command" )
									   (list (mapconcat 'identity argv " ")))))
		      '(haskell-process-type cabal-ghci)) ;; ok
</pre>
</div>


<p>
<b>Note</b>
I tried to use `shell-quote-argument` but systematically resulted in `command not found`.
</p>

<p>
Here is the sample that did not work out
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">((haskell-mode . ((haskell-process-wrapper-function . (lambda (argv) (append (list "nix-shell" "haskell-lab.nix" "--command" )
									(list (shell-quote-argument (mapconcat 'identity argv " "))))))
		  (haskell-process-type . ghci)))) ;; shell-quote-argument does not work
</pre>
</div>
