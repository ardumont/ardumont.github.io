<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Install</a></li>
<li><a href="#sec-2">Make it a service</a></li>
<li><a href="#sec-3">Setup</a>
<ul>
<li><a href="#sec-3-1">Server</a>
<ul>
<li><a href="#sec-3-1-1">Open the proxy</a></li>
<li><a href="#sec-3-1-2">Adding authentication</a></li>
<li><a href="#sec-3-1-3">Restart</a></li>
</ul>
</li>
<li><a href="#sec-3-2">Client</a>
<ul>
<li><a href="#sec-3-2-1">Setup</a></li>
<li><a href="#sec-3-2-2">Check</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
I have got some speed troubles with my network from some time now.
So here is one solution my team and I think of to overcome it.
</p>

<p>
We first created a <a href="http://vagrantup.com/">vagrant machine</a> with <a href="http://www.pps.univ-paris-diderot.fr/~jch/software/polipo/polipo.html">polipo</a> inside.
Now we moved on to a central machine to avoid the centralization of one person.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Install</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre class="src src-sh">sudo aptitude install polipo
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Make it a service</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-sh">sudo aptitude install chkconfig
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">sudo chkconfig polipo on
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Setup</h2>
<div class="outline-text-2" id="text-3">
<p>
First, we will install the server part, then the client.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Server</h3>
<div class="outline-text-3" id="text-3-1">
<p>
When installing via ubuntu, the default setup is admittedly good.
After all, so they say if we're confident with the first lines of the <code>/etc/polipo/config</code>.
</p>

<div class="org-src-container">

<pre class="src src-sh"># Sample configuration file for Polipo. -*-sh-*-

# You should not need to edit this configuration file; all configuration
# variables have reasonable defaults.
</pre>
</div>

<p>
I'm confident with those default but I need to make some modifications regarding who is gonna use our proxy.
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">Open the proxy</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
We permit remote connections to the proxy.
</p>

<div class="org-src-container">

<pre class="src src-sh">proxyAddress=0.0.0.0
#allowedClients = 127.0.0.1, 192.168.0.0/24, 192.168.33.0/24
</pre>
</div>

<p>
<b>Note</b>
No access restriction regarding IP is done yet because I shamefully admit that I did not succeed yet.
</p>

<p>
(It's the second line where you can detail the ip or the range of ips you authorize to use the proxy)
</p>
</div>
</div>

<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2">Adding authentication</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
I want machine to authenticate in the proxy to use it.
For this, add the <code>authCredentials</code> variable.
</p>

<div class="org-src-container">

<pre class="src src-sh">authCredentials=some-user:some-pass
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3">Restart</h4>
<div class="outline-text-4" id="text-3-1-3">
<p>
At the end of the setup, restart the service.
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo service polipo restart
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Client</h3>
<div class="outline-text-3" id="text-3-2">
</div><div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1">Setup</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
Personally, I use the <code>/etc/environment</code> file.
</p>

<p>
My personal setup:
</p>
<ul class="org-ul">
<li>proxy is on the <code>192.168.33.2</code> machine
</li>
<li>proxy listens on port <code>8123</code>.
</li>
<li>credentials: <code>some-user:some-pass</code>.
</li>
</ul>

<p>
Resulting to this, you can add the equivalent lines to your <code>/etc/environment</code>:
</p>

<div class="org-src-container">

<pre class="src src-sh">export http_proxy="http://some-user:some-pass@192.168.33.2:8123"
export https_proxy="http://some-user:some-pass@192.168.33.2:8123"
export ftp_proxy="http://some-user:some-pass@192.168.33.2:8123"
export no_proxy="localhost,192.168.33.2,localaddress,.localdomain.com"
export HTTP_PROXY="http://some-user:some-pass@192.168.33.2:8123"
export HTTPS_PROXY="http://some-user:some-pass@192.168.33.2:8123"
export FTP_PROXY="http://some-user:some-pass@192.168.33.2:8123"
</pre>
</div>

<p>
Then reload your environment.
You may need to logout and login again.
</p>

<p>
<b>Note</b>
</p>

<p>
As I use stumpwm, I personally only need to reload my stumpwm setup file (<b>C-t ;</b> then <b>loadrc</b>, or just as my settings goes, <b>C-t L</b>).
</p>
</div>
</div>

<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2">Check</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Load a terminal and execute the command <code>env | grep -i proxy</code>, you should see something along those lines:
</p>

<div class="org-src-container">

<pre class="src src-sh">http_proxy=http://some-user:some-pass@192.168.33.2:8123
ftp_proxy=http://some-user:some-pass@192.168.33.2:8123
FTP_PROXY=http://some-user:some-pass@192.168.33.2:8123
HTTPS_PROXY=http://some-user:some-pass@192.168.33.2:8123
https_proxy=http://some-user:some-pass@192.168.33.2:8123
no_proxy=localhost,192.168.33.2,localaddress,.localdomain.com
HTTP_PROXY=http://some-user:some-pass@192.168.33.2:8123
</pre>
</div>

<p>
Then requesting to wget google, you should see something along those lines too:
</p>
<div class="org-src-container">

<pre class="src src-sh">tony@dagobah(0,09,) 17:01:11 ~/repo/perso/vms/vagrant-http-proxy $ wget http://google.fr
--2012-12-26 17:01:21--  http://google.fr/
Connecting to 192.168.33.2:8123... connected.
Proxy request sent, awaiting response... 301 Moved Permanently
Location: http://www.google.fr/ [following]
--2012-12-26 17:01:21--  http://www.google.fr/
Reusing existing connection to 192.168.33.2:8123.
Proxy request sent, awaiting response... 200 OK
Length: unspecified [text/html]
Saving to: `index.html'

    [ &lt;=&gt;                                                                                                                           ] 13 918      --.-K/s   in 0,04s

2012-12-26 17:01:21 (323 KB/s) - `index.html' saved [13918]
</pre>
</div>

<p>
We see that we connect to the proxy <code>192.168.33.2</code> before requesting google.
Victory!
</p>
</div>
</div>
</div>
</div>
