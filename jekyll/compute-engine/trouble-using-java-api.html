<p>
Create an instance through the compute engine java api.
</p>

<p>
I do succeed in listing instances but do not succeed in creating instances through the java api (1.15.0-rc).
</p>

<p>
I successfully listed instances using the java api for compute-engine.
I am using the <a href="https://developers.google.com/accounts/docs/OAuth2ServiceAccount">https://developers.google.com/accounts/docs/OAuth2ServiceAccount</a> strategy to authenticate.
</p>

<p>
java dependencies:
</p>

<p>
 &lt;dependencies&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;com.google.http-client&lt;/groupId&gt;
     &lt;artifactId&gt;google-http-client-jackson2&lt;/artifactId&gt;
     &lt;version&gt;${project.http.version}&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;com.google.oauth-client&lt;/groupId&gt;
     &lt;artifactId&gt;google-oauth-client-jetty&lt;/artifactId&gt;
     &lt;version&gt;${project.oauth.version}&lt;/version&gt;
   &lt;/dependency&gt;
   &lt;dependency&gt;
     &lt;groupId&gt;com.google.apis&lt;/groupId&gt;
     &lt;artifactId&gt;google-api-services-compute&lt;/artifactId&gt;
     &lt;version&gt;v1beta14-rev20-1.15.0-rc&lt;/version&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;
 &lt;properties&gt;
   &lt;project.http.version&gt;1.15.0-rc&lt;/project.http.version&gt;
   &lt;project.oauth.version&gt;1.15.0-rc&lt;/project.oauth.version&gt;
   &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
 &lt;/properties&gt;
</p>

<p>
Here is the authentication snippet I use (which works for listing the instances):
</p>

<p>
private static final List&lt;String&gt; SCOPES = Arrays.asList(ComputeScopes.COMPUTE);
&#x2026;
</p>

<p>
String accountEmail = "accountEmail";
// change this
File key = new File("/path/to/key.p12");
</p>

<p>
// service account credential (uncomment setServiceAccountUser for domain-wide delegation)
GoogleCredential credential = new GoogleCredential.Builder().setTransport(HTTP<sub>TRANSPORT</sub>)
    .setJsonFactory(JSON<sub>FACTORY</sub>)
    .setServiceAccountId(accountEmail)  <i>/ sets the service account ID (typically an e-mail address) or null for none
    .setServiceAccountScopes(SCOPES)    /</i> sets the space-separated OAuth scopes to use with the service account
                                        // flow or null for none
    .setServiceAccountPrivateKeyFromP12File(key)
    .build();
</p>

<p>
Here is the instance creation snippet:
</p>

<p>
private static final String zoneName = "europe-west1-a";
&#x2026;
</p>

<p>
// create instance description
Instance instance = new Instance();
instance.setName("ard-4th-instance");
instance.setMachineType("<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro</a>");
</p>

<p>
AttachedDisk disk = new AttachedDisk();
disk.setType("PERSISTENT");
disk.setBoot(true);
disk.setSource("<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/disks/boot-ard-fst-instance">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/disks/boot-ard-fst-instance</a>");
ArrayList&lt;AttachedDisk&gt; disks = new ArrayList&lt;AttachedDisk&gt;();
disks.add(disk);
instance.setDisks(disks);
</p>

<p>
// build
Compute.Instances.Insert instances = compute.instances().insert(projectId, zoneName, instance);
instances.execute();
</p>

<p>
When executing such code, here's the answer:
</p>

<p>
com.google.api.client.googleapis.json.GoogleJsonResponseException: 400 Bad Request
{
  "code" : 400,
  "errors" : [ {
    "domain" : "global",
    "message" : "Invalid value for field 'resource.machineType': 'https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro'
.  Must be a URL to a Compute resource in the same zone.",
    "reason" : "invalid"
  }, {
    "domain" : "global",
    "message" : "Invalid value for field 'resource.disks<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>.source': 'https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/disks/boot-ard-fst
-instance'.  Must be a URL to a Compute resource in the same zone.",
    "reason" : "invalid"
  } ],
  "message" : "Invalid value for field 'resource.machineType': 'https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro'.
 Must be a URL to a Compute resource in the same zone."
}
</p>

<p>
From what I understand, I must ensure resources from the same zone which is europe-west1-a.
Ok, but from my standpoint, this is what I do.
</p>

<p>
One remark:
I can see that the <i>v1beta15</i> version of the rest api (inside url) is not the same as the java client api (1.15.0-rc from the
pom).
</p>

<p>
Using the api test tooling (thanks for that btw), I successfully built a request (which seems pretty similar to the java one):
</p>

<p>
{
  "machineType":
"<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro</a>",
  "name": "testapi",
  "disks":
  [
    {
      "type": "PERSISTENT",
      "source":
"<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/disks/boot-ard-fst-instance">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/disks/boot-ard-fst-instance</a>",
      "boot": true
    }
  ],
  "networkInterfaces":
  [
    {
      "network":
"<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/global/networks/default">https://www.googleapis.com/compute/v1beta15/projects/app-test/global/networks/default</a>"
    }
  ]
}
</p>

<p>
Here is the successful answer:
</p>

<p>
POST <a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/instances?key={YOUR_API_KEY">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/instances?key={YOUR_API_KEY</a>}
</p>

<p>
Content-Type:  application/json
Authorization:  Bearer ya29.xxxxxxxxxxHEXoyIzXZR4VGI2Iv<sub>yyyyyyhgHb27Zzzzzz</sub>
X-JavaScript-User-Agent:  Google APIs Explorer
</p>

<p>
{
"machineType": "<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/machineTypes/f1-micro</a>",
"name": "testapi",
"disks": [
{
"type": "PERSISTENT",
"source": "<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/disks/boot-ard-fst-instance">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/disks/boot-ard-fst-instance</a>",
"boot": true
}
],
"networkInterfaces": [
{
"network": "<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/global/networks/default">https://www.googleapis.com/compute/v1beta15/projects/app-test/global/networks/default</a>"
}
]
}
</p>

<p>
The response:
</p>

<p>
200 OK
</p>

<ul class="org-ul">
<li>Show headers -
</li>
</ul>

<p>
{
"kind": "compute#operation",
"id": "xxxx3793wwww779zzzz",
"name": "operation-aaaa342bbbb46-cccc1c80dddd1-eeeeeeee",
"zone": "<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a</a>",
"operationType": "insert",
"targetLink": "<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/instances/testapi">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/instances/testapi</a>",
"status": "PENDING",
"user": "user@mail.com",
"progress": 0,
"insertTime": "2013-06-04T03:45:36.946-07:00",
"startTime": "2013-06-04T03:45:37.005-07:00",
"selfLink": "<a href="https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/operations/operation-yyyy342736946-xxxx1c80cbd71-dff64dea">https://www.googleapis.com/compute/v1beta15/projects/app-test/zones/europe-west1-a/operations/operation-yyyy342736946-xxxx1c80cbd71-dff64dea</a>"
}
</p>

<p>
Does someone has any hints regarding what is wrong, please?
</p>

<p>
Thanks for any help shedding some light on this.
</p>

<p>
Regards,
Antoine R. Dumont
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p>DEFINITION NOT FOUND.</p></div>


</div>
</div>
