<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">wifi</a>
<ul>
<li><a href="#sec-1-1">dagobah</a>
<ul>
<li><a href="#sec-1-1-1">wpa<sub>supplicant</sub></a></li>
<li><a href="#sec-1-1-2">NetworkManager</a></li>
</ul>
</li>
<li><a href="#sec-1-2">job</a>
<ul>
<li><a href="#sec-1-2-1">wpa<sub>supplicant</sub> (default with nixos)</a></li>
<li><a href="#sec-1-2-2">NetworkManager</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">ssh</a></li>
<li><a href="#sec-3">proxy</a>
<ul>
<li><a href="#sec-3-1">Setup proxy</a></li>
<li><a href="#sec-3-2">Rebuild</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">wifi</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">dagobah</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1">wpa<sub>supplicant</sub></h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
We need to update the interfaces to ["wlp1s0"]:
</p>

<div class="org-src-container">

<pre class="src src-nix">networking = {
  hostName = "dagobah";    # Define your hostname.

  wireless = {
    enable = true;                # Enables wireless
    userControlled.enable = true; # user can play with wifi
    interfaces = [ "wlp1s0" ];    # explicit the interfaces the user can modify
  };
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2">NetworkManager</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
If we want to use nmcli, remove the wireless entry and use directly networkmanager (incompatible with the other).
</p>

<div class="org-src-container">

<pre class="src src-nix">networking = {
  hostName = "dagobah";    # Define your hostname.

  # wireless = {
  #   enable = true;                # Enables wireless
  #   userControlled.enable = true; # user can play with wifi
  #   interfaces = [ "wlp1s0" ];    # explicit the interfaces the user can modify
  # };

  networkmanager.enable = true; # nm, nmcli, etc... incompatible with networking.wireless
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">job</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">wpa<sub>supplicant</sub> (default with nixos)</h4>
<div class="outline-text-4" id="text-1-2-1">
<div class="org-src-container">

<pre class="src src-nix">networking = {
  hostName = "job";    # Define your hostname.

  wireless = {
    enable = true;                # Enables wireless
    userControlled.enable = true; # user can play with wifi
    interfaces = [ "wlo1" ];      # explicit the interfaces the user can modify
  };
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">NetworkManager</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
Using networkmanager, building the next generation fails with this log message:
</p>

<div class="org-src-container">

<pre class="src src-log">$ sudo nixos-rebuild switch
building Nix...
building the system configuration...
updating GRUB 2 menu...
stopping the following units: dhcpcd.service, local-fs.target, network-interfaces.target, remote-fs.target, systemd-modules-load.service, wpa_supplicant.service
activating the configuration...
setting up /etc...
removing obsolete symlink ‘/etc/dhcpcd.exit-hook’...
restarting the following units: polkit.service
starting the following units: default.target, getty.target, graphical.target, ip-up.target, local-fs.target, multi-user.target, network-interfaces.target, network.target, paths.target, remote-fs.target, slices.target, sockets.target, swap.target, systemd-modules-load.service, timers.target, wpa_supplicant.service
warning: the following units failed: NetworkManager.service

● NetworkManager.service - Network Manager
   Loaded: loaded (/nix/store/yxv3dbyn5aa0x9c50hqlvyvqgffqdmpv-network-manager-0.9.8.8/etc/systemd/system/NetworkManager.service)
   Active: failed (Result: exit-code) since Tue 2014-10-07 09:58:51 CEST; 39ms ago
  Process: 7196 ExecStart=/nix/store/yxv3dbyn5aa0x9c50hqlvyvqgffqdmpv-network-manager-0.9.8.8/sbin/NetworkManager --no-daemon (code=exited, status=1/FAILURE)
 Main PID: 7196 (code=exited, status=1/FAILURE)

Oct 07 09:58:51 job NetworkManager[7196]: &lt;error&gt; [1412668731.59484] [nm-dbus-manager.c:332] nm_dbus_manager_start_service(): Could not acquire the NetworkManager service.
					    Error: 'Connection ":1.38" is not allowed to own the service "org.freedesktop.NetworkManager" due to security policies in the configuration file'
Oct 07 09:58:51 job NetworkManager[7196]: &lt;error&gt; [1412668731.59721] [main.c:592] main(): failed to start the dbus service.
Oct 07 09:58:51 job systemd[1]: NetworkManager.service: main process exited, code=exited, status=1/FAILURE
Oct 07 09:58:51 job systemd[1]: Failed to start Network Manager.
Oct 07 09:58:51 job systemd[1]: Unit NetworkManager.service entered failed state.
</pre>
</div>

<p>
No network after that.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">ssh</h2>
<div class="outline-text-2" id="text-2">
<p>
I stumble upon this snippet to deploy public key. Seems pretty nice.
</p>

<div class="org-src-container">

<pre class="src src-nix">users.extraUsers.root.openssh.authorizedKeys.keys = [ (builtins.readFile ./id_rsa.pub) ];
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">proxy</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Setup proxy</h3>
<div class="outline-text-3" id="text-3-1">
<p>
This will generate a file which is sourced from the main /etc/profile.
</p>

<div class="org-src-container">

<pre class="src src-nix">nix.proxy = "http://yourproxy:yourproxyport";
</pre>
</div>

<p>
source: <a href="http://nixos.org/nixos/manual/#opt-nix.proxy">http://nixos.org/nixos/manual/#opt-nix.proxy</a>
</p>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Rebuild</h3>
<div class="outline-text-3" id="text-3-2">
<p>
This helps in building nixos from behing a proxy:
</p>

<div class="org-src-container">

<pre class="src src-nix">export http_proxy=http://yourproxy:yourproxy-port
NIX_REMOTE= nix-build -A system "&lt;nixos&gt;"
nixos-rebuild switch
</pre>
</div>

<p>
source: <a href="https://lastlog.de/wiki/index.php/Nixos_configuration.nix">https://lastlog.de/wiki/index.php/Nixos_configuration.nix</a>
</p>
</div>
</div>
</div>
