
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Chef</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>2008
</li>
<li>Open source
</li>
<li>Ruby (+Erlang) for the server part
</li>
<li>dev/ops write in ruby + json (cookbook -&gt; set of recipes)
</li>
<li>agent-server system
</li>
<li>script execution in order
</li>
<li>chef solor
</li>
<li>Normalization over configuration
</li>
<li>idempotent
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">More than scripts</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>Complete orchestration of infrastructure
</li>
<li>Interface with:
<ul class="org-ul">
<li>amazon
</li>
<li>google cloud
</li>
<li>vagrant
</li>
<li>&#x2026;
</li>
</ul>
</li>
<li>open source script
<ul class="org-ul">
<li>community.opscode.com
</li>
<li>cookbooks TravisCi
</li>
<li>&#x2026;
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Components</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>Chef-Solo: Play recipes on env
</li>
<li>Chef-Client: Chef-Solo -_ recipes retrieval on remote server (Chef-Server)
</li>
<li>Chef-Server: Owns the infrastructure knowledge
</li>
<li>&#x2026;
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Chef repository</h2>
<div class="outline-text-2" id="text-4">
<p>
folder:
</p>
<ul class="org-ul">
<li>certificats/
</li>
<li>cookbooks/
<ul class="org-ul">
<li>tomcat7/
<ul class="org-ul">
<li>recipes/
<ul class="org-ul">
<li>default.rb (minimum requisite for a cookbook)
</li>
</ul>
</li>
</ul>
</li>
<li>php/
</li>
<li>mysql/
</li>
</ul>
</li>

<li>data<sub>bags</sub>/ (user, passwords, &#x2026;)
</li>
<li>environments/
</li>
<li>roles (recipes cookbooks composition. e.g. LAMP)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Cookbook</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Example</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">

<pre class="src src-ruby"># Install package
package 'tomcat7' do
  action :install
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby"># template used to generate the setenv.sh
template '/usr/share/tomcat7/bin/setenv.sh' do
  source 'setenv.sh.erb'
  owner 'tomcat7'
  group 'tomcat7'
  mode '755'
end
</pre>
</div>

<div class="org-src-container">

<pre class="src src-ruby"># managed service by chef
service 'tomcat7' do
  supports restart: true, reload:false, status: true
  action [:start, :enable]
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">All is resource</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>package, template
</li>
<li>resource is a definition
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Resource</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li>execution conditions
</li>
<li>subscriptions (the resource executes after another)
</li>
<li>notifications (one resource after the current resource -&gt; react)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Tests</h2>
<div class="outline-text-2" id="text-8">
<ul class="org-ul">
<li>unit: rspec, chefspec
</li>
<li>integration: test-kitchen
</li>
<li>good practices and quality: rubocop, foodcritic
</li>
<li>chef independent: bats, minitest, serverspec
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">TDD</h2>
<div class="outline-text-2" id="text-9">
<p>
Red-green-refactor
</p>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">Chefspec</h2>
<div class="outline-text-2" id="text-10">
<p>
Test the cookbook
</p>
<div class="org-src-container">

<pre class="src src-ruby">require 'chefspec'

describe 'example::default' do
  let(:chef_run) { ChefSpec::Runner.new.converge(described_recipe) }

  it 'does_something' do
    expect(chef_run).to install_package('tomcat7')
  end
end
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">Test-kitchen</h2>
<div class="outline-text-2" id="text-11">
<ul class="org-ul">
<li>cookbooks on many envs
</li>
<li>test the complete chain
</li>
<li>useful for multi os / multi env
</li>
<li>driver
</li>
<li>&#x2026;
</li>
</ul>
</div>

<div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1">Example</h3>
<div class="outline-text-3" id="text-11-1">
<p>
kitchen.yaml
</p>
<div class="org-src-container">

<pre class="src src-yaml">driver:
  name: vagrant

provisioner:
  name: chef_zero

platforms:
  - name: ubuntu-13.04
  - name: centos-6.5

suites:
  - name: client
    run_list:
    - recipe[postgresql::client]
  - name: server
    run_list:
      - recipe[postgresql;::server]
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12">Bats</h2>
<div class="outline-text-2" id="text-12">
<p>
IT
</p>

<div class="org-src-container">

<pre class="src src-bash">#!/usr/bin/env bats

@test 'it creates tomcat directory' {
  test -d /var/lib/tomcat7
}

@test 'it starts tomcat' {
  service tomcat7 status
}

@test 'it responsed with content' {
  run curl http://location:8080/
  [ "$status" -eq 0 ]
  echo "$output" | grep 'hipster'
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13">Minitest</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li>ruby (independent from chef)
</li>
<li>&#x2026;
</li>
</ul>
</div>

<div id="outline-container-sec-13-1" class="outline-3">
<h3 id="sec-13-1">Sample</h3>
<div class="outline-text-3" id="text-13-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'minitest/autorun'

describe 'stack::tomcat7' do
  describe 'services' do
    it "runs as a daemon' do
       assert system ('service tomcat7 status')
    end
...
  end
end
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14">Serverspec</h2>
<div class="outline-text-2" id="text-14">
<ul class="org-ul">
<li>ruby (independent from chef)
</li>
<li>write spec for server
</li>
<li>based on rspec
</li>
<li>remote
</li>
<li>multi os support
</li>
<li>&#x2026;
</li>
</ul>
</div>
<div id="outline-container-sec-14-1" class="outline-3">
<h3 id="sec-14-1">Sample</h3>
<div class="outline-text-3" id="text-14-1">
<div class="org-src-container">

<pre class="src src-ruby">require 'spec_helper'

describe package('httpd') do
  it { should be_installed }
end

...
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15">Rubocop</h2>
<div class="outline-text-2" id="text-15">
<ul class="org-ul">
<li>Check the good practices ruby
</li>
<li>Static analysis
</li>
<li>bbatsov
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-16" class="outline-2">
<h2 id="sec-16">Foodcritic</h2>
<div class="outline-text-2" id="text-16">
<ul class="org-ul">
<li>&#x2026;
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-17" class="outline-2">
<h2 id="sec-17">TDD cookbook</h2>
<div class="outline-text-2" id="text-17">
<ul class="org-ul">
<li>Cookbook 'Stack'
<ul class="org-ul">
<li>MySQL
</li>
<li>Tomcat 7
</li>
<li>Jhipster
</li>
</ul>
</li>
</ul>

<p>
Disclaimer:
</p>
<ul class="org-ul">
<li>better to split in many cookbook 'stack'
</li>
<li>one resource for the database creation
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-18" class="outline-2">
<h2 id="sec-18">Run</h2>
<div class="outline-text-2" id="text-18">
<div class="org-src-container">

<pre class="src src-sh">rake
</pre>
</div>
</div>
</div>
