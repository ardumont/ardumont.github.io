<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">What we must do</a>
<ul>
<li><a href="#sec-1-1">Add the dependencies in maven</a></li>
<li><a href="#sec-1-2">Add a proxy in the server part.</a></li>
<li><a href="#sec-1-3">Add this entry in the /wikeo-web/src/main/webapp/WEB-INF/web.xml</a></li>
<li><a href="#sec-1-4">Create interface proxies</a></li>
<li><a href="#sec-1-5">No annotations specifying the language or communication.</a></li>
<li><a href="#sec-1-6">The annotations come from different package</a></li>
<li><a href="#sec-1-7">Use the connector</a></li>
</ul>
</li>
<li><a href="#sec-2">What looks like the call of the asynchronous method</a>
<ul>
<li><a href="#sec-2-1">Immediate difference</a>
<ul>
<li><a href="#sec-2-1-1">Gwt</a></li>
<li><a href="#sec-2-1-2">Gwt-restlet</a></li>
</ul>
</li>
<li><a href="#sec-2-2">Long sample, activity part</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">What we must do</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Add the dependencies in maven</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<pre class="src src-xml">&lt;!-- ================ Dependencies : GWT ========================= --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.restlet.jee&lt;/groupId&gt;
	&lt;artifactId&gt;org.restlet&lt;/artifactId&gt;
	&lt;version&gt;${restlet.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.restlet.jee&lt;/groupId&gt;
	&lt;artifactId&gt;org.restlet.ext.servlet&lt;/artifactId&gt;
	&lt;version&gt;${restlet.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.restlet.jee&lt;/groupId&gt;
	&lt;artifactId&gt;org.restlet.ext.net&lt;/artifactId&gt;
	&lt;version&gt;${restlet.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.restlet.gwt&lt;/groupId&gt;
	&lt;artifactId&gt;org.restlet&lt;/artifactId&gt;
	&lt;version&gt;${restlet.version}&lt;/version&gt;
&lt;/dependency&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Add a proxy in the server part.</h3>
<div class="outline-text-3" id="text-1-2">
<p>
It will be in charge of redirecting every resource asked to the
resource server.
</p>
<div class="org-src-container">

<pre class="src src-sh">public class Main extends Application {

	@Override
	public synchronized Restlet createInboundRoot() {
		Redirector redirector = new Redirector(getContext(),
				"http://localhost:8080/wikeo-resource{rr}");
		return redirector;
	}
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">Add this entry in the /wikeo-web/src/main/webapp/WEB-INF/web.xml</h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">

<pre class="src src-xml">&lt;servlet&gt;
	&lt;servlet-name&gt;adapter&lt;/servlet-name&gt;
	&lt;servlet-class&gt;org.restlet.ext.servlet.ServerServlet&lt;/servlet-class&gt;
	&lt;init-param&gt;
		&lt;param-name&gt;org.restlet.application&lt;/param-name&gt;
		&lt;param-value&gt;com.adeo.wikeo.adeoweb.server.Main&lt;/param-value&gt;
	&lt;/init-param&gt;
	&lt;init-param&gt;
		&lt;param-name&gt;org.restlet.clients&lt;/param-name&gt;
		&lt;param-value&gt;HTTP&lt;/param-value&gt;
	&lt;/init-param&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
	&lt;servlet-name&gt;adapter&lt;/servlet-name&gt;
	&lt;url-pattern&gt;/wikeo-resource/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Create interface proxies</h3>
<div class="outline-text-3" id="text-1-4">
<p>
We must create proxies to our interfaces declared in
wikeo-resources-api to declare the method the same way as gwt does.
</p>

<p>
Here is the original in the api:
</p>
<div class="org-src-container">

<pre class="src src-java">package com.adeo.wikeo.resource;

import org.restlet.resource.Get;

import com.adeo.wikeo.representation.AttributeRepresentation;

/**
 * @author : dawidlo Date: 8/10/11
 */
public interface AttributeResource {

	public static final String ATTRIBUTE_RESOURCE_PATH = "/v1/core/dictionary/attributes/";

	/**
	 * Finds an attribute by it's id.
	 *
	 * @return An AttributeRepresentation or null.
	 */
	@Get
	AttributeRepresentation findAttributeById();
}
</pre>
</div>

<p>
And here is the proxy one declared inside the wikeo-web part
</p>
<div class="org-src-container">

<pre class="src src-java">package com.adeo.wikeo.resource;

import org.restlet.client.resource.ClientProxy;
import org.restlet.client.resource.Get;
import org.restlet.client.resource.Result;

import com.adeo.wikeo.representation.AttributeRepresentation;

public interface AttributeResourceProxy extends ClientProxy {

	/**
	 * Finds an attribute by it's id.
	 *
	 * @return An AttributeRepresentation or null.
	 */
	@Get
	void findAttributeById(Result&lt;AttributeRepresentation&gt; result);
}
</pre>
</div>

<p>
The subtility is in the Result&lt;AttributeRepresentation&gt; instead of
void in the previous example.
</p>

<p>
Beware:
</p>
</div>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">No annotations specifying the language or communication.</h3>
<div class="outline-text-3" id="text-1-5">
<p>
We must let the client and the server choose the one they want to
communicate with (here gwt-json).
</p>
</div>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6">The annotations come from different package</h3>
<div class="outline-text-3" id="text-1-6">
<p>
In wikeo-web, org.restlet.client.resource.(Post|Get|&#x2026;)
In wikeo-resources-api, org.restlet.resource.(Post|Get|&#x2026;)
</p>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7">Use the connector</h3>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">What looks like the call of the asynchronous method</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Immediate difference</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">Gwt</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Before gwt-restlet, we created an AsyncCallback with the actions to
take in success or error, the rpc call via 2 interfaces, and the
server code to serve the rpc call (wrapper of the resource call).
</p>

<p>
Synchroneous interface:
</p>
<div class="org-src-container">

<pre class="src src-java">@RemoteServiceRelativePath("Service")
public interface Service extends RemoteService {
	...
	AttributeRepresentation searchAttributeById(String attributeId) throws UIException;
}
</pre>
</div>

<p>
Asynchroneous one generated by your ide
</p>
<div class="org-src-container">

<pre class="src src-java">public interface ServiceAsync {
	void searchAttributeById(String attributeId, AsyncCallback&lt;AttributeRepresentation&gt; callback);
}
</pre>
</div>

<p>
Activity part that call the rpc:
</p>
<div class="org-src-container">

<pre class="src src-java">AsyncCallback&lt;AttributeRepresentation&gt; callback = createCallbackSearchAttribute();
service.searchAttributeById(attributeId, callback);
</pre>
</div>

<p>
Asyncallback part with the actions to take in success or error:
</p>
<div class="org-src-container">

<pre class="src src-java">/**
 * Create a callback.
 *
 * @return AsyncCallback&lt;AttributeRepresentation&gt;
 */
@VisibleForTesting
AsyncCallback&lt;AttributeRepresentation&gt; createCallbackSearchAttribute() {
	return new AsyncCallback&lt;AttributeRepresentation&gt;() {
		@Override
		public void onSuccess(AttributeRepresentation attributeRepresentation) {
			dealWithSuccess(attributeRepresentation);
		}

		@Override
		public void onFailure(Throwable caught) {
			dealWithError(caught);
		}
	};
}
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">Gwt-restlet</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Now the difference is we call directly the resource (we need to create
a proxy interface and call this proxy interface):
</p>
<div class="org-src-container">

<pre class="src src-java">Result&lt;AttributeRepresentation&gt; callback = createCallbackSearchAttribute();
attributeResourceProxy.getClientResource().setReference(SetupUrl.URL_ATTRIBUTE_WIKEO + attributeId);
attributeResourceProxy.findAttributeById(callback);
</pre>
</div>

<p>
We do not need interfaces and the server code.
We just need to create the callback
</p>
<div class="org-src-container">

<pre class="src src-java">/**
 * Create a callback.
 *
 * @return Result&lt;AttributeRepresentation&gt;
 */
@VisibleForTesting
Result&lt;AttributeRepresentation&gt; createCallbackSearchAttribute() {
	return new Result&lt;AttributeRepresentation&gt;() {
		@Override
		public void onSuccess(AttributeRepresentation attributeRepresentation) {
			dealWithSuccess(attributeRepresentation);
		}

		@Override
		public void onFailure(Throwable caught) {
			dealWithError(caught);
		}
	};
}
</pre>
</div>

<p>
#+END<sub>SRC</sub>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Long sample, activity part</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Before with rpc call in gwt
</p>
<div class="org-src-container">

<pre class="src src-java">/*
 * (non-Javadoc)
 *
 * @see
 * com.adeo.wikeo.adeoweb.client.ui.VisualizeAttributeView.Presenter#searchAttributeById
 * (java.lang.String)
 */
@Override
public void searchAttributeById(String attributeId) {
	AsyncCallback&lt;AttributeRepresentation&gt; callback = createCallbackSearchAttribute();
	service.searchAttributeById(attributeId, callback);
	getView().enableSearch(false);
}

/**
 * Create a callback.
 *
 * @return AsyncCallback&lt;AttributeRepresentation&gt;
 */
@VisibleForTesting
AsyncCallback&lt;AttributeRepresentation&gt; createCallbackSearchAttribute() {
	return new AsyncCallback&lt;AttributeRepresentation&gt;() {
		@Override
		public void onSuccess(AttributeRepresentation attributeRepresentation) {
			dealWithSuccess(attributeRepresentation);
		}

		@Override
		public void onFailure(Throwable caught) {
			dealWithError(caught);
		}
	};
}
</pre>
</div>
<p>
Now with gwt-restlet
</p>
<div class="org-src-container">

<pre class="src src-java">/*
 * (non-Javadoc)
 *
 * @see
 * com.adeo.wikeo.adeoweb.client.ui.VisualizeAttributeView.Presenter#searchAttributeById
 * (java.lang.String)
 */
@Override
public void searchAttributeById(String attributeId) {
	Result&lt;AttributeRepresentation&gt; callback = createCallbackSearchAttribute();
	attributeResourceProxy.getClientResource().setReference(SetupUrl.URL_ATTRIBUTE_WIKEO + attributeId);
	attributeResourceProxy.findAttributeById(callback);
	getView().enableSearch(false);
}

/**
 * Create a callback.
 *
 * @return Result&lt;AttributeRepresentation&gt;
 */
@VisibleForTesting
Result&lt;AttributeRepresentation&gt; createCallbackSearchAttribute() {
	return new Result&lt;AttributeRepresentation&gt;() {
		@Override
		public void onSuccess(AttributeRepresentation attributeRepresentation) {
			dealWithSuccess(attributeRepresentation);
		}

		@Override
		public void onFailure(Throwable caught) {
			dealWithError(caught);
		}
	};
}
</pre>
</div>
</div>
</div>
</div>
